{"version":3,"sources":["webpack:///./crate/pkg/sandtable.js","webpack:///./js/api.js","webpack:///./js/app.js","webpack:///./js/components/admin.js","webpack:///./js/components/browse.js","webpack:///./js/components/hypertext.js","webpack:///./js/components/info.js","webpack:///./js/components/menu.js","webpack:///./js/components/signin.js","webpack:///./js/components/ui.js","webpack:///./js/fluid.js","webpack:///./js/fluidShaders.js","webpack:///./js/fps.js","webpack:///./js/glsl/advection.glsl","webpack:///./js/glsl/advectionManualFilter.glsl","webpack:///./js/glsl/baseVertex.glsl","webpack:///./js/glsl/clear.glsl","webpack:///./js/glsl/curl.glsl","webpack:///./js/glsl/display.glsl","webpack:///./js/glsl/divergence.glsl","webpack:///./js/glsl/gradientSubtract.glsl","webpack:///./js/glsl/pressure.glsl","webpack:///./js/glsl/sand.glsl","webpack:///./js/glsl/sandVertex.glsl","webpack:///./js/glsl/splat.glsl","webpack:///./js/glsl/velocityOut.glsl","webpack:///./js/glsl/vorticity.glsl","webpack:///./js/index.js","webpack:///./js/paint.js","webpack:///./js/render.js"],"names":["Species","Object","freeze","Empty","Wall","Sand","Water","Stone","Ice","Gas","Cloner","Mite","Wood","Plant","Fungus","Seed","Fire","Lava","Acid","Dust","Oil","Rocket","__wbg_random_58bd29ed438c19c0","Math","random","cachedTextDecoder","TextDecoder","cachegetUint8Memory","getUint8Memory","buffer","wasm","Uint8Array","getStringFromWasm","ptr","len","decode","subarray","__wbindgen_throw","Error","freeCell","Cell","freeUniverse","Universe","x","y","size","species","obj","create","prototype","width","height","__wrap","freeWind","Wind","heap","Array","fill","undefined","push","heap_next","length","dropObject","idx","__wbindgen_object_drop_ref","i","window","firebase","apiKey","storageBucket","authDomain","projectId","appId","messagingSenderId","storage","functions","sizeMap","BrowseRouter","match","location","AdminRouter","SigninRouter","AppRouter","Index","ReactDOM","render","document","getElementById","ago","timeago","storageUrl","Submissions","nextProps","props","submissions","browseVotes","keys","voteFromBrowse","judge","map","submission","displayTime","Date","data","timestamp","toLocaleDateString","msAgo","getTime","format","id","pathname","hash","UI","setState","currentSubmission","load","flexGrow","wordWrap","title","score","reports","React","Component","AdminBrowse","state","paused","decidedIds","search","currentUser","auth","loadSubmissions","prevProps","getIdToken","then","token","fetch","_url","method","headers","Authorization","res","json","e","console","log","response","error","ruling","provider","GoogleAuthProvider","signInWithRedirect","filter","includes","display","withRouter","report","Browse","submitting","dataURL","event","preventDefault","startsWith","slice","param","target","value","keyCode","history","HyperText","text","tokens","split","nodes","t","Info","Menu","close","children","SignInScreen","isSignedIn","expanded","signInFlow","signInOptions","PROVIDER_ID","GithubAuthProvider","EmailAuthProvider","requireDisplayName","callbacks","signInSuccessWithAuthResult","unregisterAuthObserver","onAuthStateChanged","user","uiConfig","alignItems","borderRadius","photoURL","emailVerified","email","signOut","pallette_data","pallette","ElementButton","name","selectedElement","setElement","elementID","color","selected","background","replace","backgroundColor","submissionMenuOpen","setTimeout","pause","confirm","play","reset","snapshot","universe","cells","memory","canvas","createElement","context","getContext","imgData","createImageData","putImageData","cellData","toDataURL","payload","image","body","JSON","stringify","refFromURL","getDownloadURL","dlurl","blob","url","URL","createObjectURL","img","Image","src","onload","ctx","drawImage","getImageData","cellsData","flush_undos","push_undo","togglePause","upload","v","setSize","padding","pop_undo","fontSize","n","incScore","closeMenu","submit","sandCanvas","fluidColor","startFluid","config","TEXTURE_DOWNSAMPLE","DENSITY_DISSIPATION","VELOCITY_DISSIPATION","PRESSURE_DISSIPATION","PRESSURE_ITERATIONS","CURL","SPLAT_RADIUS","pointers","splatStack","getWebGLContext","gl","ext","compileShaders","baseVertexShader","clearShader","displayShader","splatShader","advectionManualFilteringShader","advectionShader","divergenceShader","curlShader","vorticityShader","pressureShader","gradientSubtractShader","velocityOutShader","startGUI","params","alpha","depth","stencil","antialias","preserveDrawingBuffer","isWebGL2","halfFloat","supportLinearFiltering","getExtension","clearColor","halfFloatTexType","HALF_FLOAT","HALF_FLOAT_OES","formatRGBA","formatRG","formatR","getSupportedFormat","RGBA16F","RGBA","RG16F","RG","R16F","RED","internalFormat","type","supportRenderTextureFormat","texture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","fbo","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","status","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","gui","dat","add","Full","Half","Quarter","onFinishChange","initFramebuffers","step","fun","parseInt","pointerPrototype","dx","dy","down","moved","GLProgram","vertexShader","fragmentShader","uniforms","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","uniformCount","ACTIVE_UNIFORMS","uniformName","getActiveUniform","getUniformLocation","useProgram","texWidth","texHeight","density","velocity","velocityOut","burns","divergence","curl","pressure","clearProgram","displayProgram","velocityOutProgram","splatProgram","advectionProgram","divergenceProgram","curlProgram","vorticityProgram","pressureProgram","gradientSubtractProgram","drawingBufferWidth","drawingBufferHeight","texType","rgba","rg","r","createDoubleFBO","LINEAR","createFBO","UNSIGNED_BYTE","texId","w","h","activeTexture","TEXTURE0","viewport","clear","COLOR_BUFFER_BIT","fbo1","fbo2","read","write","swap","temp","blit","bindBuffer","ARRAY_BUFFER","createBuffer","bufferData","Float32Array","STATIC_DRAW","ELEMENT_ARRAY_BUFFER","Uint16Array","vertexAttribPointer","FLOAT","enableVertexAttribArray","destination","drawElements","TRIANGLES","UNSIGNED_SHORT","lastTime","now","winds","burnsData","bind","texUnit","uniform1i","uWind","uTexture","uniform1f","update","cell_pointer","dt","min","multipleSplats","uVelocity","uSource","uniform2f","texelSize","dissipation","pointer","splat","uCurl","pressureTexId","uDivergence","uPressure","readPixels","uCells","uTarget","aspectRatio","point","uniform3f","radius","amount","boundingRect","scaleX","scaleY","resize","getBoundingClientRect","addEventListener","canvasLeft","clientX","left","canvasTop","clientY","top","cancelable","touches","targetTouches","identifier","changedTouches","j","baseVertex","require","clearShaderString","displayShaderString","splatShaderString","advectionManualFilteringShaderString","advectionShaderString","divergenceShaderString","curlShaderString","vorticityShaderString","pressureShaderString","gradientSubtractShaderString","velocityOutShaderString","compileShader","source","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","VERTEX_SHADER","FRAGMENT_SHADER","fps","frames","lastFrameTimeStamp","performance","delta","shift","Infinity","max","sum","mean","textContent","round","safari","pushState","href","onpopstate","go","mobileAndTabletcheck","check","a","test","substr","navigator","userAgent","vendor","opera","onbeforeunload","serviceWorker","register","registration","registrationError","canvas2","ui","screen_width","innerWidth","uiheight","screen_height","innerHeight","canvasStyle","uiStyle","style","fluid","drawSand","startWebGL","renderLoop","tick","animationId","requestAnimationFrame","u","eventDistance","b","sqrt","pow","magnitude","norm","mag","scale","s","sub","painting","lastPaint","repeat","clearInterval","setInterval","paint","smoothPaint","handleTouches","startEvent","d","from","forEach","devicePixelRatio","floor","reglBuilder","fsh","vsh","isSnapshot","regl","attributes","dataTexture","frag","resolution","viewportWidth","viewportHeight","dpi","vert","position","count","poll","values","range","colors","index"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAEA;;;AAEO,IAAMA,OAAO,GAAGC,MAAM,CAACC,MAAP,CAAc;AAAEC,OAAK,EAAC,CAAR;AAAUC,MAAI,EAAC,CAAf;AAAiBC,MAAI,EAAC,CAAtB;AAAwBC,OAAK,EAAC,CAA9B;AAAgCC,OAAK,EAAC,EAAtC;AAAyCC,KAAG,EAAC,CAA7C;AAA+CC,KAAG,EAAC,CAAnD;AAAqDC,QAAM,EAAC,CAA5D;AAA8DC,MAAI,EAAC,EAAnE;AAAsEC,MAAI,EAAC,CAA3E;AAA6EC,OAAK,EAAC,EAAnF;AAAsFC,QAAM,EAAC,EAA7F;AAAgGC,MAAI,EAAC,EAArG;AAAwGC,MAAI,EAAC,CAA7G;AAA+GC,MAAI,EAAC,CAApH;AAAsHC,MAAI,EAAC,EAA3H;AAA8HC,MAAI,EAAC,EAAnI;AAAsIC,KAAG,EAAC,EAA1I;AAA6IC,QAAM,EAAC;AAApJ,CAAd,CAAhB;AAEA,SAASC,6BAAT,GAAyC;AAC5C,SAAOC,IAAI,CAACC,MAAL,EAAP;AACH;AAED,IAAIC,iBAAiB,GAAG,IAAIC,WAAJ,CAAgB,OAAhB,CAAxB;AAEA,IAAIC,mBAAmB,GAAG,IAA1B;;AACA,SAASC,cAAT,GAA0B;AACtB,MAAID,mBAAmB,KAAK,IAAxB,IAAgCA,mBAAmB,CAACE,MAApB,KAA+BC,oDAAA,CAAYD,MAA/E,EAAuF;AACnFF,uBAAmB,GAAG,IAAII,UAAJ,CAAeD,oDAAA,CAAYD,MAA3B,CAAtB;AACH;;AACD,SAAOF,mBAAP;AACH;;AAED,SAASK,iBAAT,CAA2BC,GAA3B,EAAgCC,GAAhC,EAAqC;AACjC,SAAOT,iBAAiB,CAACU,MAAlB,CAAyBP,cAAc,GAAGQ,QAAjB,CAA0BH,GAA1B,EAA+BA,GAAG,GAAGC,GAArC,CAAzB,CAAP;AACH;;AAEM,SAASG,gBAAT,CAA0BJ,GAA1B,EAA+BC,GAA/B,EAAoC;AACvC,QAAM,IAAII,KAAJ,CAAUN,iBAAiB,CAACC,GAAD,EAAMC,GAAN,CAA3B,CAAN;AACH;;AAED,SAASK,QAAT,CAAkBN,GAAlB,EAAuB;AAEnBH,+DAAA,CAAqBG,GAArB;AACH;AACD;;;;AAEO,IAAMO,IAAb;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,2BAEW;AACH,UAAMP,GAAG,GAAG,KAAKA,GAAjB;AACA,WAAKA,GAAL,GAAW,CAAX;AACAM,cAAQ,CAACN,GAAD,CAAR;AACH;AANL;;AAAA;AAAA;;AAUA,SAASQ,YAAT,CAAsBR,GAAtB,EAA2B;AAEvBH,mEAAA,CAAyBG,GAAzB;AACH;AACD;;;;AAEO,IAAMS,QAAb;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,2BASW;AACH,UAAMT,GAAG,GAAG,KAAKA,GAAjB;AACA,WAAKA,GAAL,GAAW,CAAX;AACAQ,kBAAY,CAACR,GAAD,CAAZ;AACH;AAED;;;;AAfJ;AAAA;AAAA,4BAkBY;AACJ,aAAOH,4DAAA,CAAoB,KAAKG,GAAzB,CAAP;AACH;AACD;;;;AArBJ;AAAA;AAAA,2BAwBW;AACH,aAAOH,2DAAA,CAAmB,KAAKG,GAAxB,CAAP;AACH;AACD;;;;AA3BJ;AAAA;AAAA,4BA8BY;AACJ,aAAOH,4DAAA,CAAoB,KAAKG,GAAzB,CAAP;AACH;AACD;;;;AAjCJ;AAAA;AAAA,6BAoCa;AACL,aAAOH,6DAAA,CAAqB,KAAKG,GAA1B,CAAP;AACH;AACD;;;;AAvCJ;AAAA;AAAA,4BA0CY;AACJ,aAAOH,4DAAA,CAAoB,KAAKG,GAAzB,CAAP;AACH;AACD;;;;AA7CJ;AAAA;AAAA,4BAgDY;AACJ,aAAOH,4DAAA,CAAoB,KAAKG,GAAzB,CAAP;AACH;AACD;;;;AAnDJ;AAAA;AAAA,4BAsDY;AACJ,aAAOH,4DAAA,CAAoB,KAAKG,GAAzB,CAAP;AACH;AACD;;;;;;;;AAzDJ;AAAA;AAAA,0BAgEUU,CAhEV,EAgEaC,CAhEb,EAgEgBC,IAhEhB,EAgEsBC,OAhEtB,EAgE+B;AACvB,aAAOhB,4DAAA,CAAoB,KAAKG,GAAzB,EAA8BU,CAA9B,EAAiCC,CAAjC,EAAoCC,IAApC,EAA0CC,OAA1C,CAAP;AACH;AACD;;;;AAnEJ;AAAA;AAAA,gCAsEgB;AACR,aAAOhB,gEAAA,CAAwB,KAAKG,GAA7B,CAAP;AACH;AACD;;;;AAzEJ;AAAA;AAAA,+BA4Ee;AACP,aAAOH,+DAAA,CAAuB,KAAKG,GAA5B,CAAP;AACH;AACD;;;;AA/EJ;AAAA;AAAA,kCAkFkB;AACV,aAAOH,kEAAA,CAA0B,KAAKG,GAA/B,CAAP;AACH;AACD;;;;;;AArFJ;AAAA;AAAA,2BAEkBA,GAFlB,EAEuB;AACf,UAAMc,GAAG,GAAG9C,MAAM,CAAC+C,MAAP,CAAcN,QAAQ,CAACO,SAAvB,CAAZ;AACAF,SAAG,CAACd,GAAJ,GAAUA,GAAV;AAEA,aAAOc,GAAP;AACH;AAPL;AAAA;AAAA,yBA0FeG,KA1Ff,EA0FsBC,MA1FtB,EA0F8B;AACtB,aAAOT,QAAQ,CAACU,MAAT,CAAgBtB,0DAAA,CAAkBoB,KAAlB,EAAyBC,MAAzB,CAAhB,CAAP;AACH;AA5FL;;AAAA;AAAA;;AA+FA,SAASE,QAAT,CAAkBpB,GAAlB,EAAuB;AAEnBH,+DAAA,CAAqBG,GAArB;AACH;AACD;;;;AAEO,IAAMqB,IAAb;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,2BAEW;AACH,UAAMrB,GAAG,GAAG,KAAKA,GAAjB;AACA,WAAKA,GAAL,GAAW,CAAX;AACAoB,cAAQ,CAACpB,GAAD,CAAR;AACH;AANL;;AAAA;AAAA;AAUA,IAAMsB,IAAI,GAAG,IAAIC,KAAJ,CAAU,EAAV,CAAb;AAEAD,IAAI,CAACE,IAAL,CAAUC,SAAV;AAEAH,IAAI,CAACI,IAAL,CAAUD,SAAV,EAAqB,IAArB,EAA2B,IAA3B,EAAiC,KAAjC;AAEA,IAAIE,SAAS,GAAGL,IAAI,CAACM,MAArB;;AAEA,SAASC,UAAT,CAAoBC,GAApB,EAAyB;AACrB,MAAIA,GAAG,GAAG,EAAV,EAAc;AACdR,MAAI,CAACQ,GAAD,CAAJ,GAAYH,SAAZ;AACAA,WAAS,GAAGG,GAAZ;AACH;;AAEM,SAASC,0BAAT,CAAoCC,CAApC,EAAuC;AAAEH,YAAU,CAACG,CAAD,CAAV;AAAgB,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/KhE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;CAGA;;AACA;AACA;AACA;AAEAC,MAAM,CAACC,QAAP,GAAkBA,yCAAlB;AAEAA,0DAAA,CAAuB;AACrBC,QAAM,EAAE,yCADa;AAErBC,eAAa,EAAE,6BAFM;AAGrBC,YAAU,EAAE,gBAHS;AAIrBC,WAAS,EAAE,iBAJU;AAKrBC,OAAK,EAAE,qCALc;AAMrBC,mBAAiB,EAAE;AANE,CAAvB;AASA,IAAMC,OAAO,GAAGP,oDAAA,EAAhB;AACA,IAAMQ,SAAS,GAAGR,sDAAA,EAAlB;;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAIS,OAAO,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,EAAP,EAAW,EAAX,EAAe,EAAf,EAAmB,EAAnB,CAAd;;AAEA,SAASC,YAAT,OAA2C;AAAA,MAAnBC,KAAmB,QAAnBA,KAAmB;AAAA,MAAZC,QAAY,QAAZA,QAAY;AACzC,SACE,2DAAC,wDAAD,QACE,2DAAC,0DAAD;AAAQ,YAAQ,EAAEA;AAAlB,IADF,CADF;AAKD;;AAED,SAASC,WAAT,QAA0C;AAAA,MAAnBF,KAAmB,SAAnBA,KAAmB;AAAA,MAAZC,QAAY,SAAZA,QAAY;AACxC,SACE,2DAAC,wDAAD,QACE,2DAAC,yDAAD;AAAO,YAAQ,EAAEA;AAAjB,IADF,CADF;AAKD;;AAED,SAASE,YAAT,QAA2C;AAAA,MAAnBH,KAAmB,SAAnBA,KAAmB;AAAA,MAAZC,QAAY,SAAZA,QAAY;AACzC,SACE,2DAAC,wDAAD,QACE,2DAAC,0DAAD;AAAc,YAAQ,EAAEA;AAAxB,IADF,CADF;AAKD;;AAED,SAASG,SAAT,GAAqB;AACnB,SACE,2DAAC,8DAAD,QACE,2DAAC,sDAAD;AAAO,QAAI,EAAC,GAAZ;AAAgB,aAAS,EAAEC,oDAAKA;AAAhC,IADF,EAEE,2DAAC,sDAAD;AACE,SAAK,MADP;AAEE,QAAI,EAAC,QAFP;AAGE,aAAS,EAAE;AAAA,aACT,2DAAC,wDAAD,QACE,2DAAC,wDAAD,OADF,CADS;AAAA;AAHb,IAFF,EAWE,2DAAC,sDAAD;AAAO,QAAI,EAAC,SAAZ;AAAsB,aAAS,EAAEN;AAAjC,IAXF,EAYE,2DAAC,sDAAD;AAAO,QAAI,EAAC,QAAZ;AAAqB,aAAS,EAAEG;AAAhC,IAZF,EAaE,2DAAC,sDAAD;AAAO,QAAI,EAAC,QAAZ;AAAqB,aAAS,EAAEC;AAAhC,IAbF,EAcE,2DAAC,sDAAD;AAAO,QAAI,EAAC,kBAAZ;AAA+B,aAAS,EAAEA;AAA1C,IAdF,CADF;AAkBD;;AAEDG,gDAAQ,CAACC,MAAT,CAAgB,2DAAC,SAAD,OAAhB,EAA+BC,QAAQ,CAACC,cAAT,CAAwB,IAAxB,CAA/B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1DA;AACA;AAEA;AAEA;AACA;AACA;AAEA,IAAMC,GAAG,GAAGC,iDAAO,EAAnB;AAEA,IAAIC,UAAU,GACZ,wFADF;;IAGMC,W;;;;;;;;;;;;;0CACkBC,S,EAAW;AAAA,wBACI,KAAKC,KADT;AAAA,UACzBC,WADyB,eACzBA,WADyB;AAAA,UACZC,WADY,eACZA,WADY;AAE/B,aACEH,SAAS,CAACE,WAAV,KAA0BA,WAA1B,IACA7F,MAAM,CAAC+F,IAAP,CAAYJ,SAAS,CAACG,WAAtB,EAAmClC,MAAnC,KACE5D,MAAM,CAAC+F,IAAP,CAAYD,WAAZ,EAAyBlC,MAH7B;AAKD;;;6BACQ;AAAA,yBACmD,KAAKgC,KADxD;AAAA,UACDC,WADC,gBACDA,WADC;AAAA,UACYG,cADZ,gBACYA,cADZ;AAAA,UAC4BF,WAD5B,gBAC4BA,WAD5B;AAAA,UACyCG,KADzC,gBACyCA,KADzC;;AAGP,UAAI,CAACJ,WAAL,EAAkB;AAChB,eAAO;AAAK,eAAK,EAAE;AAAE3C,kBAAM,EAAE;AAAV;AAAZ,oCAAP;AACD;;AACD,UAAI2C,WAAW,CAACjC,MAAZ,IAAsB,CAA1B,EAA6B;AAC3B,eACE;AAAK,eAAK,EAAE;AAAEV,kBAAM,EAAE;AAAV;AAAZ,8DADF;AAGD;;AAED,aACE;AAAK,iBAAS,EAAC;AAAf,SACG2C,WAAW,CAACK,GAAZ,CAAgB,UAAAC,UAAU,EAAI;AAC7B,YAAIC,WAAW,GAAG,IAAIC,IAAJ,CAChBF,UAAU,CAACG,IAAX,CAAgBC,SADA,EAEhBC,kBAFgB,EAAlB;AAGA,YAAIC,KAAK,GACP,IAAIJ,IAAJ,GAAWK,OAAX,KACA,IAAIL,IAAJ,CAASF,UAAU,CAACG,IAAX,CAAgBC,SAAzB,EAAoCG,OAApC,EAFF;;AAIA,YAAID,KAAK,GAAG,KAAK,EAAL,GAAU,EAAV,GAAe,IAA3B,EAAiC;AAC/BL,qBAAW,GAAGb,GAAG,CAACoB,MAAJ,CAAWR,UAAU,CAACG,IAAX,CAAgBC,SAA3B,CAAd;AACD;;AACD,eACE;AAAK,aAAG,EAAEJ,UAAU,CAACS,EAArB;AAAyB,mBAAS,EAAC;AAAnC,WACE,2DAAC,qDAAD;AACE,mBAAS,EAAC,UADZ;AAEE,YAAE,EAAE;AACFC,oBAAQ,EAAE,GADR;AAEFC,gBAAI,aAAMX,UAAU,CAACS,EAAjB;AAFF,WAFN;AAME,iBAAO,EAAE,mBAAM;AACb3C,kBAAM,CAAC8C,EAAP,CAAUC,QAAV,CACE;AAAA,qBAAO;AACLC,iCAAiB,EAAE;AADd,eAAP;AAAA,aADF,EAIEhD,MAAM,CAAC8C,EAAP,CAAUG,IAJZ;AAMD;AAbH,WAeE;AAAK,aAAG,YAAKzB,UAAL,SAAkBU,UAAU,CAACG,IAAX,CAAgBM,EAAlC;AAAR,UAfF,CADF,EAkBE;AAAK,eAAK,EAAE;AAAE3D,iBAAK,EAAE;AAAT;AAAZ,WACE;AAAI,eAAK,EAAE;AAAEkE,oBAAQ,EAAE,CAAZ;AAAeC,oBAAQ,EAAE;AAAzB;AAAX,WACE,2DAAC,qDAAD;AAAW,cAAI,EAAEjB,UAAU,CAACG,IAAX,CAAgBe;AAAjC,UADF,CADF,EAIE;AACE,mBAAS,EAAC,OADZ;AAEE,iBAAO,EAAE;AAAA,mBAAMrB,cAAc,CAACG,UAAD,CAApB;AAAA;AAFX,WAIE,uEACGL,WAAW,CAACK,UAAU,CAACS,EAAZ,CAAX,GAA6B,IAA7B,GAAoC,GADvC,EAEGd,WAAW,CAACK,UAAU,CAACS,EAAZ,CAAX,IAA8BT,UAAU,CAACG,IAAX,CAAgBgB,KAFjD,CAJF,CAJF,EAcE,uEAAKlB,WAAL,CAdF,EAeE,uEAAKD,UAAU,CAACG,IAAX,CAAgBiB,OAArB,aAfF,EAiBE;AAAK,mBAAS,EAAC;AAAf,WACE;AACE,mBAAS,EAAC,QADZ;AAEE,eAAK,EAAC,QAFR;AAGE,iBAAO,EAAE;AAAA,mBAAMtB,KAAK,CAACE,UAAU,CAACS,EAAZ,EAAgB,IAAhB,CAAX;AAAA;AAHX,iCADF,EAQE;AACE,mBAAS,EAAC,QADZ;AAEE,eAAK,EAAC,QAFR;AAGE,iBAAO,EAAE;AAAA,mBAAMX,KAAK,CAACE,UAAU,CAACS,EAAZ,EAAgB,KAAhB,CAAX;AAAA;AAHX,iCARF,CAjBF,CAlBF,CADF;AAuDD,OAlEA,CADH,CADF;AAuED;;;;EA5FuBY,4CAAK,CAACC,S;;IA+F1BC,W;;;;;AACJ,uBAAY9B,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,qFAAMA,KAAN;AACA,UAAK+B,KAAL,GAAa;AACXC,YAAM,EAAE,KADG;AAEX/B,iBAAW,EAAE,IAFF;AAGXgC,gBAAU,EAAE,EAHD;AAIX/B,iBAAW,EAAE,EAJF;AAKXgC,YAAM,EAAE,EALG;AAMXC,iBAAW,EAAE7D,QAAQ,CAAC8D,IAAT,GAAgBD;AANlB,KAAb;AAFiB;AAUlB;;;;yCACoB;AACnB,WAAKE,eAAL;AACD;;;uCACkBC,S,EAAW;AAC5B,UAAIA,SAAS,CAACpD,QAAV,CAAmB+B,QAAnB,IAA+B,KAAKjB,KAAL,CAAWd,QAAX,CAAoB+B,QAAvD,EAAiE;AAC/D,aAAKoB,eAAL;AACD;AACF;;;mCAEc9B,U,EAAY;AAAA;;AACzB;AACAjC,cAAQ,CACL8D,IADH,GAEGD,WAFH,CAEeI,UAFf,CAE0B,IAF1B,EAGGC,IAHH,CAGQ,UAAAC,KAAK,EAAI;AACbC,aAAK,CAAC5D,iDAAS,CAAC6D,IAAV,yBAAgCpC,UAAU,CAACS,EAA3C,WAAD,EAAwD;AAC3D4B,gBAAM,EAAE,KADmD;AAE3DC,iBAAO,EAAE;AACP,4BAAgB,kBADT;AAEPC,yBAAa,EAAE,YAAYL;AAFpB;AAFkD,SAAxD,CAAL,CAOGD,IAPH,CAOQ,UAAAO,GAAG;AAAA,iBAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,SAPX,EAQGR,IARH,CAQQ,UAAA9B,IAAI,EAAI;AACZ,gBAAI,CAACU,QAAL,CAAc;AAAA,gBAAGlB,WAAH,QAAGA,WAAH;AAAA,mBAAsB;AAClCA,yBAAW,oCAAKK,UAAU,CAACS,EAAhB,EAAqBN,IAAI,CAACgB,KAA1B,GAAoCxB,WAApC;AADuB,aAAtB;AAAA,WAAd;AAGD,SAZH,WAaS,UAAA+C,CAAC,EAAI;AACVC,iBAAO,CAACC,GAAR,CAAYF,CAAZ;AACD,SAfH;AAgBD,OApBH;AAqBD;;;sCACiB;AAAA;;AAChB;AACAP,WAAK,CAAC5D,iDAAS,CAAC6D,IAAV,CAAe,aAAf,CAAD,EAAgC;AACnCC,cAAM,EAAE,KAD2B;AAEnCC,eAAO,EAAE;AACP,0BAAgB;AADT;AAF0B,OAAhC,CAAL,CAMGL,IANH,CAMQ,UAAAO,GAAG;AAAA,eAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,OANX,EAOGR,IAPH,CAOQ,UAAAY,QAAQ,EAAI;AAChB,cAAI,CAAChC,QAAL,CAAc;AAAEnB,qBAAW,EAAEmD;AAAf,SAAd,EADgB,CAEhB;;AACD,OAVH,WAWS,UAAAC,KAAK,EAAI;AACd,cAAI,CAACjC,QAAL,CAAc;AAAEnB,qBAAW,EAAE;AAAf,SAAd;;AACAiD,eAAO,CAACG,KAAR,CAAc,QAAd,EAAwBA,KAAxB;AACD,OAdH;AAeD;;;0BACKrC,E,EAAIsC,M,EAAQ;AAAA;;AAChB,WAAKlC,QAAL,CAAc;AAAA,YAAGa,UAAH,SAAGA,UAAH;AAAA,eAAqB;AACjCA,oBAAU,+BAAMA,UAAN,IAAkBjB,EAAlB;AADuB,SAArB;AAAA,OAAd;AAGA1C,cAAQ,CACL8D,IADH,GAEGD,WAFH,CAEeI,UAFf,CAE0B,IAF1B,EAGGC,IAHH,CAGQ,UAAAC,KAAK,EAAI;AACb;AACAC,aAAK,CACH5D,iDAAS,CAAC6D,IAAV,yBAAgC3B,EAAhC,iCAAyDsC,MAAzD,CADG,EAEH;AACEV,gBAAM,EAAE,KADV;AAEEC,iBAAO,EAAE;AACP,4BAAgB,kBADT;AAEPC,yBAAa,EAAE,YAAYL;AAFpB;AAFX,SAFG,CAAL,CAUGD,IAVH,CAUQ,UAAAO,GAAG;AAAA,iBAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,SAVX,EAWGR,IAXH,CAWQ,UAAA9B,IAAI,EAAI;AACZ,gBAAI,CAAC2B,eAAL;AACD,SAbH,WAcS,UAAAY,CAAC,EAAI;AACVC,iBAAO,CAACC,GAAR,CAAYF,CAAZ;AACD,SAhBH;AAiBD,OAtBH;AAuBD;;;yCACoB;AACnB,UAAIM,QAAQ,GAAG,IAAIjF,QAAQ,CAAC8D,IAAT,CAAcoB,kBAAlB,EAAf;AACAlF,cAAQ,CAAC8D,IAAT,GAAgBqB,kBAAhB,CAAmCF,QAAnC;AACD;;;6BACQ;AAAA;;AAAA,wBACqD,KAAKxB,KAD1D;AAAA,UACD9B,WADC,eACDA,WADC;AAAA,UACYC,WADZ,eACYA,WADZ;AAAA,UACyBiC,WADzB,eACyBA,WADzB;AAAA,UACsCF,UADtC,eACsCA,UADtC;AAGPhC,iBAAW,GACTA,WAAW,IACXA,WAAW,CAACyD,MAAZ,CAAmB,UAAAnD,UAAU;AAAA,eAAI,CAAC0B,UAAU,CAAC0B,QAAX,CAAoBpD,UAAU,CAACS,EAA/B,CAAL;AAAA,OAA7B,CAFF;AAGA,aACE,2DAAC,4CAAD,CAAO,QAAP,QACE,2DAAC,+CAAD,OADF,EAEE;AAAI,aAAK,EAAE;AAAE4C,iBAAO,EAAE;AAAX;AAAX,4BAFF,EAIG3D,WAAW,IAAI,uEAAKA,WAAW,CAACjC,MAAjB,yBAJlB,EAKE,2DAAC,wDAAD;AAAS,UAAE,EAAC;AAAZ,SACE,wFADF,CALF,EAQE,2DAAC,WAAD;AACE,mBAAW,EAAEiC,WADf;AAEE,sBAAc,EAAE,wBAAAM,UAAU;AAAA,iBAAI,MAAI,CAACH,cAAL,CAAoBG,UAApB,CAAJ;AAAA,SAF5B;AAGE,mBAAW,EAAEL,WAHf;AAIE,aAAK,EAAE,eAACc,EAAD,EAAKsC,MAAL;AAAA,iBAAgB,MAAI,CAACjD,KAAL,CAAWW,EAAX,EAAesC,MAAf,CAAhB;AAAA;AAJT,QARF,CADF;AAiBD;;;;EAtHuB1B,4CAAK,CAACC,S;;AAyHjBgC,kIAAU,CAAC/B,WAAD,CAAzB,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtOA;AACA;AAEA;AAEA;AACA;AACA;AAEA,IAAMnC,GAAG,GAAGC,iDAAO,EAAnB;AAEA,IAAIC,UAAU,GACZ,wFADF;;IAGMC,W;;;;;;;;;;;;;0CACkBC,S,EAAW;AAAA,wBACI,KAAKC,KADT;AAAA,UACzBC,WADyB,eACzBA,WADyB;AAAA,UACZC,WADY,eACZA,WADY;AAE/B,aACEH,SAAS,CAACE,WAAV,KAA0BA,WAA1B,IACA7F,MAAM,CAAC+F,IAAP,CAAYJ,SAAS,CAACG,WAAtB,EAAmClC,MAAnC,KACE5D,MAAM,CAAC+F,IAAP,CAAYD,WAAZ,EAAyBlC,MAH7B;AAKD;;;6BACQ;AAAA,yBACoD,KAAKgC,KADzD;AAAA,UACDC,WADC,gBACDA,WADC;AAAA,UACYG,cADZ,gBACYA,cADZ;AAAA,UAC4BF,WAD5B,gBAC4BA,WAD5B;AAAA,UACyC4D,MADzC,gBACyCA,MADzC;;AAGP,UAAI,CAAC7D,WAAL,EAAkB;AAChB,eAAO;AAAK,eAAK,EAAE;AAAE3C,kBAAM,EAAE;AAAV;AAAZ,oCAAP;AACD;;AACD,UAAI2C,WAAW,CAACjC,MAAZ,IAAsB,CAA1B,EAA6B;AAC3B,eAAO;AAAK,eAAK,EAAE;AAAEV,kBAAM,EAAE;AAAV;AAAZ,mCAAP;AACD;;AAED,aACE;AAAK,iBAAS,EAAC;AAAf,SACG2C,WAAW,CAACK,GAAZ,CAAgB,UAAAC,UAAU,EAAI;AAC7B,YAAIC,WAAW,GAAG,IAAIC,IAAJ,CAChBF,UAAU,CAACG,IAAX,CAAgBC,SADA,EAEhBC,kBAFgB,EAAlB;AAGA,YAAIC,KAAK,GACP,IAAIJ,IAAJ,GAAWK,OAAX,KACA,IAAIL,IAAJ,CAASF,UAAU,CAACG,IAAX,CAAgBC,SAAzB,EAAoCG,OAApC,EAFF;;AAIA,YAAID,KAAK,GAAG,KAAK,EAAL,GAAU,EAAV,GAAe,IAA3B,EAAiC;AAC/BL,qBAAW,GAAGb,GAAG,CAACoB,MAAJ,CAAWR,UAAU,CAACG,IAAX,CAAgBC,SAA3B,CAAd;AACD;;AACD,eACE;AAAK,aAAG,EAAEJ,UAAU,CAACS,EAArB;AAAyB,mBAAS,EAAC;AAAnC,WACE,2DAAC,qDAAD;AACE,mBAAS,EAAC,UADZ;AAEE,YAAE,EAAE;AACFC,oBAAQ,EAAE,GADR;AAEFC,gBAAI,aAAMX,UAAU,CAACS,EAAjB;AAFF,WAFN;AAME,iBAAO,EAAE,mBAAM;AACb3C,kBAAM,CAAC8C,EAAP,CAAUC,QAAV,CACE;AAAA,qBAAO;AACLC,iCAAiB,EAAE;AADd,eAAP;AAAA,aADF,EAIEhD,MAAM,CAAC8C,EAAP,CAAUG,IAJZ;AAMD;AAbH,WAeE;AAAK,aAAG,YAAKzB,UAAL,SAAkBU,UAAU,CAACG,IAAX,CAAgBM,EAAlC;AAAR,UAfF,CADF,EAkBE;AAAK,eAAK,EAAE;AAAE3D,iBAAK,EAAE;AAAT;AAAZ,WACE;AAAI,eAAK,EAAE;AAAEkE,oBAAQ,EAAE,CAAZ;AAAeC,oBAAQ,EAAE;AAAzB;AAAX,WACE,2DAAC,qDAAD;AAAW,cAAI,EAAEjB,UAAU,CAACG,IAAX,CAAgBe;AAAjC,UADF,CADF,EAIE;AACE,mBAAS,EAAC,OADZ;AAEE,iBAAO,EAAE;AAAA,mBAAMrB,cAAc,CAACG,UAAD,CAApB;AAAA;AAFX,WAIGL,WAAW,CAACK,UAAU,CAACS,EAAZ,CAAX,GAA6B,IAA7B,GAAoC,GAJvC,EAKGd,WAAW,CAACK,UAAU,CAACS,EAAZ,CAAX,IAA8BT,UAAU,CAACG,IAAX,CAAgBgB,KALjD,CAJF,EAYE,uEAAKlB,WAAL,CAZF,EAcE;AACE,mBAAS,EAAC,QADZ;AAEE,eAAK,EAAC,QAFR;AAGE,iBAAO,EAAE;AAAA,mBAAMsD,MAAM,CAACvD,UAAU,CAACS,EAAZ,CAAZ;AAAA;AAHX,eAdF,CAlBF,CADF;AA2CD,OAtDA,CADH,CADF;AA2DD;;;;EA9EuBY,4CAAK,CAACC,S;;IAiF1BkC,M;;;;;AACJ,kBAAY/D,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,gFAAMA,KAAN;AACA,UAAK+B,KAAL,GAAa;AACXC,YAAM,EAAE,KADG;AAEXgC,gBAAU,EAAE,KAFD;AAGXC,aAAO,EAAE,EAHE;AAIXhE,iBAAW,EAAE,IAJF;AAKXC,iBAAW,EAAE,EALF;AAMXgC,YAAM,EAAE;AANG,KAAb;AAFiB;AAUlB;;;;yCACoB;AACnBgB,aAAO,CAACC,GAAR,CAAY,SAAZ;AACA,WAAKd,eAAL;AACD;;;uCACkBC,S,EAAW;AAC5B,UACEA,SAAS,CAACpD,QAAV,CAAmB+B,QAAnB,IAA+B,KAAKjB,KAAL,CAAWd,QAAX,CAAoB+B,QAAnD,IACAqB,SAAS,CAACpD,QAAV,CAAmBgD,MAAnB,IAA6B,KAAKlC,KAAL,CAAWd,QAAX,CAAoBgD,MAFnD,EAGE;AACA,aAAKG,eAAL;AACD;AACF;;;kCACa;AACZhE,YAAM,CAAC2D,MAAP,GAAgB,CAAC,KAAKD,KAAL,CAAWC,MAA5B;AACA,WAAKZ,QAAL,CAAc;AAAEY,cAAM,EAAE,CAAC,KAAKD,KAAL,CAAWC;AAAtB,OAAd;AACD;;;4BAEOkC,K,EAAOlH,I,EAAM;AACnBkH,WAAK,CAACC,cAAN;AACA,WAAK/C,QAAL,CAAc;AACZpE,YAAI,EAAJA;AADY,OAAd;AAGD;;;sCAEiB;AAAA;;AAAA,UACVkC,QADU,GACG,KAAKc,KADR,CACVd,QADU;;AAEhB,UAAIA,QAAQ,CAACgD,MAAT,CAAgBkC,UAAhB,CAA2B,SAA3B,CAAJ,EAA2C;AACzC;AACA,aAAKhD,QAAL,CAAc;AAAEc,gBAAM,EAAE,KAAKlC,KAAL,CAAWd,QAAX,CAAoBgD,MAApB,CAA2BmC,KAA3B,CAAiC,CAAjC;AAAV,SAAd;AACD;;AACD,UAAIC,KAAK,GAAG,EAAZ;;AAEA,UAAIpF,QAAQ,CAAC+B,QAAT,CAAkBmD,UAAlB,CAA6B,cAA7B,CAAJ,EAAkD;AAChDE,aAAK,GAAG,UAAR;AACD;;AACD,UAAIpF,QAAQ,CAAC+B,QAAT,CAAkBmD,UAAlB,CAA6B,iBAA7B,CAAJ,EAAqD;AACnDE,aAAK,GAAG,cAAR;AACD;;AACD,UAAIpF,QAAQ,CAAC+B,QAAT,CAAkBmD,UAAlB,CAA6B,kBAA7B,CAAJ,EAAsD;AACpDE,aAAK,GAAG,cAAR;AACD;;AACD,UAAIpF,QAAQ,CAAC+B,QAAT,CAAkBmD,UAAlB,CAA6B,mBAA7B,CAAJ,EAAuD;AACrDE,aAAK,GAAG,eAAR;AACD;;AACD,UAAIpF,QAAQ,CAAC+B,QAAT,CAAkBmD,UAAlB,CAA6B,iBAA7B,CAAJ,EAAqD;AACnDE,aAAK,GAAGpF,QAAQ,CAACgD,MAAjB;AACD;;AAED,WAAKd,QAAL,CAAc;AAAEnB,mBAAW,EAAE;AAAf,OAAd;AACAyC,WAAK,CAAC5D,iDAAS,CAAC6D,IAAV,CAAe,eAAf,IAAkC2B,KAAnC,EAA0C;AAC7C1B,cAAM,EAAE,KADqC;AAE7CC,eAAO,EAAE;AACP,0BAAgB;AADT;AAFoC,OAA1C,CAAL,CAMGL,IANH,CAMQ,UAAAO,GAAG;AAAA,eAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,OANX,EAOGR,IAPH,CAOQ,UAAAY,QAAQ,EAAI;AAChB,cAAI,CAAChC,QAAL,CAAc;AAAEnB,qBAAW,EAAEmD;AAAf,SAAd,EADgB,CAEhB;;AACD,OAVH,WAWS,UAAAC,KAAK,EAAI;AACd,cAAI,CAACjC,QAAL,CAAc;AAAEnB,qBAAW,EAAE;AAAf,SAAd;;AACAiD,eAAO,CAACG,KAAR,CAAc,QAAd,EAAwBA,KAAxB;AACD,OAdH;AAeD;;;mCAEc9C,U,EAAY;AAAA;;AACzB;AACAjC,cAAQ,CACL8D,IADH,GAEGD,WAFH,CAEeI,UAFf,GAGGC,IAHH,CAGQ,UAAAC,KAAK,EAAI;AACbC,aAAK,CAAC5D,iDAAS,CAAC6D,IAAV,yBAAgCpC,UAAU,CAACS,EAA3C,WAAD,EAAwD;AAC3D4B,gBAAM,EAAE,KADmD;AAE3DC,iBAAO,EAAE;AACP,4BAAgB,kBADT;AAEPC,yBAAa,EAAE,YAAYL;AAFpB;AAFkD,SAAxD,CAAL,CAOGD,IAPH,CAOQ,UAAAO,GAAG;AAAA,iBAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,SAPX,EAQGR,IARH,CAQQ,UAAA9B,IAAI,EAAI;AACZ,gBAAI,CAACU,QAAL,CAAc;AAAA,gBAAGlB,WAAH,QAAGA,WAAH;AAAA,mBAAsB;AAClCA,yBAAW,oCAAKK,UAAU,CAACS,EAAhB,EAAqBN,IAAI,CAACgB,KAA1B,GAAoCxB,WAApC;AADuB,aAAtB;AAAA,WAAd;AAGD,SAZH,WAaS,UAAA+C,CAAC,EAAI;AACVC,iBAAO,CAACC,GAAR,CAAYF,CAAZ;AACD,SAfH;AAgBD,OApBH;AAqBD;;;2BACMjC,E,EAAI;AACT0B,WAAK,CAAC5D,iDAAS,CAAC6D,IAAV,yBAAgC3B,EAAhC,aAAD,EAA+C;AAClD4B,cAAM,EAAE,KAD0C;AAElDC,eAAO,EAAE;AACP,0BAAgB;AADT;AAFyC,OAA/C,CAAL,CAMGL,IANH,CAMQ,UAAAO,GAAG;AAAA,eAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,OANX,EAOGR,IAPH,CAOQ,UAAA9B,IAAI,EAAI,CACZ;AACA;AACA;AACD,OAXH,WAYS,UAAAuC,CAAC,EAAI;AACVC,eAAO,CAACC,GAAR,CAAYF,CAAZ;AACD,OAdH;AAeD;;;6BACQ;AAAA;;AAAA,wBACsC,KAAKlB,KAD3C;AAAA,UACCG,MADD,eACCA,MADD;AAAA,UACSjC,WADT,eACSA,WADT;AAAA,UACsBC,WADtB,eACsBA,WADtB;AAEP,aACE,2DAAC,4CAAD,CAAO,QAAP,QACE,2DAAC,kDAAD,OADF,EAEE,2DAAC,wDAAD;AAAS,aAAK,MAAd;AAAe,UAAE,EAAC;AAAlB,SACE,iFADF,CAFF,EAKE,2DAAC,wDAAD;AAAS,UAAE,EAAC;AAAZ,SACE,iFADF,CALF,EAQE,2DAAC,wDAAD;AAAS,UAAE,EAAC;AAAZ,SACE,kFADF,CARF,EAWE,2DAAC,wDAAD;AAAS,UAAE,EAAC;AAAZ,SACE,mFADF,CAXF,EAcE,2DAAC,wDAAD;AAAS,aAAK,MAAd;AAAe,UAAE,EAAC;AAAlB,SACE,kFADF,CAdF,EAiBE;AAAM,aAAK,EAAE;AAAE0D,iBAAO,EAAE;AAAX;AAAb,SACE;AACE,aAAK,EAAE1B,MADT;AAEE,gBAAQ,EAAE,kBAAAe,CAAC;AAAA,iBAAI,MAAI,CAAC7B,QAAL,CAAc;AAAEc,kBAAM,EAAEe,CAAC,CAACsB,MAAF,CAASC;AAAnB,WAAd,CAAJ;AAAA,SAFb;AAGE,iBAAS,EAAE,mBAAAvB,CAAC;AAAA,iBACVA,CAAC,CAACwB,OAAF,IAAa,EAAb,IAAmB;AACnB,gBAAI,CAACzE,KAAL,CAAW0E,OAAX,CAAmB5G,IAAnB,iCAAiDoE,MAAjD,EAFU;AAAA,SAHd;AAOE,mBAAW,EAAC;AAPd,QADF,EAUGA,MAAM,IACL,2DAAC,wDAAD;AACE,UAAE,EAAE;AACFjB,kBAAQ,EAAE,iBADR;AAEFiB,gBAAM,mBAAYA,MAAZ;AAFJ;AADN,SAME,oFANF,CAXJ,CAjBF,EAuCE,2DAAC,WAAD;AACE,mBAAW,EAAEjC,WADf;AAEE,sBAAc,EAAE,wBAAAM,UAAU;AAAA,iBAAI,MAAI,CAACH,cAAL,CAAoBG,UAApB,CAAJ;AAAA,SAF5B;AAGE,mBAAW,EAAEL,WAHf;AAIE,cAAM,EAAE,gBAAAc,EAAE;AAAA,iBAAI,MAAI,CAAC8C,MAAL,CAAY9C,EAAZ,CAAJ;AAAA;AAJZ,QAvCF,CADF;AAgDD;;;;EAzKkBY,4CAAK,CAACC,S;;AA4KZgC,kIAAU,CAACE,MAAD,CAAzB,E;;;;;;;;;;;;AC3QA;AAAA;AAAA;AAAA;AAAA;AACA;;AAEA,IAAMY,SAAS,GAAG,SAAZA,SAAY,OAAc;AAAA,MAAXC,IAAW,QAAXA,IAAW;AAC9B,MAAIC,MAAM,GAAGD,IAAI,CAACE,KAAL,CAAW,GAAX,CAAb;AAEA,MAAIC,KAAK,GAAGF,MAAM,CAACvE,GAAP,CAAW,UAAC0E,CAAD,EAAI5G,CAAJ,EAAU;AAC/B,QAAI4G,CAAC,CAACZ,UAAF,CAAa,GAAb,KAAqBY,CAAC,CAAChH,MAAF,GAAW,CAApC,EAAuC;AACrC,aACE,2DAAC,4CAAD,CAAO,QAAP;AAAgB,WAAG,EAAEI;AAArB,SACE,2DAAC,qDAAD;AACE,UAAE,EAAE;AACF6C,kBAAQ,EAAE,iBADR;AAEFiB,gBAAM,mBAAY8C,CAAC,CAACX,KAAF,CAAQ,CAAR,CAAZ;AAFJ;AADN,SAMGW,CANH,CADF,EAQU,GARV,CADF;AAYD,KAbD,MAaO;AACL,aAAOA,CAAC,GAAG,GAAX;AACD;AACF,GAjBW,CAAZ;AAkBA,SAAO,2DAAC,4CAAD,CAAO,QAAP,QAAiBD,KAAjB,CAAP;AACD,CAtBD;;AAuBeJ,wEAAf,E;;;;;;;;;;;;AC1BA;AAAA;AAAA;AAAA;;AAEA,IAAMM,IAAI,GAAG,SAAPA,IAAO,GAAM;AACjB,SACE;AAAK,aAAS,EAAC;AAAf,KACE,oFADF,EAEE,qFACa;AAAG,QAAI,EAAC;AAAR,mBADb,CAFF,EAKE,sEALF,EAME,sEANF,EAOE,0LAE2C,GAF3C,CAPF,EAWE,oNAEuE,GAFvE,EAGE;AAAG,QAAI,EAAC;AAAR,mBAHF,+CAXF,EAiBE,sEAjBF,EAkBE,qNAGE;AAAG,QAAI,EAAC;AAAR,wBAHF,CAlBF,EAuBE,sEAvBF,EAwBE,0IAEE;AAAG,QAAI,EAAC;AAAR,uBAFF,CAxBF,EA4BE,sEA5BF,EA6BE,yGACkC,GADlC,EAEE;AAAG,QAAI,EAAC;AAAR,mBAFF,SAEuE,GAFvE,EAGE;AAAG,QAAI,EAAC;AAAR,mBAHF,EAG2E,GAH3E,2EA7BF,EAmCE,sEAnCF,EAoCE,kaApCF,EA2CE,sEA3CF,EA4CE,sEA5CF,EA6CE,sEA7CF,EA8CE,8FA9CF,EA+CE,+EA/CF,oBAiDE,+EAjDF,oBAmDE,gFAnDF,mBAqDE,gFArDF,wCAuDE,8EAvDF,8BAyDE,8EAzDF,uBA2DE,iFA3DF,yCA6DE,+EA7DF,wDA+DE,+EA/DF,+BAiEE,gFAjEF,gCAmEE,iFAnEF,6BAqEE,+EArEF,mBAuEE,+EAvEF,UAyEE,+EAzEF,yBA2EE,+EA3EF,6BA6EE,+EA7EF,uCA+EE,8EA/EF,oBAiFE,iFAjFF,0DAmFE,sEAnFF,EAoFE,sEApFF,EAqFE,sEArFF,EAsFE,sEAtFF,CADF;AA0FD,CA3FD;;AA6FeA,mEAAf,E;;;;;;;;;;;;AC/FA;AAAA;AAAA;AAAA;AAAA;AACA;;AAEA,IAAMC,IAAI,GAAG,SAAPA,IAAO,OAAyB;AAAA,MAAtBC,KAAsB,QAAtBA,KAAsB;AAAA,MAAfC,QAAe,QAAfA,QAAe;AACpC,SACE;AAAK,aAAS,EAAC;AAAf,KACE;AAAK,aAAS,EAAE;AAAhB,KACGA,QADH,EAEE,2DAAC,qDAAD;AAAM,MAAE,EAAC,GAAT;AAAa,aAAS,EAAC,GAAvB;AAA2B,WAAO,EAAED;AAApC,KACE,gFADF,CAFF,CADF,CADF;AAUD,CAXD;;AAYeD,mEAAf,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACfA;AAEA;;IAEMG,Y;;;;;;;;;;;;;;;;;;4DAEI;AACNC,gBAAU,EAAE,KADN;AACa;AACnBC,cAAQ,EAAE;AAFJ,K;;+DAMG;AACT;AACAC,gBAAU,EAAE,UAFH;AAGT;AACAC,mBAAa,EAAE,CACbnH,QAAQ,CAAC8D,IAAT,CAAcoB,kBAAd,CAAiCkC,WADpB,EAEbpH,QAAQ,CAAC8D,IAAT,CAAcuD,kBAAd,CAAiCD,WAFpB,EAGb;AACEnC,gBAAQ,EAAEjF,QAAQ,CAAC8D,IAAT,CAAcwD,iBAAd,CAAgCF,WAD5C;AAEEG,0BAAkB,EAAE,KAFtB,CAIA;;AAJA,OAHa,CAJN;AAaTC,eAAS,EAAE;AACT;AACAC,mCAA2B,EAAE;AAAA,iBAAM,KAAN;AAAA;AAFpB;AAbF,K;;;;;;;AAmBX;wCACoB;AAAA;;AAClB,WAAK3E,QAAL,CAAc;AAAEkE,kBAAU,EAAE,CAAC,CAAChH,QAAQ,CAAC8D,IAAT,GAAgBD;AAAhC,OAAd;AAEA,WAAK6D,sBAAL,GAA8B1H,QAAQ,CACnC8D,IAD2B,GAE3B6D,kBAF2B,CAER,UAAAC,IAAI;AAAA,eAAI,MAAI,CAAC9E,QAAL,CAAc;AAAEkE,oBAAU,EAAE,CAAC,CAACY;AAAhB,SAAd,CAAJ;AAAA,OAFI,CAA9B;AAGD,K,CAED;;;;2CACuB;AACrB,WAAKF,sBAAL;AACD;;;6BAEQ;AAAA;;AACP,UAAI,CAAC,KAAKjE,KAAL,CAAWuD,UAAhB,EAA4B;AAC1B,YAAI,CAAC,KAAKvD,KAAL,CAAWwD,QAAhB,EAA0B;AACxB,iBACE,yEACE,gFACS,GADT,EAEE;AAAQ,mBAAO,EAAE;AAAA,qBAAM,MAAI,CAACnE,QAAL,CAAc;AAAEmE,wBAAQ,EAAE;AAAZ,eAAd,CAAN;AAAA;AAAjB,uBAFF,EAIY,GAJZ,cAKW,GALX,CADF,EAQE;AAAM,iBAAK,EAAE;AAAE3B,qBAAO,EAAE;AAAX;AAAb,aAEE,2DAAC,0EAAD;AACE,oBAAQ,EAAE,KAAKuC,QADjB;AAEE,wBAAY,EAAE7H,QAAQ,CAAC8D,IAAT;AAFhB,YAFF,CARF,CADF;AAkBD,SAnBD,MAmBO;AACL,iBACE,wEACE,yFADF,EAEE,2DAAC,0EAAD;AACE,oBAAQ,EAAE,KAAK+D,QADjB;AAEE,wBAAY,EAAE7H,QAAQ,CAAC8D,IAAT;AAFhB,YAFF,CADF;AASD;AACF;;AAhCM,2BAiCe9D,QAAQ,CAAC8D,IAAT,EAjCf;AAAA,UAiCDD,WAjCC,kBAiCDA,WAjCC;;AAmCP,aACE,wEACE;AAAK,aAAK,EAAE;AAAEyB,iBAAO,EAAE,MAAX;AAAmBwC,oBAAU,EAAE;AAA/B;AAAZ,SACE;AACE,aAAK,EAAE;AAAE9I,gBAAM,EAAE,MAAV;AAAkBD,eAAK,EAAE,MAAzB;AAAiCgJ,sBAAY,EAAE;AAA/C,SADT;AAEE,WAAG,EAAElE,WAAW,CAACmE;AAFnB,QADF,EAKG,CAACnE,WAAW,CAACoE,aAAb,uCAC6BpE,WAAW,CAACqE,KADzC,cALH,EAOE;AAAQ,eAAO,EAAE;AAAA,iBAAMlI,QAAQ,CAAC8D,IAAT,GAAgBqE,OAAhB,EAAN;AAAA;AAAjB,oBAPF,CADF,CADF;AAaD;;;;EAzFwB7E,4CAAK,CAACC,S;;AA4FlBwD,2EAAf,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChGA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEAhH,MAAM,CAACpB,OAAP,GAAiB9C,4DAAjB;AACA,IAAIuM,aAAa,GAAGC,2DAAQ,EAA5B;;AAEA,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,IAAD,EAAOC,eAAP,EAAwBC,UAAxB,EAAuC;AAC3D,MAAIC,SAAS,GAAG7M,4DAAO,CAAC0M,IAAD,CAAvB;AAEA,MAAII,KAAK,GAAGP,aAAa,CAACM,SAAD,CAAzB;AACA,MAAIE,QAAQ,GAAGF,SAAS,IAAIF,eAA5B;AAEA,MAAIK,UAAU,GAAG,SAAjB;;AACA,MAAIH,SAAS,IAAI,EAAjB,EAAqB;AACnBG,cAAU,kQAAV;;AAQA,QAAID,QAAJ,EAAc;AACZC,gBAAU,GAAGA,UAAU,CAACC,OAAX,CAAmB,OAAnB,EAA4B,KAA5B,CAAb;AACD;AACF;;AACD,SACE;AACE,aAAS,EAAEF,QAAQ,GAAG,UAAH,GAAgB,EADrC;AAEE,OAAG,EAAEL,IAFP;AAGE,WAAO,EAAE,mBAAM;AACbE,gBAAU,CAACC,SAAD,CAAV;AACD,KALH;AAME,SAAK,EAAE;AACLG,gBAAU,EAAVA,UADK;AAELE,qBAAe,EAAEH,QAAQ,GAAGD,KAAK,CAACG,OAAN,CAAc,MAAd,EAAsB,KAAtB,CAAH,GAAkCH;AAFtD;AANT,KAWG,IAXH,EAYGJ,IAZH,EAaG,IAbH,CADF;AAiBD,CArCD;;AAuCA,IAAI9H,OAAO,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,EAAP,EAAW,EAAX,EAAe,EAAf,EAAmB,EAAnB,CAAd;;IAEMO,K;;;;;AACJ,iBAAYU,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,+EAAMA,KAAN;AAEA,UAAK+B,KAAL,GAAa;AACXuF,wBAAkB,EAAE,KADT;AAEXtF,YAAM,EAAE,KAFG;AAGXgC,gBAAU,EAAE,KAHD;AAIXhH,UAAI,EAAE,CAJK;AAKXiH,aAAO,EAAE,EALE;AAMX5C,uBAAiB,EAAE,IANR;AAOXyF,qBAAe,EAAE3M,4DAAO,CAACM;AAPd,KAAb;AASA4D,UAAM,CAAC8C,EAAP,iCAZiB,CAajB;;AACA,QAAI,MAAKnB,KAAL,CAAWd,QAAX,CAAoB+B,QAApB,KAAiC,GAArC,EAA0C;AACxC5C,YAAM,CAACkJ,UAAP,CAAkB;AAAA,eAAM,MAAKC,KAAL,EAAN;AAAA,OAAlB,EAAsC,EAAtC;AACD;;AAED,UAAKlG,IAAL;;AAlBiB;AAmBlB;;;;uCAEkBgB,S,EAAW;AAC5B,UACE,KAAKtC,KAAL,CAAWd,QAAX,CAAoB+B,QAApB,KAAiC,GAAjC,IACAqB,SAAS,CAACpD,QAAV,CAAmB+B,QAAnB,KAAgC,GADhC,IAEA,KAAKc,KAAL,CAAWV,iBAHb,EAIE;AACAhD,cAAM,CAACa,QAAP,cAAsB,KAAK6C,KAAL,CAAWV,iBAAX,CAA6BL,EAAnD;AACA;AACD;;AACD,UACE,KAAKhB,KAAL,CAAWd,QAAX,CAAoB+B,QAApB,KAAiC,GAAjC,IACAqB,SAAS,CAACpD,QAAV,CAAmB+B,QAAnB,IAA+B,GAFjC,EAGE;AACA,aAAKuG,KAAL;AACD;;AACD,UACElF,SAAS,CAACpD,QAAV,CAAmBgC,IAAnB,KAA4B,EAA5B,IACAoB,SAAS,CAACpD,QAAV,CAAmBgC,IAAnB,IAA2B,KAAKlB,KAAL,CAAWd,QAAX,CAAoBgC,IAFjD,EAGE;AACA,aAAKI,IAAL;AACD;AACF;;;kCACa;AACZjD,YAAM,CAAC2D,MAAP,GAAgB,CAAC,KAAKD,KAAL,CAAWC,MAA5B;AACA,WAAKZ,QAAL,CAAc;AAAEY,cAAM,EAAE,CAAC,KAAKD,KAAL,CAAWC;AAAtB,OAAd;AACD;;;2BACM;AACL3D,YAAM,CAAC2D,MAAP,GAAgB,KAAhB;AACA,WAAKZ,QAAL,CAAc;AAAEY,cAAM,EAAE;AAAV,OAAd;AACD;;;4BACO;AACN3D,YAAM,CAAC2D,MAAP,GAAgB,IAAhB;AACA,WAAKZ,QAAL,CAAc;AAAEY,cAAM,EAAE;AAAV,OAAd;AACD;;;4BAEOkC,K,EAAOlH,I,EAAM;AACnBkH,WAAK,CAACC,cAAN;AACA,WAAK/C,QAAL,CAAc;AACZpE,YAAI,EAAJA;AADY,OAAd;AAGD;;;4BACO;AACN,UAAIqB,MAAM,CAACoJ,OAAP,CAAe,QAAf,CAAJ,EAA8B;AAC5B,aAAKC,IAAL;AACArJ,cAAM,CAACa,QAAP,GAAkB,GAAlB;AACA,aAAKkC,QAAL,CAAc;AAAEC,2BAAiB,EAAE;AAArB,SAAd;;AACAsG,+DAAK;AACN;AACF;;;2BACM;AACL,WAAKH,KAAL;AACA,WAAKpG,QAAL,CAAc;AAAEkG,0BAAkB,EAAE;AAAtB,OAAd;AACD;;;gCAEW;AACV,WAAKI,IAAL;AACA,WAAKtG,QAAL,CAAc;AAAEkG,0BAAkB,EAAE;AAAtB,OAAd;AACD;;;6BACQ;AACP,UAAIrD,OAAO,GAAG2D,2DAAQ,CAACC,kDAAD,CAAtB;AACA,UAAMC,KAAK,GAAG,IAAI5L,UAAJ,CACZ6L,8DAAM,CAAC/L,MADK,EAEZ6L,kDAAQ,CAACC,KAAT,EAFY,EAGZzK,+CAAK,GAAGC,gDAAR,GAAiB,CAHL,CAAd,CAFO,CAQP;;AACA,UAAI0K,MAAM,GAAGvI,QAAQ,CAACwI,aAAT,CAAuB,QAAvB,CAAb;AAAA,UACEC,OAAO,GAAGF,MAAM,CAACG,UAAP,CAAkB,IAAlB,CADZ;AAAA,UAEEC,OAAO,GAAGF,OAAO,CAACG,eAAR,CAAwBhL,+CAAxB,EAA+BC,gDAA/B,CAFZ;AAIA0K,YAAM,CAAC1K,MAAP,GAAgBA,gDAAhB;AACA0K,YAAM,CAAC3K,KAAP,GAAeA,+CAAf,CAdO,CAgBP;;AACA,WAAK,IAAIe,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGf,+CAAK,GAAGC,gDAAR,GAAiB,CAArC,EAAwCc,CAAC,EAAzC,EAA6C;AAC3C,YAAIA,CAAC,GAAG,CAAJ,IAAS,CAAb,EAAgB;AACdgK,iBAAO,CAAC1H,IAAR,CAAatC,CAAb,IAAkB,GAAlB;AACD,SAFD,MAEO;AACLgK,iBAAO,CAAC1H,IAAR,CAAatC,CAAb,IAAkB0J,KAAK,CAAC1J,CAAD,CAAvB;AACD;AACF,OAvBM,CAwBP;;;AACA8J,aAAO,CAACI,YAAR,CAAqBF,OAArB,EAA8B,CAA9B,EAAiC,CAAjC;AAEA,UAAIG,QAAQ,GAAGP,MAAM,CAACQ,SAAP,CAAiB,WAAjB,CAAf;AAEA,WAAKhB,KAAL;AACA,WAAKpG,QAAL,CAAc;AACZV,YAAI,EAAE;AAAEuD,iBAAO,EAAPA,OAAF;AAAW6D,eAAK,EAAES;AAAlB,SADM;AAEZjB,0BAAkB,EAAE;AAFR,OAAd;AAID;;;6BACQ;AAAA;;AAAA,wBACe,KAAKvF,KADpB;AAAA,UACDN,KADC,eACDA,KADC;AAAA,UACMf,IADN,eACMA,IADN;AAAA,UAEDuD,OAFC,GAEkBvD,IAFlB,CAEDuD,OAFC;AAAA,UAEQ6D,KAFR,GAEkBpH,IAFlB,CAEQoH,KAFR;AAGP,UAAIW,OAAO,GAAG;AAAEhH,aAAK,EAALA,KAAF;AAASiH,aAAK,EAAEzE,OAAhB;AAAyB6D,aAAK,EAALA;AAAzB,OAAd;AACA,WAAK1G,QAAL,CAAc;AAAE4C,kBAAU,EAAE;AAAd,OAAd;AAEAtB,WAAK,CAAC5D,iDAAS,CAAC6D,IAAV,CAAe,eAAf,CAAD,EAAkC;AACrCC,cAAM,EAAE,MAD6B;AAErC+F,YAAI,EAAEC,IAAI,CAACC,SAAL,CAAeJ,OAAf,CAF+B;AAEN;AAC/B5F,eAAO,EAAE;AACP,0BAAgB;AADT;AAH4B,OAAlC,CAAL,CAOGL,IAPH,CAOQ,UAAAO,GAAG;AAAA,eAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,OAPX,EAQGR,IARH,CAQQ,UAAAY,QAAQ,EAAI;AAChBF,eAAO,CAACC,GAAR,CAAY,UAAZ,EAAwByF,IAAI,CAACC,SAAL,CAAezF,QAAf,CAAxB;;AACA,cAAI,CAACsE,IAAL;AACD,OAXH,WAYS,UAAArE,KAAK;AAAA,eAAIH,OAAO,CAACG,KAAR,CAAc,QAAd,EAAwBA,KAAxB,CAAJ;AAAA,OAZd,EAaGb,IAbH,CAaQ,YAAM;AACV,cAAI,CAACpB,QAAL,CAAc;AAAEkG,4BAAkB,EAAE,KAAtB;AAA6BtD,oBAAU,EAAE;AAAzC,SAAd;AACD,OAfH;AAgBD;;;2BAEM;AAAA;;AAAA,UACC9E,QADD,GACc,KAAKc,KADnB,CACCd,QADD;AAEL,UAAI8B,EAAE,GAAG9B,QAAQ,CAACgC,IAAT,CAAckG,OAAd,CAAsB,GAAtB,EAA2B,EAA3B,CAAT;;AACA,UAAIpG,EAAE,KAAK,EAAX,EAAe;AACb;AACD;;AAED,UAAI,KAAKe,KAAL,CAAWV,iBAAX,IAAgC,KAAKU,KAAL,CAAWV,iBAAX,CAA6BL,EAA7B,IAAmCA,EAAvE,EAA2E;AACzE;AACD;;AAED0B,WAAK,CAAC5D,iDAAS,CAAC6D,IAAV,yBAAgC3B,EAAhC,EAAD,EAAwC;AAC3C4B,cAAM,EAAE,KADmC;AAE3CC,eAAO,EAAE;AACP,0BAAgB;AADT;AAFkC,OAAxC,CAAL,CAMGL,IANH,CAMQ,UAAAO,GAAG;AAAA,eAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,OANX,EAOGR,IAPH,CAOQ,UAAA9B,IAAI,EAAI;AACZ7B,uDAAO,CACJiK,UADH,sDAEkDpI,IAAI,CAACM,EAFvD,gBAIG+H,cAJH,GAKGvG,IALH,CAKQ,UAAAwG,KAAK,EAAI;AACbtG,eAAK,CAACsG,KAAD,EAAQ;AACXpG,kBAAM,EAAE;AADG,WAAR,CAAL,CAGGJ,IAHH,CAGQ,UAAAO,GAAG;AAAA,mBAAIA,GAAG,CAACkG,IAAJ,EAAJ;AAAA,WAHX,EAIGzG,IAJH,CAIQ,UAAAyG,IAAI,EAAI;AACZ;AACA,kBAAI,CAAC7H,QAAL,CAAc;AAAEC,+BAAiB,EAAE;AAAEL,kBAAE,EAAFA,EAAF;AAAMN,oBAAI,EAAJA;AAAN;AAArB,aAAd;;AAEA,gBAAIwI,GAAG,GAAGC,GAAG,CAACC,eAAJ,CAAoBH,IAApB,CAAV;AACA,gBAAII,GAAG,GAAG,IAAIC,KAAJ,EAAV;AACAD,eAAG,CAACE,GAAJ,GAAUL,GAAV;;AACAG,eAAG,CAACG,MAAJ,GAAa,YAAM;AACjB,kBAAIxB,MAAM,GAAGvI,QAAQ,CAACwI,aAAT,CAAuB,QAAvB,CAAb;AACAD,oBAAM,CAAC3K,KAAP,GAAeA,+CAAf;AACA2K,oBAAM,CAAC1K,MAAP,GAAgBA,gDAAhB;AACA,kBAAImM,GAAG,GAAGzB,MAAM,CAACG,UAAP,CAAkB,IAAlB,CAAV;AACAsB,iBAAG,CAACC,SAAJ,CAAcL,GAAd,EAAmB,CAAnB,EAAsB,CAAtB;AACA,kBAAIjB,OAAO,GAAGqB,GAAG,CAACE,YAAJ,CACZ,CADY,EAEZ,CAFY,EAGZ3B,MAAM,CAAC3K,KAHK,EAIZ2K,MAAM,CAAC1K,MAJK,CAAd;AAOA,kBAAMsM,SAAS,GAAG,IAAI1N,UAAJ,CAChB6L,8DAAM,CAAC/L,MADS,EAEhB6L,kDAAQ,CAACC,KAAT,EAFgB,EAGhBzK,+CAAK,GAAGC,gDAAR,GAAiB,CAHD,CAAlB;;AAMAqK,qEAAK;;AAEL,mBAAK,IAAIvJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGf,+CAAK,GAAGC,gDAAR,GAAiB,CAArC,EAAwCc,CAAC,EAAzC,EAA6C;AAC3CwL,yBAAS,CAACxL,CAAD,CAAT,GAAegK,OAAO,CAAC1H,IAAR,CAAatC,CAAb,CAAf;AACD;;AACDyJ,gEAAQ,CAACgC,WAAT;AACAhC,gEAAQ,CAACiC,SAAT;;AACA,oBAAI,CAACtC,KAAL;AACD,aA3BD;AA4BD,WAvCH,WAwCS,UAAAnE,KAAK;AAAA,mBAAIH,OAAO,CAACG,KAAR,CAAc,QAAd,EAAwBA,KAAxB,CAAJ;AAAA,WAxCd;AAyCD,SA/CH;AAgDD,OAxDH,WAyDS,UAAAA,KAAK,EAAI;AACdH,eAAO,CAACG,KAAR,CAAc,QAAd,EAAwBA,KAAxB;AACD,OA3DH;AA4DD;;;+BACU;AAAA;;AAAA,UACHhC,iBADG,GACmB,KAAKU,KADxB,CACHV,iBADG;AAAA,UAEHL,EAFG,GAEIK,iBAFJ,CAEHL,EAFG,EAGT;;AACA1C,cAAQ,CACL8D,IADH,GAEGD,WAFH,CAEeI,UAFf,GAGGC,IAHH,CAGQ,UAAAC,KAAK,EAAI;AACbC,aAAK,CAAC5D,iDAAS,CAAC6D,IAAV,yBAAgC3B,EAAhC,WAAD,EAA6C;AAChD4B,gBAAM,EAAE,KADwC;AAEhDC,iBAAO,EAAE;AACP,4BAAgB,kBADT;AAEPC,yBAAa,EAAE,YAAYL;AAFpB;AAFuC,SAA7C,CAAL,CAOGD,IAPH,CAOQ,UAAAO,GAAG;AAAA,iBAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,SAPX,EAQGR,IARH,CAQQ,UAAA9B,IAAI,EAAI;AACZ,cAAIW,iBAAiB,IAAI,IAAzB,EAA+B;AAC7B6B,mBAAO,CAACC,GAAR,CAAYzC,IAAZ;;AACA,kBAAI,CAACU,QAAL,CAAc;AACZC,+BAAiB,oBAAOA,iBAAP;AAA0BX,oBAAI,EAAJA;AAA1B;AADL,aAAd;AAGD;AACF,SAfH,WAgBS,UAAAuC,CAAC,EAAI;AACVC,iBAAO,CAACC,GAAR,CAAYF,CAAZ;AACD,SAlBH;AAmBD,OAvBH;AAwBD;;;6BAEQ;AAAA;;AAAA,yBACoD,KAAKlB,KADzD;AAAA,UACD/E,IADC,gBACDA,IADC;AAAA,UACKgF,MADL,gBACKA,MADL;AAAA,UACa8E,eADb,gBACaA,eADb;AAAA,UAC8BzF,iBAD9B,gBAC8BA,iBAD9B;AAEP,UAAIH,IAAI,GACNG,iBAAiB,IAAIA,iBAAiB,CAACL,EAAvC,cACQK,iBAAiB,CAACL,EAD1B,IAEI,EAHN;AAIA,aACE,2DAAC,4CAAD,CAAO,QAAP,QACE;AACE,eAAO,EAAE;AAAA,iBAAM,MAAI,CAAC+I,WAAL,EAAN;AAAA,SADX;AAEE,iBAAS,EAAE/H,MAAM,GAAG,UAAH,GAAgB;AAFnC,SAIGA,MAAM,GACL;AAAK,cAAM,EAAC,IAAZ;AAAiB,aAAK,EAAC,IAAvB;AAA4B,UAAE,EAAC,GAA/B;AAAmC,eAAO,EAAC;AAA3C,SACE;AAAS,UAAE,EAAC,MAAZ;AAAmB,cAAM,EAAC;AAA1B,QADF,CADK,GAKL;AAAK,cAAM,EAAC,IAAZ;AAAiB,aAAK,EAAC,IAAvB;AAA4B,UAAE,EAAC,GAA/B;AAAmC,eAAO,EAAC;AAA3C,SACE;AAAS,UAAE,EAAC,MAAZ;AAAmB,cAAM,EAAC;AAA1B,QADF,EAEE;AAAS,UAAE,EAAC,MAAZ;AAAmB,cAAM,EAAC;AAA1B,QAFF,CATJ,CADF,EAgBE;AAAQ,eAAO,EAAE;AAAA,iBAAM,MAAI,CAACgI,MAAL,EAAN;AAAA;AAAjB,kBAhBF,EAiBE,2DAAC,qDAAD;AACE,UAAE,EAAE;AACF/I,kBAAQ,EAAE,UADR;AAEFC,cAAI,EAAJA;AAFE;AADN,SAME,oFANF,CAjBF,EA0BE;AAAQ,eAAO,EAAE;AAAA,iBAAM,MAAI,CAACyG,KAAL,EAAN;AAAA;AAAjB,iBA1BF,EA2BE,2DAAC,qDAAD;AACE,UAAE,EAAE;AACF1G,kBAAQ,EAAE,QADR;AAEFC,cAAI,EAAJA;AAFE;AADN,SAME,kFANF,CA3BF,EAqCE;AAAM,iBAAS,EAAC;AAAhB,SACGnC,OAAO,CAACuB,GAAR,CAAY,UAAC2J,CAAD,EAAI7L,CAAJ;AAAA,eACX;AACE,aAAG,EAAEA,CADP;AAEE,mBAAS,EAAEA,CAAC,IAAIpB,IAAL,GAAY,UAAZ,GAAyB,EAFtC;AAGE,iBAAO,EAAE,iBAAAiG,CAAC;AAAA,mBAAI,MAAI,CAACiH,OAAL,CAAajH,CAAb,EAAgB7E,CAAhB,CAAJ;AAAA,WAHZ;AAIE,eAAK,EAAE;AAAE+L,mBAAO,EAAE;AAAX;AAJT,WAME;AAAK,gBAAM,EAAC,IAAZ;AAAiB,eAAK,EAAC,IAAvB;AAA4B,YAAE,EAAC,GAA/B;AAAmC,iBAAO,EAAC;AAA3C,WACE;AAAQ,YAAE,EAAC,IAAX;AAAgB,YAAE,EAAC,IAAnB;AAAwB,WAAC,EAAE,IAAIF;AAA/B,UADF,CANF,CADW;AAAA,OAAZ,CADH,CArCF,EAmDE;AACE,eAAO,EAAE,mBAAM;AACbtC,iEAAK;;AACLE,4DAAQ,CAACuC,QAAT;AACD,SAJH;AAKE,aAAK,EAAE;AAAEC,kBAAQ,EAAE;AAAZ;AALT,kBAnDF,EA4DE;AACE,iBAAS,EAAE,CAAC,CAAD,IAAMvD,eAAN,GAAwB,UAAxB,GAAqC,EADlD;AAEE,WAAG,EAAED,IAFP;AAGE,eAAO,EAAE,mBAAM;AACb,gBAAI,CAACzF,QAAL,CAAc;AAAE0F,2BAAe,EAAE,CAAC;AAApB,WAAd;AACD;AALH,gBA5DF,EAqEG1M,MAAM,CAAC+F,IAAP,CAAYhG,4DAAZ,EAAqBmG,GAArB,CAAyB,UAAAgK,CAAC;AAAA,eACzB1D,aAAa,CAAC0D,CAAD,EAAIxD,eAAJ,EAAqB,UAAA9F,EAAE;AAAA,iBAClC,MAAI,CAACI,QAAL,CAAc;AAAE0F,2BAAe,EAAE9F;AAAnB,WAAd,CADkC;AAAA,SAAvB,CADY;AAAA,OAA1B,CArEH,EA2EG,KAAKe,KAAL,CAAWV,iBAAX,IACC;AAAK,iBAAS,EAAC;AAAf,SACE;AAAQ,eAAO,EAAE;AAAA,iBAAM,MAAI,CAACkJ,QAAL,EAAN;AAAA;AAAjB,oBACK,KAAKxI,KAAL,CAAWV,iBAAX,CAA6BX,IAA7B,CAAkCgB,KADvC,EAC8C,GAD9C,CADF,EAIG,KAAKK,KAAL,CAAWV,iBAAX,CAA6BX,IAA7B,CAAkCe,KAJrC,CA5EJ,EAoFG,KAAKM,KAAL,CAAWuF,kBAAX,IACC,2DAAC,6CAAD;AAAM,aAAK,EAAE;AAAA,iBAAM,MAAI,CAACkD,SAAL,EAAN;AAAA;AAAb,SACE,8GADF,EAEE;AAAK,WAAG,EAAE,KAAKzI,KAAL,CAAWrB,IAAX,CAAgBuD,OAA1B;AAAmC,iBAAS,EAAC;AAA7C,QAFF,EAGE;AAAK,aAAK,EAAE;AAAEL,iBAAO,EAAE;AAAX;AAAZ,SACE;AACE,mBAAW,EAAC,OADd;AAEE,gBAAQ,EAAE,kBAAAX,CAAC;AAAA,iBAAI,MAAI,CAAC7B,QAAL,CAAc;AAAEK,iBAAK,EAAEwB,CAAC,CAACsB,MAAF,CAASC;AAAlB,WAAd,CAAJ;AAAA;AAFb,QADF,EAKE;AACE,gBAAQ,EAAE,KAAKzC,KAAL,CAAWiC,UADvB;AAEE,eAAO,EAAE;AAAA,iBAAM,MAAI,CAACyG,MAAL,EAAN;AAAA;AAFX,kBALF,CAHF,CArFJ,CADF;AAyGD;;;;EAhWiB7I,4CAAK,CAACC,S;;;;;;;;;;;;;;ACxD1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACa;;;;;;;;AACb;AACA;AACA;AACA,IAAMmG,MAAM,GAAGvI,QAAQ,CAACC,cAAT,CAAwB,cAAxB,CAAf;AACA,IAAMgL,UAAU,GAAGjL,QAAQ,CAACC,cAAT,CAAwB,aAAxB,CAAnB;AAEA,IAAIiL,UAAU,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,GAAP,CAAjB;;AAEA,SAASC,UAAT,OAAkC;AAAA,MAAZ/C,QAAY,QAAZA,QAAY;AAChCG,QAAM,CAAC3K,KAAP,GAAewK,QAAQ,CAACxK,KAAT,EAAf;AACA2K,QAAM,CAAC1K,MAAP,GAAgBuK,QAAQ,CAACvK,MAAT,EAAhB;AACA,MAAIuN,MAAM,GAAG;AACXC,sBAAkB,EAAE,CADT;AAEXC,uBAAmB,EAAE,IAFV;AAGXC,wBAAoB,EAAE,IAHX;AAIXC,wBAAoB,EAAE,GAJX;AAKXC,uBAAmB,EAAE,EALV;AAMXC,QAAI,EAAE,EANK;AAOXC,gBAAY,EAAE;AAPH,GAAb;AAUA,MAAIC,QAAQ,GAAG,EAAf;AACA,MAAIC,UAAU,GAAG,EAAjB;;AAdgC,yBAgBZC,eAAe,CAACvD,MAAD,CAhBH;AAAA,MAgBxBwD,EAhBwB,oBAgBxBA,EAhBwB;AAAA,MAgBpBC,GAhBoB,oBAgBpBA,GAhBoB;;AAAA,wBA8B5BC,oEAAc,CAACF,EAAD,CA9Bc;AAAA,MAkB9BG,gBAlB8B,mBAkB9BA,gBAlB8B;AAAA,MAmB9BC,WAnB8B,mBAmB9BA,WAnB8B;AAAA,MAoB9BC,aApB8B,mBAoB9BA,aApB8B;AAAA,MAqB9BC,WArB8B,mBAqB9BA,WArB8B;AAAA,MAsB9BC,8BAtB8B,mBAsB9BA,8BAtB8B;AAAA,MAuB9BC,eAvB8B,mBAuB9BA,eAvB8B;AAAA,MAwB9BC,gBAxB8B,mBAwB9BA,gBAxB8B;AAAA,MAyB9BC,UAzB8B,mBAyB9BA,UAzB8B;AAAA,MA0B9BC,eA1B8B,mBA0B9BA,eA1B8B;AAAA,MA2B9BC,cA3B8B,mBA2B9BA,cA3B8B;AAAA,MA4B9BC,sBA5B8B,mBA4B9BA,sBA5B8B;AAAA,MA6B9BC,iBA7B8B,mBA6B9BA,iBA7B8B;;AA+BhCC,UAAQ;;AAER,WAAShB,eAAT,CAAyBvD,MAAzB,EAAiC;AAC/B,QAAMwE,MAAM,GAAG;AACbC,WAAK,EAAE,KADM;AAEbC,WAAK,EAAE,KAFM;AAGbC,aAAO,EAAE,KAHI;AAIbC,eAAS,EAAE,KAJE;AAKbC,2BAAqB,EAAE;AALV,KAAf;AAQA,QAAIrB,EAAE,GAAGxD,MAAM,CAACG,UAAP,CAAkB,QAAlB,EAA4BqE,MAA5B,CAAT;AACA,QAAMM,QAAQ,GAAG,CAAC,CAACtB,EAAnB;AACA,QAAI,CAACsB,QAAL,EACEtB,EAAE,GACAxD,MAAM,CAACG,UAAP,CAAkB,OAAlB,EAA2BqE,MAA3B,KACAxE,MAAM,CAACG,UAAP,CAAkB,oBAAlB,EAAwCqE,MAAxC,CAFF;AAIF,QAAIO,SAAJ;AACA,QAAIC,sBAAJ;;AACA,QAAIF,QAAJ,EAAc;AACZtB,QAAE,CAACyB,YAAH,CAAgB,wBAAhB;AACAD,4BAAsB,GAAGxB,EAAE,CAACyB,YAAH,CAAgB,0BAAhB,CAAzB;AACD,KAHD,MAGO;AACLF,eAAS,GAAGvB,EAAE,CAACyB,YAAH,CAAgB,wBAAhB,CAAZ;AACAD,4BAAsB,GAAGxB,EAAE,CAACyB,YAAH,CAAgB,+BAAhB,CAAzB;AACD;;AAEDzB,MAAE,CAAC0B,UAAH,CAAc,GAAd,EAAmB,GAAnB,EAAwB,GAAxB,EAA6B,GAA7B;AAEA,QAAMC,gBAAgB,GAAGL,QAAQ,GAC7BtB,EAAE,CAAC4B,UAD0B,GAE7BL,SAAS,CAACM,cAFd;AAGA,QAAIC,UAAJ;AACA,QAAIC,QAAJ;AACA,QAAIC,OAAJ;;AAEA,QAAIV,QAAJ,EAAc;AACZQ,gBAAU,GAAGG,kBAAkB,CAC7BjC,EAD6B,EAE7BA,EAAE,CAACkC,OAF0B,EAG7BlC,EAAE,CAACmC,IAH0B,EAI7BR,gBAJ6B,CAA/B;AAMAI,cAAQ,GAAGE,kBAAkB,CAACjC,EAAD,EAAKA,EAAE,CAACoC,KAAR,EAAepC,EAAE,CAACqC,EAAlB,EAAsBV,gBAAtB,CAA7B;AACAK,aAAO,GAAGC,kBAAkB,CAACjC,EAAD,EAAKA,EAAE,CAACsC,IAAR,EAActC,EAAE,CAACuC,GAAjB,EAAsBZ,gBAAtB,CAA5B;AACD,KATD,MASO;AACLG,gBAAU,GAAGG,kBAAkB,CAACjC,EAAD,EAAKA,EAAE,CAACmC,IAAR,EAAcnC,EAAE,CAACmC,IAAjB,EAAuBR,gBAAvB,CAA/B;AACAI,cAAQ,GAAGE,kBAAkB,CAACjC,EAAD,EAAKA,EAAE,CAACmC,IAAR,EAAcnC,EAAE,CAACmC,IAAjB,EAAuBR,gBAAvB,CAA7B;AACAK,aAAO,GAAGC,kBAAkB,CAACjC,EAAD,EAAKA,EAAE,CAACmC,IAAR,EAAcnC,EAAE,CAACmC,IAAjB,EAAuBR,gBAAvB,CAA5B;AACD;;AAED,WAAO;AACL3B,QAAE,EAAFA,EADK;AAELC,SAAG,EAAE;AACH6B,kBAAU,EAAVA,UADG;AAEHC,gBAAQ,EAARA,QAFG;AAGHC,eAAO,EAAPA,OAHG;AAIHL,wBAAgB,EAAhBA,gBAJG;AAKHH,8BAAsB,EAAtBA;AALG;AAFA,KAAP;AAUD;;AAED,WAASS,kBAAT,CAA4BjC,EAA5B,EAAgCwC,cAAhC,EAAgDjN,MAAhD,EAAwDkN,IAAxD,EAA8D;AAC5D,QAAI,CAACC,0BAA0B,CAAC1C,EAAD,EAAKwC,cAAL,EAAqBjN,MAArB,EAA6BkN,IAA7B,CAA/B,EAAmE;AACjE,cAAQD,cAAR;AACE,aAAKxC,EAAE,CAACsC,IAAR;AACE,iBAAOL,kBAAkB,CAACjC,EAAD,EAAKA,EAAE,CAACoC,KAAR,EAAepC,EAAE,CAACqC,EAAlB,EAAsBI,IAAtB,CAAzB;;AACF,aAAKzC,EAAE,CAACoC,KAAR;AACE,iBAAOH,kBAAkB,CAACjC,EAAD,EAAKA,EAAE,CAACkC,OAAR,EAAiBlC,EAAE,CAACmC,IAApB,EAA0BM,IAA1B,CAAzB;;AACF;AACE,iBAAO,IAAP;AANJ;AAQD;;AAED,WAAO;AACLD,oBAAc,EAAdA,cADK;AAELjN,YAAM,EAANA;AAFK,KAAP;AAID;;AAED,WAASmN,0BAAT,CAAoC1C,EAApC,EAAwCwC,cAAxC,EAAwDjN,MAAxD,EAAgEkN,IAAhE,EAAsE;AACpE,QAAIE,OAAO,GAAG3C,EAAE,CAAC4C,aAAH,EAAd;AACA5C,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BH,OAA9B;AACA3C,MAAE,CAAC+C,aAAH,CAAiB/C,EAAE,CAAC8C,UAApB,EAAgC9C,EAAE,CAACgD,kBAAnC,EAAuDhD,EAAE,CAACiD,OAA1D;AACAjD,MAAE,CAAC+C,aAAH,CAAiB/C,EAAE,CAAC8C,UAApB,EAAgC9C,EAAE,CAACkD,kBAAnC,EAAuDlD,EAAE,CAACiD,OAA1D;AACAjD,MAAE,CAAC+C,aAAH,CAAiB/C,EAAE,CAAC8C,UAApB,EAAgC9C,EAAE,CAACmD,cAAnC,EAAmDnD,EAAE,CAACoD,aAAtD;AACApD,MAAE,CAAC+C,aAAH,CAAiB/C,EAAE,CAAC8C,UAApB,EAAgC9C,EAAE,CAACqD,cAAnC,EAAmDrD,EAAE,CAACoD,aAAtD;AACApD,MAAE,CAACsD,UAAH,CACEtD,EAAE,CAAC8C,UADL,EAEE,CAFF,EAGEN,cAHF,EAIE,CAJF,EAKE,CALF,EAME,CANF,EAOEjN,MAPF,EAQEkN,IARF,EASE,IATF;AAYA,QAAIc,GAAG,GAAGvD,EAAE,CAACwD,iBAAH,EAAV;AACAxD,MAAE,CAACyD,eAAH,CAAmBzD,EAAE,CAAC0D,WAAtB,EAAmCH,GAAnC;AACAvD,MAAE,CAAC2D,oBAAH,CACE3D,EAAE,CAAC0D,WADL,EAEE1D,EAAE,CAAC4D,iBAFL,EAGE5D,EAAE,CAAC8C,UAHL,EAIEH,OAJF,EAKE,CALF;AAQA,QAAMkB,MAAM,GAAG7D,EAAE,CAAC8D,sBAAH,CAA0B9D,EAAE,CAAC0D,WAA7B,CAAf;AACA,QAAIG,MAAM,IAAI7D,EAAE,CAAC+D,oBAAjB,EAAuC,OAAO,KAAP;AACvC,WAAO,IAAP;AACD;;AAED,WAAShD,QAAT,GAAoB;AAClB,QAAIiD,GAAG,GAAG,IAAIC,2CAAJ,CAAY;AAAEpS,WAAK,EAAE;AAAT,KAAZ,CAAV;AACAmS,OAAG,CACAE,GADH,CACO7E,MADP,EACe,oBADf,EACqC;AAAE8E,UAAI,EAAE,CAAR;AAAWC,UAAI,EAAE,CAAjB;AAAoBC,aAAO,EAAE;AAA7B,KADrC,EAEGhJ,IAFH,CAEQ,YAFR,EAGGiJ,cAHH,CAGkBC,gBAHlB;AAIAP,OAAG,CAACE,GAAJ,CAAQ7E,MAAR,EAAgB,qBAAhB,EAAuC,GAAvC,EAA4C,GAA5C,EAAiDhE,IAAjD,CAAsD,mBAAtD;AACA2I,OAAG,CACAE,GADH,CACO7E,MADP,EACe,sBADf,EACuC,GADvC,EAC4C,GAD5C,EAEGhE,IAFH,CAEQ,oBAFR;AAGA2I,OAAG,CACAE,GADH,CACO7E,MADP,EACe,sBADf,EACuC,GADvC,EAC4C,GAD5C,EAEGhE,IAFH,CAEQ,oBAFR;AAGA2I,OAAG,CAACE,GAAJ,CAAQ7E,MAAR,EAAgB,qBAAhB,EAAuC,CAAvC,EAA0C,EAA1C,EAA8ChE,IAA9C,CAAmD,YAAnD;AACA2I,OAAG,CACAE,GADH,CACO7E,MADP,EACe,MADf,EACuB,CADvB,EAC0B,EAD1B,EAEGhE,IAFH,CAEQ,WAFR,EAGGmJ,IAHH,CAGQ,CAHR;AAIAR,OAAG,CAACE,GAAJ,CAAQ7E,MAAR,EAAgB,cAAhB,EAAgC,MAAhC,EAAwC,IAAxC,EAA8ChE,IAA9C,CAAmD,cAAnD;AAEA2I,OAAG,CACAE,GADH,CAEI;AACEO,SAAG,EAAE,eAAM;AACT3E,kBAAU,CAACxN,IAAX,CAAgBoS,QAAQ,CAACxU,IAAI,CAACC,MAAL,KAAgB,EAAjB,CAAR,GAA+B,CAA/C;AACD;AAHH,KAFJ,EAOI,KAPJ,EASGkL,IATH,CASQ,eATR;AAWA2I,OAAG,CAACrK,KAAJ;AACD;;AAED,WAASgL,gBAAT,GAA4B;AAC1B,SAAKnP,EAAL,GAAU,CAAC,CAAX;AACA,SAAKlE,CAAL,GAAS,CAAT;AACA,SAAKC,CAAL,GAAS,CAAT;AACA,SAAKqT,EAAL,GAAU,CAAV;AACA,SAAKC,EAAL,GAAU,CAAV;AACA,SAAKC,IAAL,GAAY,KAAZ;AACA,SAAKC,KAAL,GAAa,KAAb;AACA,SAAKtJ,KAAL,GAAa,CAAC,EAAD,EAAK,GAAL,EAAU,EAAV,CAAb;AACD;;AAEDoE,UAAQ,CAACvN,IAAT,CAAc,IAAIqS,gBAAJ,EAAd;;AAhMgC,MAkM1BK,SAlM0B;AAAA;AAAA;AAmM9B,uBAAYC,YAAZ,EAA0BC,cAA1B,EAA0C;AAAA;;AACxC,WAAKC,QAAL,GAAgB,EAAhB;AACA,WAAKC,OAAL,GAAepF,EAAE,CAACqF,aAAH,EAAf;AAEArF,QAAE,CAACsF,YAAH,CAAgB,KAAKF,OAArB,EAA8BH,YAA9B;AACAjF,QAAE,CAACsF,YAAH,CAAgB,KAAKF,OAArB,EAA8BF,cAA9B;AACAlF,QAAE,CAACuF,WAAH,CAAe,KAAKH,OAApB;AAEA,UAAI,CAACpF,EAAE,CAACwF,mBAAH,CAAuB,KAAKJ,OAA5B,EAAqCpF,EAAE,CAACyF,WAAxC,CAAL,EACE,MAAMzF,EAAE,CAAC0F,iBAAH,CAAqB,KAAKN,OAA1B,CAAN;AAEF,UAAMO,YAAY,GAAG3F,EAAE,CAACwF,mBAAH,CACnB,KAAKJ,OADc,EAEnBpF,EAAE,CAAC4F,eAFgB,CAArB;;AAIA,WAAK,IAAIhT,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+S,YAApB,EAAkC/S,CAAC,EAAnC,EAAuC;AACrC,YAAMiT,WAAW,GAAG7F,EAAE,CAAC8F,gBAAH,CAAoB,KAAKV,OAAzB,EAAkCxS,CAAlC,EAAqCyI,IAAzD;AACA,aAAK8J,QAAL,CAAcU,WAAd,IAA6B7F,EAAE,CAAC+F,kBAAH,CAC3B,KAAKX,OADsB,EAE3BS,WAF2B,CAA7B;AAID;AACF;;AAzN6B;AAAA;AAAA,6BA2NvB;AACL7F,UAAE,CAACgG,UAAH,CAAc,KAAKZ,OAAnB;AACD;AA7N6B;;AAAA;AAAA;;AAgOhC,MAAIa,QAAJ;AACA,MAAIC,SAAJ;AACA,MAAIC,OAAJ;AACA,MAAIC,QAAJ;AACA,MAAIC,WAAJ;AACA,MAAIC,KAAJ;AACA,MAAIhK,KAAJ;AACA,MAAIiK,UAAJ;AACA,MAAIC,IAAJ;AACA,MAAIC,QAAJ;AACAlC,kBAAgB;AAEhB,MAAMmC,YAAY,GAAG,IAAI1B,SAAJ,CAAc7E,gBAAd,EAAgCC,WAAhC,CAArB;AACA,MAAMuG,cAAc,GAAG,IAAI3B,SAAJ,CAAc7E,gBAAd,EAAgCE,aAAhC,CAAvB;AACA,MAAMuG,kBAAkB,GAAG,IAAI5B,SAAJ,CAAc7E,gBAAd,EAAgCW,iBAAhC,CAA3B;AACA,MAAM+F,YAAY,GAAG,IAAI7B,SAAJ,CAAc7E,gBAAd,EAAgCG,WAAhC,CAArB;AACA,MAAMwG,gBAAgB,GAAG,IAAI9B,SAAJ,CACvB7E,gBADuB,EAEvBF,GAAG,CAACuB,sBAAJ,GACIhB,eADJ,GAEID,8BAJmB,CAAzB;AAMA,MAAMwG,iBAAiB,GAAG,IAAI/B,SAAJ,CAAc7E,gBAAd,EAAgCM,gBAAhC,CAA1B;AACA,MAAMuG,WAAW,GAAG,IAAIhC,SAAJ,CAAc7E,gBAAd,EAAgCO,UAAhC,CAApB;AACA,MAAMuG,gBAAgB,GAAG,IAAIjC,SAAJ,CAAc7E,gBAAd,EAAgCQ,eAAhC,CAAzB;AACA,MAAMuG,eAAe,GAAG,IAAIlC,SAAJ,CAAc7E,gBAAd,EAAgCS,cAAhC,CAAxB;AACA,MAAMuG,uBAAuB,GAAG,IAAInC,SAAJ,CAC9B7E,gBAD8B,EAE9BU,sBAF8B,CAAhC;;AAKA,WAAS0D,gBAAT,GAA4B;AAC1B0B,YAAQ,GAAGjG,EAAE,CAACoH,kBAAH,IAAyB/H,MAAM,CAACC,kBAA3C;AACA4G,aAAS,GAAGlG,EAAE,CAACqH,mBAAH,IAA0BhI,MAAM,CAACC,kBAA7C;AAEA,QAAMgI,OAAO,GAAGrH,GAAG,CAAC0B,gBAApB;AACA,QAAM4F,IAAI,GAAGtH,GAAG,CAAC6B,UAAjB;AACA,QAAM0F,EAAE,GAAGvH,GAAG,CAAC8B,QAAf;AACA,QAAM0F,CAAC,GAAGxH,GAAG,CAAC+B,OAAd;AAEAoE,YAAQ,GAAGsB,eAAe,CACxB,CADwB,EAExBzB,QAFwB,EAGxBC,SAHwB,EAIxBsB,EAAE,CAAChF,cAJqB,EAKxBgF,EAAE,CAACjS,MALqB,EAMxB+R,OANwB,EAOxBrH,GAAG,CAACuB,sBAAJ,GAA6BxB,EAAE,CAAC2H,MAAhC,GAAyC3H,EAAE,CAACiD,OAPpB,CAA1B;AASAkD,WAAO,GAAGuB,eAAe,CACvB,CADuB,EAEvBzB,QAFuB,EAGvBC,SAHuB,EAIvBqB,IAAI,CAAC/E,cAJkB,EAKvB+E,IAAI,CAAChS,MALkB,EAMvB+R,OANuB,EAOvBrH,GAAG,CAACuB,sBAAJ,GAA6BxB,EAAE,CAAC2H,MAAhC,GAAyC3H,EAAE,CAACiD,OAPrB,CAAzB;AASAsD,cAAU,GAAGqB,SAAS,CACpB,CADoB,EAEpB3B,QAFoB,EAGpBC,SAHoB,EAIpBuB,CAAC,CAACjF,cAJkB,EAKpBiF,CAAC,CAAClS,MALkB,EAMpB+R,OANoB,EAOpBtH,EAAE,CAACiD,OAPiB,CAAtB;AASAuD,QAAI,GAAGoB,SAAS,CACd,CADc,EAEd3B,QAFc,EAGdC,SAHc,EAIduB,CAAC,CAACjF,cAJY,EAKdiF,CAAC,CAAClS,MALY,EAMd+R,OANc,EAOdtH,EAAE,CAACiD,OAPW,CAAhB;AASAwD,YAAQ,GAAGiB,eAAe,CACxB,CADwB,EAExBzB,QAFwB,EAGxBC,SAHwB,EAIxBuB,CAAC,CAACjF,cAJsB,EAKxBiF,CAAC,CAAClS,MALsB,EAMxB+R,OANwB,EAOxBtH,EAAE,CAACiD,OAPqB,CAA1B;AASAqD,SAAK,GAAGsB,SAAS,CACf,CADe,EAEf3B,QAFe,EAGfC,SAHe,EAIfsB,EAAE,CAAChF,cAJY,EAKfgF,EAAE,CAACjS,MALY,EAMf+R,OANe,EAOfrH,GAAG,CAACuB,sBAAJ,GAA6BxB,EAAE,CAAC2H,MAAhC,GAAyC3H,EAAE,CAACiD,OAP7B,CAAjB;AASA3G,SAAK,GAAGsL,SAAS,CACf,EADe,EAEf3B,QAFe,EAGfC,SAHe,EAIfsB,EAAE,CAAChF,cAJY,EAKfgF,EAAE,CAACjS,MALY,EAMf+R,OANe,EAOfrH,GAAG,CAACuB,sBAAJ,GAA6BxB,EAAE,CAAC2H,MAAhC,GAAyC3H,EAAE,CAACiD,OAP7B,CAAjB;AASAoD,eAAW,GAAGuB,SAAS,CACrB,CADqB,EAErB3B,QAFqB,EAGrBC,SAHqB,EAIrBlG,EAAE,CAACmC,IAJkB,EAKrBnC,EAAE,CAACmC,IALkB,EAMrBnC,EAAE,CAAC6H,aANkB,EAOrB5H,GAAG,CAACuB,sBAAJ,GAA6BxB,EAAE,CAAC2H,MAAhC,GAAyC3H,EAAE,CAACiD,OAPvB,CAAvB;AASD;;AAED,WAAS2E,SAAT,CAAmBE,KAAnB,EAA0BC,CAA1B,EAA6BC,CAA7B,EAAgCxF,cAAhC,EAAgDjN,MAAhD,EAAwDkN,IAAxD,EAA8D3J,KAA9D,EAAqE;AACnEkH,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAcJ,KAA/B;AACA,QAAInF,OAAO,GAAG3C,EAAE,CAAC4C,aAAH,EAAd;AAEA5C,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BH,OAA9B;AACA3C,MAAE,CAAC+C,aAAH,CAAiB/C,EAAE,CAAC8C,UAApB,EAAgC9C,EAAE,CAACgD,kBAAnC,EAAuDlK,KAAvD;AACAkH,MAAE,CAAC+C,aAAH,CAAiB/C,EAAE,CAAC8C,UAApB,EAAgC9C,EAAE,CAACkD,kBAAnC,EAAuDpK,KAAvD;AACAkH,MAAE,CAAC+C,aAAH,CAAiB/C,EAAE,CAAC8C,UAApB,EAAgC9C,EAAE,CAACmD,cAAnC,EAAmDnD,EAAE,CAACoD,aAAtD;AACApD,MAAE,CAAC+C,aAAH,CAAiB/C,EAAE,CAAC8C,UAApB,EAAgC9C,EAAE,CAACqD,cAAnC,EAAmDrD,EAAE,CAACoD,aAAtD;AACApD,MAAE,CAACsD,UAAH,CACEtD,EAAE,CAAC8C,UADL,EAEE,CAFF,EAGEN,cAHF,EAIEuF,CAJF,EAKEC,CALF,EAME,CANF,EAOEzS,MAPF,EAQEkN,IARF,EASE,IATF;AAYA,QAAIc,GAAG,GAAGvD,EAAE,CAACwD,iBAAH,EAAV;AACAxD,MAAE,CAACyD,eAAH,CAAmBzD,EAAE,CAAC0D,WAAtB,EAAmCH,GAAnC;AACAvD,MAAE,CAAC2D,oBAAH,CACE3D,EAAE,CAAC0D,WADL,EAEE1D,EAAE,CAAC4D,iBAFL,EAGE5D,EAAE,CAAC8C,UAHL,EAIEH,OAJF,EAKE,CALF;AAOA3C,MAAE,CAACmI,QAAH,CAAY,CAAZ,EAAe,CAAf,EAAkBJ,CAAlB,EAAqBC,CAArB;AACAhI,MAAE,CAACoI,KAAH,CAASpI,EAAE,CAACqI,gBAAZ;AAEA,WAAO,CAAC1F,OAAD,EAAUY,GAAV,EAAeuE,KAAf,CAAP;AACD;;AAED,WAASJ,eAAT,CAAyBI,KAAzB,EAAgCC,CAAhC,EAAmCC,CAAnC,EAAsCxF,cAAtC,EAAsDjN,MAAtD,EAA8DkN,IAA9D,EAAoE3J,KAApE,EAA2E;AACzE,QAAIwP,IAAI,GAAGV,SAAS,CAACE,KAAD,EAAQC,CAAR,EAAWC,CAAX,EAAcxF,cAAd,EAA8BjN,MAA9B,EAAsCkN,IAAtC,EAA4C3J,KAA5C,CAApB;AACA,QAAIyP,IAAI,GAAGX,SAAS,CAACE,KAAK,GAAG,CAAT,EAAYC,CAAZ,EAAeC,CAAf,EAAkBxF,cAAlB,EAAkCjN,MAAlC,EAA0CkN,IAA1C,EAAgD3J,KAAhD,CAApB;AAEA,WAAO;AACL,UAAI0P,IAAJ,GAAW;AACT,eAAOF,IAAP;AACD,OAHI;;AAIL,UAAIG,KAAJ,GAAY;AACV,eAAOF,IAAP;AACD,OANI;;AAOLG,UAPK,kBAOE;AACL,YAAIC,IAAI,GAAGL,IAAX;AACAA,YAAI,GAAGC,IAAP;AACAA,YAAI,GAAGI,IAAP;AACD;AAXI,KAAP;AAaD;;AAED,MAAMC,IAAI,GAAI,YAAM;AAClB5I,MAAE,CAAC6I,UAAH,CAAc7I,EAAE,CAAC8I,YAAjB,EAA+B9I,EAAE,CAAC+I,YAAH,EAA/B;AACA/I,MAAE,CAACgJ,UAAH,CACEhJ,EAAE,CAAC8I,YADL,EAEE,IAAIG,YAAJ,CAAiB,CAAC,CAAC,CAAF,EAAK,CAAC,CAAN,EAAS,CAAC,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAC,CAA1B,CAAjB,CAFF,EAGEjJ,EAAE,CAACkJ,WAHL;AAKAlJ,MAAE,CAAC6I,UAAH,CAAc7I,EAAE,CAACmJ,oBAAjB,EAAuCnJ,EAAE,CAAC+I,YAAH,EAAvC;AACA/I,MAAE,CAACgJ,UAAH,CACEhJ,EAAE,CAACmJ,oBADL,EAEE,IAAIC,WAAJ,CAAgB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,CAAhB,CAFF,EAGEpJ,EAAE,CAACkJ,WAHL;AAKAlJ,MAAE,CAACqJ,mBAAH,CAAuB,CAAvB,EAA0B,CAA1B,EAA6BrJ,EAAE,CAACsJ,KAAhC,EAAuC,KAAvC,EAA8C,CAA9C,EAAiD,CAAjD;AACAtJ,MAAE,CAACuJ,uBAAH,CAA2B,CAA3B;AAEA,WAAO,UAAAC,WAAW,EAAI;AACpBxJ,QAAE,CAACyD,eAAH,CAAmBzD,EAAE,CAAC0D,WAAtB,EAAmC8F,WAAnC;AACAxJ,QAAE,CAACyJ,YAAH,CAAgBzJ,EAAE,CAAC0J,SAAnB,EAA8B,CAA9B,EAAiC1J,EAAE,CAAC2J,cAApC,EAAoD,CAApD;AACD,KAHD;AAID,GApBY,EAAb;;AAsBA,MAAIC,QAAQ,GAAG3U,IAAI,CAAC4U,GAAL,EAAf,CA/ZgC,CAiahC;;AAEA,MAAMhY,KAAK,GAAGwK,QAAQ,CAACxK,KAAT,EAAd;AACA,MAAMC,MAAM,GAAGuK,QAAQ,CAACvK,MAAT,EAAf;AAEA,MAAIgY,KAAK,GAAG,IAAIpZ,UAAJ,CACV6L,8DAAM,CAAC/L,MADG,EAEV6L,QAAQ,CAACyN,KAAT,EAFU,EAGVjY,KAAK,GAAGC,MAAR,GAAiB,CAHP,CAAZ;AAMA,MAAIiY,SAAS,GAAG,IAAIrZ,UAAJ,CACd6L,8DAAM,CAAC/L,MADO,EAEd6L,QAAQ,CAACiK,KAAT,EAFc,EAGdzU,KAAK,GAAGC,MAAR,GAAiB,CAHH,CAAhB;AAMA,MAAIsM,SAAS,GAAG,IAAI1N,UAAJ,CACd6L,8DAAM,CAAC/L,MADO,EAEd6L,QAAQ,CAACC,KAAT,EAFc,EAGdzK,KAAK,GAAGC,MAAR,GAAiB,CAHH,CAAhB;;AAMA,WAASqK,KAAT,GAAiB;AACfuK,gBAAY,CAACsD,IAAb;AAEA,QAAIC,OAAO,GAAG,CAAd;AACAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BwD,KAAK,CAAC,CAAD,CAAnC;AACAtG,MAAE,CAACkK,SAAH,CAAaxD,YAAY,CAACvB,QAAb,CAAsBgF,KAAnC,EAA0CF,OAAO,EAAjD;AAEAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BqD,OAAO,CAACqC,IAAR,CAAa,CAAb,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAaxD,YAAY,CAACvB,QAAb,CAAsBiF,QAAnC,EAA6CH,OAAO,EAApD;AAEAjK,MAAE,CAACqK,SAAH,CAAa3D,YAAY,CAACvB,QAAb,CAAsBnM,KAAnC,EAA0C,CAA1C;AAEA4P,QAAI,CAACzC,OAAO,CAACsC,KAAR,CAAc,CAAd,CAAD,CAAJ;AACAtC,WAAO,CAACuC,IAAR;AAEA,QAAIuB,OAAO,GAAG,CAAd;AACAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BwD,KAAK,CAAC,CAAD,CAAnC;AACAtG,MAAE,CAACkK,SAAH,CAAaxD,YAAY,CAACvB,QAAb,CAAsBgF,KAAnC,EAA0CF,OAAO,EAAjD;AAEAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8B2D,QAAQ,CAAC+B,IAAT,CAAc,CAAd,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAaxD,YAAY,CAACvB,QAAb,CAAsBiF,QAAnC,EAA6CH,OAAO,EAApD;AAEAjK,MAAE,CAACqK,SAAH,CAAa3D,YAAY,CAACvB,QAAb,CAAsBnM,KAAnC,EAA0C,CAA1C;AAEA4P,QAAI,CAACnC,QAAQ,CAACgC,KAAT,CAAe,CAAf,CAAD,CAAJ;AACAhC,YAAQ,CAACiC,IAAT;AAEAuB,WAAO,GAAG,CAAV;AACAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BwD,KAAK,CAAC,CAAD,CAAnC;AACAtG,MAAE,CAACkK,SAAH,CAAaxD,YAAY,CAACvB,QAAb,CAAsBgF,KAAnC,EAA0CF,OAAO,EAAjD;AAEAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BsD,QAAQ,CAACoC,IAAT,CAAc,CAAd,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAaxD,YAAY,CAACvB,QAAb,CAAsBiF,QAAnC,EAA6CH,OAAO,EAApD;AAEAjK,MAAE,CAACqK,SAAH,CAAa3D,YAAY,CAACvB,QAAb,CAAsBnM,KAAnC,EAA0C,CAA1C;AAEA4P,QAAI,CAACxC,QAAQ,CAACqC,KAAT,CAAe,CAAf,CAAD,CAAJ;AACArC,YAAQ,CAACsC,IAAT;AACD;;AAED,WAAS4B,MAAT,GAAkB;AAChBR,SAAK,GAAG,IAAIpZ,UAAJ,CAAe6L,8DAAM,CAAC/L,MAAtB,EAA8B6L,QAAQ,CAACyN,KAAT,EAA9B,EAAgDjY,KAAK,GAAGC,MAAR,GAAiB,CAAjE,CAAR;AAEAiY,aAAS,GAAG,IAAIrZ,UAAJ,CACV6L,8DAAM,CAAC/L,MADG,EAEV6L,QAAQ,CAACiK,KAAT,EAFU,EAGVzU,KAAK,GAAGC,MAAR,GAAiB,CAHP,CAAZ;AAMA,QAAIyY,YAAY,GAAGlO,QAAQ,CAACC,KAAT,EAAnB;AACA8B,aAAS,GAAG,IAAI1N,UAAJ,CAAe6L,8DAAM,CAAC/L,MAAtB,EAA8B+Z,YAA9B,EAA4C1Y,KAAK,GAAGC,MAAR,GAAiB,CAA7D,CAAZ,CAVgB,CAYhB;;AAEA,QAAM0Y,EAAE,GAAGta,IAAI,CAACua,GAAL,CAAS,CAACxV,IAAI,CAAC4U,GAAL,KAAaD,QAAd,IAA0B,IAAnC,EAAyC,KAAzC,CAAX;AACAA,YAAQ,GAAG3U,IAAI,CAAC4U,GAAL,EAAX;AAEA7J,MAAE,CAACmI,QAAH,CAAY,CAAZ,EAAe,CAAf,EAAkBlC,QAAlB,EAA4BC,SAA5B;AAEA,QAAIpG,UAAU,CAACtN,MAAX,GAAoB,CAAxB,EAA2BkY,cAAc,CAAC5K,UAAD,CAAd,CAnBX,CAoBhB;AAEA;AACA;AACA;;AACAgH,oBAAgB,CAACkD,IAAjB;AAEA,QAAIC,OAAO,GAAG,CAAd;AACAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BsD,QAAQ,CAACoC,IAAT,CAAc,CAAd,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAapD,gBAAgB,CAAC3B,QAAjB,CAA0BwF,SAAvC,EAAkDV,OAAO,EAAzD;AAEAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BsD,QAAQ,CAACoC,IAAT,CAAc,CAAd,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAapD,gBAAgB,CAAC3B,QAAjB,CAA0ByF,OAAvC,EAAgDX,OAAO,EAAvD;AAEAjK,MAAE,CAAC6K,SAAH,CACE/D,gBAAgB,CAAC3B,QAAjB,CAA0B2F,SAD5B,EAEE,MAAM7E,QAFR,EAGE,MAAMC,SAHR,EApCgB,CAyChB;AACA;;AACAlG,MAAE,CAACqK,SAAH,CAAavD,gBAAgB,CAAC3B,QAAjB,CAA0BqF,EAAvC,EAA2CA,EAA3C;AACAxK,MAAE,CAACqK,SAAH,CACEvD,gBAAgB,CAAC3B,QAAjB,CAA0B4F,WAD5B,EAEE1L,MAAM,CAACG,oBAFT;AAIAoJ,QAAI,CAACxC,QAAQ,CAACqC,KAAT,CAAe,CAAf,CAAD,CAAJ;AACArC,YAAQ,CAACsC,IAAT;AAEA1I,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BwD,KAAK,CAAC,CAAD,CAAnC;AACAtG,MAAE,CAACsD,UAAH,CACEtD,EAAE,CAAC8C,UADL,EAEE,CAFF,EAGE9C,EAAE,CAACmC,IAHL,EAIEtQ,KAJF,EAKEC,MALF,EAME,CANF,EAOEkO,EAAE,CAACmC,IAPL,EAQEnC,EAAE,CAAC6H,aARL,EASEkC,SATF;AAYA/J,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BxG,KAAK,CAAC,CAAD,CAAnC;AACA0D,MAAE,CAACsD,UAAH,CACEtD,EAAE,CAAC8C,UADL,EAEE,CAFF,EAGE9C,EAAE,CAACmC,IAHL,EAIEtQ,KAJF,EAKEC,MALF,EAME,CANF,EAOEkO,EAAE,CAACmC,IAPL,EAQEnC,EAAE,CAAC6H,aARL,EASEzJ,SATF,EAjEgB,CA6EhB;AACA;AACA;AACA;AACA;;AAEA,QAAI6L,OAAO,GAAG,CAAd;AACAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BwD,KAAK,CAAC,CAAD,CAAnC;AACAtG,MAAE,CAACkK,SAAH,CAAapD,gBAAgB,CAAC3B,QAAjB,CAA0BgF,KAAvC,EAA8CF,OAAO,EAArD;AAEAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BsD,QAAQ,CAACoC,IAAT,CAAc,CAAd,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAapD,gBAAgB,CAAC3B,QAAjB,CAA0BwF,SAAvC,EAAkDV,OAAO,EAAzD;AAEAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BqD,OAAO,CAACqC,IAAR,CAAa,CAAb,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAapD,gBAAgB,CAAC3B,QAAjB,CAA0ByF,OAAvC,EAAgDX,OAAO,EAAvD,EA9FgB,CAgGhB;AACA;AACA;;AACAjK,MAAE,CAACqK,SAAH,CACEvD,gBAAgB,CAAC3B,QAAjB,CAA0B4F,WAD5B,EAEE1L,MAAM,CAACE,mBAFT;AAIAqJ,QAAI,CAACzC,OAAO,CAACsC,KAAR,CAAc,CAAd,CAAD,CAAJ;AACAtC,WAAO,CAACuC,IAAR,GAxGgB,CA0GhB;AACA;AACA;;AACA,SAAK,IAAI9V,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGiN,QAAQ,CAACrN,MAA7B,EAAqCI,CAAC,EAAtC,EAA0C;AACxC,UAAMoY,OAAO,GAAGnL,QAAQ,CAACjN,CAAD,CAAxB;;AACA,UAAIoY,OAAO,CAACjG,KAAR,IAAiBlS,MAAM,CAAC8C,EAAP,CAAUY,KAAV,CAAgB+E,eAAhB,GAAkC,CAAvD,EAA0D;AACxD2P,aAAK,CAACD,OAAO,CAAC1Z,CAAT,EAAY0Z,OAAO,CAACzZ,CAApB,EAAuByZ,OAAO,CAACpG,EAA/B,EAAmCoG,OAAO,CAACnG,EAA3C,EAA+CmG,OAAO,CAACvP,KAAvD,CAAL;AACAuP,eAAO,CAACjG,KAAR,GAAgB,KAAhB;AACD;AACF,KAnHe,CAqHhB;AACA;;;AACAiC,eAAW,CAACgD,IAAZ;AAEA,QAAIC,OAAO,GAAG,CAAd;AACAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BsD,QAAQ,CAACoC,IAAT,CAAc,CAAd,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAalD,WAAW,CAAC7B,QAAZ,CAAqBwF,SAAlC,EAA6CV,OAAO,EAApD;AAEAjK,MAAE,CAAC6K,SAAH,CACE7D,WAAW,CAAC7B,QAAZ,CAAqB2F,SADvB,EAEE,MAAM7E,QAFR,EAGE,MAAMC,SAHR,EA9HgB,CAmIhB;;AACA0C,QAAI,CAACpC,IAAI,CAAC,CAAD,CAAL,CAAJ,CApIgB,CAsIhB;AACA;AACA;AACA;;AAEAS,oBAAgB,CAAC+C,IAAjB;AAEA,QAAIC,OAAO,GAAG,CAAd;AACAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BsD,QAAQ,CAACoC,IAAT,CAAc,CAAd,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAajD,gBAAgB,CAAC9B,QAAjB,CAA0BwF,SAAvC,EAAkDV,OAAO,EAAzD;AAEAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8B0D,IAAI,CAAC,CAAD,CAAlC;AACAxG,MAAE,CAACkK,SAAH,CAAajD,gBAAgB,CAAC9B,QAAjB,CAA0B+F,KAAvC,EAA8CjB,OAAO,EAArD;AAEAjK,MAAE,CAAC6K,SAAH,CACE5D,gBAAgB,CAAC9B,QAAjB,CAA0B2F,SAD5B,EAEE,MAAM7E,QAFR,EAGE,MAAMC,SAHR,EAtJgB,CA4JhB;AACA;;AACAlG,MAAE,CAACqK,SAAH,CAAapD,gBAAgB,CAAC9B,QAAjB,CAA0BqB,IAAvC,EAA6CnH,MAAM,CAACM,IAApD;AACAK,MAAE,CAACqK,SAAH,CAAapD,gBAAgB,CAAC9B,QAAjB,CAA0BqF,EAAvC,EAA2CA,EAA3C;AACA5B,QAAI,CAACxC,QAAQ,CAACqC,KAAT,CAAe,CAAf,CAAD,CAAJ;AACArC,YAAQ,CAACsC,IAAT,GAjKgB,CAmKhB;AACA;AACA;;AACA3B,qBAAiB,CAACiD,IAAlB;AAEA,QAAIC,OAAO,GAAG,CAAd;AACAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BsD,QAAQ,CAACoC,IAAT,CAAc,CAAd,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAanD,iBAAiB,CAAC5B,QAAlB,CAA2BwF,SAAxC,EAAmDV,OAAO,EAA1D;AAEAjK,MAAE,CAAC6K,SAAH,CACE9D,iBAAiB,CAAC5B,QAAlB,CAA2B2F,SAD7B,EAEE,MAAM7E,QAFR,EAGE,MAAMC,SAHR,EA7KgB,CAkLhB;;AACA0C,QAAI,CAACrC,UAAU,CAAC,CAAD,CAAX,CAAJ,CAnLgB,CAqLhB;AACA;AACA;AACA;;AACAG,gBAAY,CAACsD,IAAb;AAEA,QAAIC,OAAO,GAAG,CAAd;AACAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BwD,KAAK,CAAC,CAAD,CAAnC;AACAtG,MAAE,CAACkK,SAAH,CAAaxD,YAAY,CAACvB,QAAb,CAAsBgF,KAAnC,EAA0CF,OAAO,EAAjD;AAEAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8B2D,QAAQ,CAAC+B,IAAT,CAAc,CAAd,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAaxD,YAAY,CAACvB,QAAb,CAAsBiF,QAAnC,EAA6CH,OAAO,EAApD;AAEA,QAAIkB,aAAa,GAAGlB,OAAO,GAAG,CAA9B,CApMgB,CAsMhB;AACA;AACA;AAEA;AACA;;AACAjK,MAAE,CAACqK,SAAH,CAAa3D,YAAY,CAACvB,QAAb,CAAsBnM,KAAnC,EAA0CqG,MAAM,CAACI,oBAAjD;AAEAmJ,QAAI,CAACnC,QAAQ,CAACgC,KAAT,CAAe,CAAf,CAAD,CAAJ;AACAhC,YAAQ,CAACiC,IAAT,GA/MgB,CAiNhB;AACA;AACA;AACA;;AACAxB,mBAAe,CAAC8C,IAAhB,GArNgB,CAsNhB;;AACA,QAAIC,OAAO,GAAG,CAAd;AACAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8ByD,UAAU,CAAC,CAAD,CAAxC;AACAvG,MAAE,CAACkK,SAAH,CAAahD,eAAe,CAAC/B,QAAhB,CAAyBiG,WAAtC,EAAmDnB,OAAO,EAA1D,EA1NgB,CA4NhB;AACA;AACA;;AAEAjK,MAAE,CAAC6K,SAAH,CACE3D,eAAe,CAAC/B,QAAhB,CAAyB2F,SAD3B,EAEE,MAAM7E,QAFR,EAGE,MAAMC,SAHR,EAhOgB,CAqOhB;;AACAiF,iBAAa,GAAG1E,QAAQ,CAAC+B,IAAT,CAAc,CAAd,CAAhB;AACAxI,MAAE,CAACkK,SAAH,CAAahD,eAAe,CAAC/B,QAAhB,CAAyBkG,SAAtC,EAAiDF,aAAjD;AACAnL,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAciD,aAA/B;;AACA,SAAK,IAAIvY,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAGyM,MAAM,CAACK,mBAA3B,EAAgD9M,EAAC,EAAjD,EAAqD;AACnDoN,QAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8B2D,QAAQ,CAAC+B,IAAT,CAAc,CAAd,CAA9B;AACAI,UAAI,CAACnC,QAAQ,CAACgC,KAAT,CAAe,CAAf,CAAD,CAAJ;AACAhC,cAAQ,CAACiC,IAAT;AACD,KA7Oe,CA+OhB;AACA;AACA;AACA;;;AACA9B,sBAAkB,CAACoD,IAAnB;AAEA,QAAIC,OAAO,GAAG,CAAd;AACAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BsD,QAAQ,CAACoC,IAAT,CAAc,CAAd,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAatD,kBAAkB,CAACzB,QAAnB,CAA4BiF,QAAzC,EAAmDH,OAAO,EAA1D;AAEAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8B2D,QAAQ,CAAC+B,IAAT,CAAc,CAAd,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAatD,kBAAkB,CAACzB,QAAnB,CAA4BkG,SAAzC,EAAoDpB,OAAO,EAA3D,EA5PgB,CA8PhB;AACA;;AACArB,QAAI,CAACvC,WAAW,CAAC,CAAD,CAAZ,CAAJ;AACArG,MAAE,CAACsL,UAAH,CAAc,CAAd,EAAiB,CAAjB,EAAoBzZ,KAApB,EAA2BC,MAA3B,EAAmCkO,EAAE,CAACmC,IAAtC,EAA4CnC,EAAE,CAAC6H,aAA/C,EAA8DiC,KAA9D,EAjQgB,CAmQhB;AACA;AACA;AACA;AACA;AACA;;AACA3C,2BAAuB,CAAC6C,IAAxB;AAEA,QAAIC,OAAO,GAAG,CAAd;AACAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BwD,KAAK,CAAC,CAAD,CAAnC;AACAtG,MAAE,CAACkK,SAAH,CAAa/C,uBAAuB,CAAChC,QAAxB,CAAiCgF,KAA9C,EAAqDF,OAAO,EAA5D;AAEAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8B2D,QAAQ,CAAC+B,IAAT,CAAc,CAAd,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAa/C,uBAAuB,CAAChC,QAAxB,CAAiCkG,SAA9C,EAAyDpB,OAAO,EAAhE;AAEAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BsD,QAAQ,CAACoC,IAAT,CAAc,CAAd,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAa/C,uBAAuB,CAAChC,QAAxB,CAAiCwF,SAA9C,EAAyDV,OAAO,EAAhE;AAEAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BxG,KAAK,CAAC,CAAD,CAAnC;AACA0D,MAAE,CAACkK,SAAH,CAAa/C,uBAAuB,CAAChC,QAAxB,CAAiCoG,MAA9C,EAAsDtB,OAAO,EAA7D;AAEAjK,MAAE,CAAC6K,SAAH,CACE1D,uBAAuB,CAAChC,QAAxB,CAAiC2F,SADnC,EAEE,MAAM7E,QAFR,EAGE,MAAMC,SAHR,EA5RgB,CAkShB;AACA;AACA;;AACA0C,QAAI,CAACxC,QAAQ,CAACqC,KAAT,CAAe,CAAf,CAAD,CAAJ;AACArC,YAAQ,CAACsC,IAAT;AAEA1I,MAAE,CAACmI,QAAH,CAAY,CAAZ,EAAe,CAAf,EAAkBnI,EAAE,CAACoH,kBAArB,EAAyCpH,EAAE,CAACqH,mBAA5C,EAxSgB,CA0ShB;AACA;AACA;;AACAV,kBAAc,CAACqD,IAAf;AAEA,QAAIC,OAAO,GAAG,CAAd;AACAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BqD,OAAO,CAACqC,IAAR,CAAa,CAAb,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAavD,cAAc,CAACxB,QAAf,CAAwBiF,QAArC,EAA+CH,OAAO,EAAtD,EAlTgB,CAoThB;;AAEArB,QAAI,CAAC,IAAD,CAAJ;AACD;;AAED,WAASqC,KAAT,CAAe3Z,CAAf,EAAkBC,CAAlB,EAAqBqT,EAArB,EAAyBC,EAAzB,EAA6BpJ,KAA7B,EAAoC;AAClCoL,gBAAY,CAACmD,IAAb;AAEA,QAAIC,OAAO,GAAG,CAAd;AACAjK,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BsD,QAAQ,CAACoC,IAAT,CAAc,CAAd,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAarD,YAAY,CAAC1B,QAAb,CAAsBqG,OAAnC,EAA4CvB,OAAO,EAAnD,EANkC,CAQlC;;AACAjK,MAAE,CAACqK,SAAH,CACExD,YAAY,CAAC1B,QAAb,CAAsBsG,WADxB,EAEEjP,MAAM,CAAC3K,KAAP,GAAe2K,MAAM,CAAC1K,MAFxB;AAIAkO,MAAE,CAAC6K,SAAH,CACEhE,YAAY,CAAC1B,QAAb,CAAsBuG,KADxB,EAEEpa,CAAC,GAAGkL,MAAM,CAAC3K,KAFb,EAGE,MAAMN,CAAC,GAAGiL,MAAM,CAAC1K,MAHnB;AAKAkO,MAAE,CAAC2L,SAAH,CAAa9E,YAAY,CAAC1B,QAAb,CAAsB1J,KAAnC,EAA0CmJ,EAA1C,EAA8C,CAACC,EAA/C,EAAmD,GAAnD;AACA7E,MAAE,CAACqK,SAAH,CACExD,YAAY,CAAC1B,QAAb,CAAsByG,MADxB,EAEE,CAAC/Y,MAAM,CAAC8C,EAAP,CAAUY,KAAV,CAAgB/E,IAAhB,GAAuB,CAAxB,IAA6B,GAF/B;AAIAoX,QAAI,CAACxC,QAAQ,CAACqC,KAAT,CAAe,CAAf,CAAD,CAAJ;AACArC,YAAQ,CAACsC,IAAT;AAEA1I,MAAE,CAACiI,aAAH,CAAiBjI,EAAE,CAACkI,QAAH,GAAc+B,OAA/B;AACAjK,MAAE,CAAC6C,WAAH,CAAe7C,EAAE,CAAC8C,UAAlB,EAA8BqD,OAAO,CAACqC,IAAR,CAAa,CAAb,CAA9B;AACAxI,MAAE,CAACkK,SAAH,CAAarD,YAAY,CAAC1B,QAAb,CAAsBqG,OAAnC,EAA4CvB,OAAO,EAAnD,EA5BkC,CA8BlC;;AACAjK,MAAE,CAAC2L,SAAH,CAAa9E,YAAY,CAAC1B,QAAb,CAAsB1J,KAAnC,EAA0CA,KAAK,CAAC,CAAD,CAA/C,EAAoDA,KAAK,CAAC,CAAD,CAAzD,EAA8DA,KAAK,CAAC,CAAD,CAAnE;AACAmN,QAAI,CAACzC,OAAO,CAACsC,KAAR,CAAc,CAAd,CAAD,CAAJ;AACAtC,WAAO,CAACuC,IAAR;AACD;;AAED,WAASgC,cAAT,CAAwBmB,MAAxB,EAAgC;AAC9B,SAAK,IAAIjZ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGiZ,MAApB,EAA4BjZ,CAAC,EAA7B,EAAiC;AAC/B,UAAM6I,KAAK,GAAG0D,UAAd;AACA,UAAM7N,CAAC,GAAGkL,MAAM,CAAC3K,KAAP,GAAe3B,IAAI,CAACC,MAAL,EAAzB;AACA,UAAMoB,CAAC,GAAGiL,MAAM,CAAC1K,MAAP,GAAgB5B,IAAI,CAACC,MAAL,EAA1B;AACA,UAAMyU,EAAE,GAAG,QAAQ1U,IAAI,CAACC,MAAL,KAAgB,GAAxB,CAAX;AACA,UAAM0U,EAAE,GAAG,QAAQ3U,IAAI,CAACC,MAAL,KAAgB,GAAxB,CAAX;AACA8a,WAAK,CAAC3Z,CAAD,EAAIC,CAAJ,EAAOqT,EAAP,EAAWC,EAAX,EAAepJ,KAAf,CAAL;AACD;AACF;;AAED,MAAIqQ,YAAJ;AACA,MAAIC,MAAJ;AACA,MAAIC,MAAJ;;AAEA,MAAIC,MAAM,GAAG,SAATA,MAAS,GAAM;AACjBH,gBAAY,GAAG5M,UAAU,CAACgN,qBAAX,EAAf;AACAH,UAAM,GAAG7M,UAAU,CAACrN,KAAX,GAAmBia,YAAY,CAACja,KAAzC;AACAma,UAAM,GAAG9M,UAAU,CAACpN,MAAX,GAAoBga,YAAY,CAACha,MAA1C;AACD,GAJD;;AAKAma,QAAM;AACNpZ,QAAM,CAACsZ,gBAAP,CAAwB,QAAxB,EAAkCF,MAAlC;AACApZ,QAAM,CAACsZ,gBAAP,CAAwB,mBAAxB,EAA6CF,MAA7C,EAAqD,IAArD;AAEA/M,YAAU,CAACiN,gBAAX,CAA4B,WAA5B,EAAyC,UAAA1U,CAAC,EAAI;AAC5C,QAAM2U,UAAU,GAAG,CAAC3U,CAAC,CAAC4U,OAAF,GAAYP,YAAY,CAACQ,IAA1B,IAAkCP,MAArD;AACA,QAAMQ,SAAS,GAAG,CAAC9U,CAAC,CAAC+U,OAAF,GAAYV,YAAY,CAACW,GAA1B,IAAiCT,MAAnD;AACAnM,YAAQ,CAAC,CAAD,CAAR,CAAYkF,KAAZ,GAAoBlF,QAAQ,CAAC,CAAD,CAAR,CAAYiF,IAAhC;AACAjF,YAAQ,CAAC,CAAD,CAAR,CAAY+E,EAAZ,GAAiB,CAACwH,UAAU,GAAGvM,QAAQ,CAAC,CAAD,CAAR,CAAYvO,CAA1B,IAA+B,IAAhD;AACAuO,YAAQ,CAAC,CAAD,CAAR,CAAYgF,EAAZ,GAAiB,CAAC0H,SAAS,GAAG1M,QAAQ,CAAC,CAAD,CAAR,CAAYtO,CAAzB,IAA8B,IAA/C;AACAsO,YAAQ,CAAC,CAAD,CAAR,CAAYvO,CAAZ,GAAgB8a,UAAhB;AACAvM,YAAQ,CAAC,CAAD,CAAR,CAAYtO,CAAZ,GAAgBgb,SAAhB;AACD,GARD;AAUArN,YAAU,CAACiN,gBAAX,CACE,WADF,EAEE,UAAA1U,CAAC,EAAI;AACH,QAAI,CAAC5E,MAAM,CAAC2D,MAAZ,EAAoB;AAClB,UAAIiB,CAAC,CAACiV,UAAN,EAAkB;AAChBjV,SAAC,CAACkB,cAAF;AACD;AACF;;AACD,QAAMgU,OAAO,GAAGlV,CAAC,CAACmV,aAAlB;;AACA,SAAK,IAAIha,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+Z,OAAO,CAACna,MAA5B,EAAoCI,CAAC,EAArC,EAAyC;AACvC,UAAIoY,OAAO,GAAGnL,QAAQ,CAACjN,CAAD,CAAtB;AACAoY,aAAO,CAACjG,KAAR,GAAgBiG,OAAO,CAAClG,IAAxB;AAEA,UAAMsH,UAAU,GAAG,CAACO,OAAO,CAAC/Z,CAAD,CAAP,CAAWyZ,OAAX,GAAqBP,YAAY,CAACQ,IAAnC,IAA2CP,MAA9D;AACA,UAAMQ,SAAS,GAAG,CAACI,OAAO,CAAC/Z,CAAD,CAAP,CAAW4Z,OAAX,GAAqBV,YAAY,CAACW,GAAnC,IAA0CT,MAA5D;AAEAhB,aAAO,CAACpG,EAAR,GAAa,CAACwH,UAAU,GAAGpB,OAAO,CAAC1Z,CAAtB,IAA2B,IAAxC;AACA0Z,aAAO,CAACnG,EAAR,GAAa,CAAC0H,SAAS,GAAGvB,OAAO,CAACzZ,CAArB,IAA0B,IAAvC;AACAyZ,aAAO,CAAC1Z,CAAR,GAAY8a,UAAZ;AACApB,aAAO,CAACzZ,CAAR,GAAYgb,SAAZ;AACD;AACF,GArBH,EAsBE,KAtBF;AAyBArN,YAAU,CAACiN,gBAAX,CAA4B,WAA5B,EAAyC,YAAM;AAC7CtM,YAAQ,CAAC,CAAD,CAAR,CAAYiF,IAAZ,GAAmB,IAAnB;AACAjF,YAAQ,CAAC,CAAD,CAAR,CAAYpE,KAAZ,GAAoB0D,UAApB;AACD,GAHD;AAKAD,YAAU,CAACiN,gBAAX,CAA4B,YAA5B,EAA0C,UAAA1U,CAAC,EAAI;AAC7C,QAAIA,CAAC,CAACiV,UAAN,EAAkB;AAChBjV,OAAC,CAACkB,cAAF;AACD;;AACD,QAAMgU,OAAO,GAAGlV,CAAC,CAACmV,aAAlB;;AACA,SAAK,IAAIha,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+Z,OAAO,CAACna,MAA5B,EAAoCI,CAAC,EAArC,EAAyC;AACvC,UAAIA,CAAC,IAAIiN,QAAQ,CAACrN,MAAlB,EAA0BqN,QAAQ,CAACvN,IAAT,CAAc,IAAIqS,gBAAJ,EAAd;AAE1B,UAAMyH,UAAU,GAAG,CAACO,OAAO,CAAC/Z,CAAD,CAAP,CAAWyZ,OAAX,GAAqBP,YAAY,CAACQ,IAAnC,IAA2CP,MAA9D;AACA,UAAMQ,SAAS,GAAG,CAACI,OAAO,CAAC/Z,CAAD,CAAP,CAAW4Z,OAAX,GAAqBV,YAAY,CAACW,GAAnC,IAA0CT,MAA5D;AAEAnM,cAAQ,CAACjN,CAAD,CAAR,CAAY4C,EAAZ,GAAiBmX,OAAO,CAAC/Z,CAAD,CAAP,CAAWia,UAA5B;AACAhN,cAAQ,CAACjN,CAAD,CAAR,CAAYkS,IAAZ,GAAmB,IAAnB;AACAjF,cAAQ,CAACjN,CAAD,CAAR,CAAYtB,CAAZ,GAAgB8a,UAAhB;AACAvM,cAAQ,CAACjN,CAAD,CAAR,CAAYrB,CAAZ,GAAgBgb,SAAhB;AACA1M,cAAQ,CAACjN,CAAD,CAAR,CAAY6I,KAAZ,GAAoB0D,UAApB;AACD;AACF,GAjBD;AAmBAtM,QAAM,CAACsZ,gBAAP,CAAwB,SAAxB,EAAmC,YAAM;AACvCtM,YAAQ,CAAC,CAAD,CAAR,CAAYiF,IAAZ,GAAmB,KAAnB;AACD,GAFD;AAIAjS,QAAM,CAACsZ,gBAAP,CAAwB,UAAxB,EAAoC,UAAA1U,CAAC,EAAI;AACvC,QAAMkV,OAAO,GAAGlV,CAAC,CAACqV,cAAlB;;AACA,SAAK,IAAIla,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+Z,OAAO,CAACna,MAA5B,EAAoCI,CAAC,EAArC;AACE,WAAK,IAAIma,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlN,QAAQ,CAACrN,MAA7B,EAAqCua,CAAC,EAAtC;AACE,YAAIJ,OAAO,CAAC/Z,CAAD,CAAP,CAAWia,UAAX,IAAyBhN,QAAQ,CAACkN,CAAD,CAAR,CAAYvX,EAAzC,EAA6CqK,QAAQ,CAACkN,CAAD,CAAR,CAAYjI,IAAZ,GAAmB,KAAnB;AAD/C;AADF;AAGD,GALD;AAOA,SAAO;AAAEwF,UAAM,EAANA,MAAF;AAAUnO,SAAK,EAALA;AAAV,GAAP;AACD;;;;;;;;;;;;;;ACh8BD;AAAA;AAAA,IAAI6Q,UAAU,GAAGC,mBAAO,CAAC,yDAAD,CAAxB;;AACA,IAAIC,iBAAiB,GAAGD,mBAAO,CAAC,+CAAD,CAA/B;;AACA,IAAIE,mBAAmB,GAAGF,mBAAO,CAAC,mDAAD,CAAjC;;AACA,IAAIG,iBAAiB,GAAGH,mBAAO,CAAC,+CAAD,CAA/B;;AACA,IAAII,oCAAoC,GAAGJ,mBAAO,CAAC,+EAAD,CAAlD;;AACA,IAAIK,qBAAqB,GAAGL,mBAAO,CAAC,uDAAD,CAAnC;;AACA,IAAIM,sBAAsB,GAAGN,mBAAO,CAAC,yDAAD,CAApC;;AACA,IAAIO,gBAAgB,GAAGP,mBAAO,CAAC,6CAAD,CAA9B;;AACA,IAAIQ,qBAAqB,GAAGR,mBAAO,CAAC,uDAAD,CAAnC;;AACA,IAAIS,oBAAoB,GAAGT,mBAAO,CAAC,qDAAD,CAAlC;;AACA,IAAIU,4BAA4B,GAAGV,mBAAO,CAAC,qEAAD,CAA1C;;AACA,IAAIW,uBAAuB,GAAGX,mBAAO,CAAC,2DAAD,CAArC;;AAEA,SAAS/M,cAAT,CAAwBF,EAAxB,EAA4B;AAC1B,WAAS6N,aAAT,CAAuBpL,IAAvB,EAA6BqL,MAA7B,EAAqC;AACnC,QAAMC,MAAM,GAAG/N,EAAE,CAACgO,YAAH,CAAgBvL,IAAhB,CAAf;AACAzC,MAAE,CAACiO,YAAH,CAAgBF,MAAhB,EAAwBD,MAAxB;AACA9N,MAAE,CAAC6N,aAAH,CAAiBE,MAAjB;AAEA,QAAI,CAAC/N,EAAE,CAACkO,kBAAH,CAAsBH,MAAtB,EAA8B/N,EAAE,CAACmO,cAAjC,CAAL,EACE,MAAMnO,EAAE,CAACoO,gBAAH,CAAoBL,MAApB,CAAN;AAEF,WAAOA,MAAP;AACD;;AAED,MAAM5N,gBAAgB,GAAG0N,aAAa,CAAC7N,EAAE,CAACqO,aAAJ,EAAmBrB,UAAnB,CAAtC;AACA,MAAM5M,WAAW,GAAGyN,aAAa,CAAC7N,EAAE,CAACsO,eAAJ,EAAqBpB,iBAArB,CAAjC;AACA,MAAM7M,aAAa,GAAGwN,aAAa,CAAC7N,EAAE,CAACsO,eAAJ,EAAqBnB,mBAArB,CAAnC;AACA,MAAM7M,WAAW,GAAGuN,aAAa,CAAC7N,EAAE,CAACsO,eAAJ,EAAqBlB,iBAArB,CAAjC;AACA,MAAM7M,8BAA8B,GAAGsN,aAAa,CAClD7N,EAAE,CAACsO,eAD+C,EAElDjB,oCAFkD,CAApD;AAIA,MAAM7M,eAAe,GAAGqN,aAAa,CACnC7N,EAAE,CAACsO,eADgC,EAEnChB,qBAFmC,CAArC;AAIA,MAAM7M,gBAAgB,GAAGoN,aAAa,CACpC7N,EAAE,CAACsO,eADiC,EAEpCf,sBAFoC,CAAtC;AAIA,MAAM7M,UAAU,GAAGmN,aAAa,CAAC7N,EAAE,CAACsO,eAAJ,EAAqBd,gBAArB,CAAhC;AACA,MAAM7M,eAAe,GAAGkN,aAAa,CACnC7N,EAAE,CAACsO,eADgC,EAEnCb,qBAFmC,CAArC;AAIA,MAAM7M,cAAc,GAAGiN,aAAa,CAClC7N,EAAE,CAACsO,eAD+B,EAElCZ,oBAFkC,CAApC;AAIA,MAAM7M,sBAAsB,GAAGgN,aAAa,CAC1C7N,EAAE,CAACsO,eADuC,EAE1CX,4BAF0C,CAA5C;AAIA,MAAM7M,iBAAiB,GAAG+M,aAAa,CACrC7N,EAAE,CAACsO,eADkC,EAErCV,uBAFqC,CAAvC;AAKA,SAAO;AACLzN,oBAAgB,EAAhBA,gBADK;AAELC,eAAW,EAAXA,WAFK;AAGLC,iBAAa,EAAbA,aAHK;AAILC,eAAW,EAAXA,WAJK;AAKLC,kCAA8B,EAA9BA,8BALK;AAMLC,mBAAe,EAAfA,eANK;AAOLC,oBAAgB,EAAhBA,gBAPK;AAQLC,cAAU,EAAVA,UARK;AASLC,mBAAe,EAAfA,eATK;AAULC,kBAAc,EAAdA,cAVK;AAWLC,0BAAsB,EAAtBA,sBAXK;AAYLC,qBAAiB,EAAjBA;AAZK,GAAP;AAcD;;;;;;;;;;;;;;;;;;;;;;ACzED,IAAMyN,GAAG,GAAG;AAAA;AAAA;AACV,oBAAc;AAAA;;AACZ,SAAKA,GAAL,GAAWta,QAAQ,CAACC,cAAT,CAAwB,KAAxB,CAAX;AACA,SAAKsa,MAAL,GAAc,EAAd;AACA,SAAKC,kBAAL,GAA0BC,WAAW,CAAC7E,GAAZ,EAA1B;AACD;;AALS;AAAA;AAAA,6BAOD;AACP;AACA;AACA,UAAMA,GAAG,GAAG6E,WAAW,CAAC7E,GAAZ,EAAZ;AACA,UAAM8E,KAAK,GAAG9E,GAAG,GAAG,KAAK4E,kBAAzB;AACA,WAAKA,kBAAL,GAA0B5E,GAA1B;AACA,UAAM0E,GAAG,GAAI,IAAII,KAAL,GAAc,IAA1B,CANO,CAQP;;AACA,WAAKH,MAAL,CAAYlc,IAAZ,CAAiBic,GAAjB;;AACA,UAAI,KAAKC,MAAL,CAAYhc,MAAZ,GAAqB,EAAzB,EAA6B;AAC3B,aAAKgc,MAAL,CAAYI,KAAZ;AACD,OAZM,CAcP;;;AACA,UAAInE,GAAG,GAAGoE,QAAV;AACA,UAAIC,GAAG,GAAG,CAACD,QAAX;AACA,UAAIE,GAAG,GAAG,CAAV;;AACA,WAAK,IAAInc,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK4b,MAAL,CAAYhc,MAAhC,EAAwCI,CAAC,EAAzC,EAA6C;AAC3Cmc,WAAG,IAAI,KAAKP,MAAL,CAAY5b,CAAZ,CAAP;AACA6X,WAAG,GAAGva,IAAI,CAACua,GAAL,CAAS,KAAK+D,MAAL,CAAY5b,CAAZ,CAAT,EAAyB6X,GAAzB,CAAN;AACAqE,WAAG,GAAG5e,IAAI,CAAC4e,GAAL,CAAS,KAAKN,MAAL,CAAY5b,CAAZ,CAAT,EAAyBkc,GAAzB,CAAN;AACD;;AACD,UAAIE,IAAI,GAAGD,GAAG,GAAG,KAAKP,MAAL,CAAYhc,MAA7B,CAvBO,CAyBP;;AACA,WAAK+b,GAAL,CAASU,WAAT,iBAA8B/e,IAAI,CAACgf,KAAL,CAAWF,IAAX,CAA9B;AACD;AAlCS;;AAAA;AAAA,MAAZ;;;;;;;;;;;;ACAA,0CAA0C,8BAA8B,sCAAsC,8BAA8B,4BAA4B,0BAA0B,yBAAyB,mBAAmB,4BAA4B,eAAe,qEAAqE,iDAAiD,yBAAyB,mBAAmB,KAAK,+EAA+E,yBAAyB,GAAG,G;;;;;;;;;;;ACA3iB,wCAAwC,8BAA8B,sCAAsC,8BAA8B,4BAA4B,0BAA0B,yBAAyB,mBAAmB,4BAA4B,4CAA4C,YAAY,iCAAiC,wBAAwB,kCAAkC,mCAAmC,mCAAmC,mCAAmC,mCAAmC,uBAAuB,oDAAoD,GAAG,eAAe,qEAAqE,4CAA4C,yBAAyB,mBAAmB,KAAK,0EAA0E,yBAAyB,GAAG,C;;;;;;;;;;;ACA54B,wCAAwC,8BAA8B,8CAA8C,mBAAmB,kBAAkB,kBAAkB,kBAAkB,kBAAkB,yBAAyB,eAAe,gCAAgC,sCAAsC,sCAAsC,sCAAsC,sCAAsC,4CAA4C,GAAG,G;;;;;;;;;;;ACA9d,wCAAwC,8BAA8B,sCAAsC,6BAA6B,0BAA0B,sBAAsB,eAAe,6CAA6C,qBAAqB,yBAAyB,uEAAuE,GAAG,C;;;;;;;;;;;ACA7W,wCAAwC,8BAA8B,sCAAsC,kBAAkB,kBAAkB,kBAAkB,kBAAkB,8BAA8B,eAAe,yCAAyC,yCAAyC,yCAAyC,yCAAyC,oCAAoC,kDAAkD,GAAG,C;;;;;;;;;;;ACA9d,wCAAwC,8BAA8B,sCAAsC,6BAA6B,eAAe,oDAAoD,iBAAiB,4BAA4B,8BAA8B,kCAAkC,oBAAoB,oCAAoC,GAAG,G;;;;;;;;;;;ACApX,wCAAwC,8BAA8B,sCAAsC,kBAAkB,kBAAkB,kBAAkB,kBAAkB,8BAA8B,mCAAmC,qCAAqC,qBAAqB,iBAAiB,0BAA0B,KAAK,qBAAqB,iBAAiB,0BAA0B,KAAK,qBAAqB,iBAAiB,0BAA0B,KAAK,qBAAqB,iBAAiB,0BAA0B,KAAK,oDAAoD,GAAG,eAAe,mCAAmC,mCAAmC,mCAAmC,mCAAmC,sCAAsC,4CAA4C,GAAG,G;;;;;;;;;;;ACAr1B,wCAAwC,8BAA8B,sCAAsC,kBAAkB,kBAAkB,kBAAkB,kBAAkB,8BAA8B,8BAA8B,0BAA0B,2BAA2B,+BAA+B,gCAAgC,cAAc,GAAG,eAAe,mDAAmD,mDAAmD,mDAAmD,mDAAmD,iDAAiD,yCAAyC,gFAAgF,sCAAsC,8BAA8B,4CAA4C,mEAAmE,0BAA0B,KAAK,8CAA8C,OAAO,OAAO,iCAAiC,KAAK,iCAAiC,4CAA4C,GAAG,C;;;;;;;;;;;ACA9nC,wCAAwC,8BAA8B,sCAAsC,kBAAkB,kBAAkB,kBAAkB,kBAAkB,8BAA8B,gCAAgC,6BAA6B,gCAAgC,cAAc,GAAG,eAAe,mDAAmD,mDAAmD,mDAAmD,mDAAmD,0CAA0C,qDAAqD,yDAAyD,iDAAiD,GAAG,C;;;;;;;;;;;ACAvuB,wCAAwC,qCAAqC,oBAAoB,0BAA0B,0BAA0B,+BAA+B,yBAAyB,oBAAoB,mDAAmD,kDAAkD,qDAAqD,6DAA6D,GAAG,obAAob,gDAAgD,GAAG,6BAA6B,gDAAgD,GAAG,8BAA8B,2CAA2C,GAAG,qCAAqC,mDAAmD,GAAG,iCAAiC,4CAA4C,iDAAiD,2DAA2D,uCAAuC,0DAA0D,yBAAyB,sCAAsC,sCAAsC,uCAAuC,qCAAqC,qCAAqC,qCAAqC,8BAA8B,8BAA8B,oDAAoD,4EAA4E,uMAAuM,4KAA4K,qDAAqD,iDAAiD,gDAAgD,mCAAmC,iDAAiD,gCAAgC,mCAAmC,mCAAmC,iCAAiC,mDAAmD,iDAAiD,kCAAkC,kCAAkC,kCAAkC,2CAA2C,6CAA6C,oCAAoC,8BAA8B,kCAAkC,kCAAkC,0HAA0H,qBAAqB,iBAAiB,iBAAiB,iBAAiB,8GAA8G,cAAc,0HAA0H,KAAK,2ZAA2Z,gDAAgD,GAAG,6BAA6B,gDAAgD,GAAG,+BAA+B,wCAAwC,GAAG,kCAAkC,8OAA8O,sEAAsE,qCAAqC,gCAAgC,gCAAgC,mDAAmD,yDAAyD,mCAAmC,kCAAkC,mCAAmC,gCAAgC,iBAAiB,yCAAyC,qJAAqJ,wFAAwF,aAAa,aAAa,6LAA6L,0BAA0B,6BAA6B,qBAAqB,yGAAyG,+DAA+D,gDAAgD,uCAAuC,0CAA0C,6BAA6B,GAAG,2CAA2C,8BAA8B,6BAA6B,iCAAiC,4CAA4C,mCAAmC,gCAAgC,GAAG,2CAA2C,eAAe,qCAAqC,sDAAsD,sDAAsD,0DAA0D,mEAAmE,6CAA6C,0CAA0C,oBAAoB,2BAA2B,yCAAyC,2EAA2E,kBAAkB,sBAAsB,gBAAgB,uBAAuB,sBAAsB,cAAc,uBAAuB,0BAA0B,yBAAyB,gBAAgB,OAAO,KAAK,sBAAsB,gBAAgB,uBAAuB,sBAAsB,KAAK,sBAAsB,gBAAgB,uBAAuB,uBAAuB,KAAK,sBAAsB,yBAAyB,oDAAoD,KAAK,sBAAsB,uBAAuB,uBAAuB,wCAAwC,KAAK,sBAAsB,yBAAyB,uBAAuB,KAAK,sBAAsB,mCAAmC,uBAAuB,iEAAiE,KAAK,sBAAsB,mCAAmC,uBAAuB,qCAAqC,KAAK,sBAAsB,mCAAmC,oDAAoD,KAAK,sBAAsB,uBAAuB,uBAAuB,qCAAqC,KAAK,uBAAuB,wBAAwB,uBAAuB,sBAAsB,KAAK,uBAAuB,yBAAyB,uBAAuB,KAAK,uBAAuB,yBAAyB,uBAAuB,oDAAoD,KAAK,uBAAuB,2CAA2C,uBAAuB,wCAAwC,KAAK,uBAAuB,+CAA+C,uBAAuB,sBAAsB,KAAK,uBAAuB,wBAAwB,uBAAuB,sBAAsB,KAAK,uBAAuB,6CAA6C,yBAAyB,sBAAsB,KAAK,uBAAuB,0BAA0B,gCAAgC,sBAAsB,KAAK,uBAAuB,4CAA4C,yCAAyC,2BAA2B,uCAAuC,KAAK,uBAAuB,mEAAmE,uDAAuD,uCAAuC,KAAK,8BAA8B,+EAA+E,KAAK,0DAA0D,kCAAkC,GAAG,C;;;;;;;;;;;ACAv+R,sFAAsF,6CAA6C,kBAAkB,eAAe,kBAAkB,uCAAuC,GAAG,C;;;;;;;;;;;ACAhO,wCAAwC,8BAA8B,sCAAsC,4BAA4B,4BAA4B,qBAAqB,qBAAqB,uBAAuB,eAAe,4BAA4B,uBAAuB,kDAAkD,4CAA4C,2CAA2C,GAAG,C;;;;;;;;;;;ACAnb,wCAAwC,8BAA8B,sCAAsC,6BAA6B,8BAA8B,eAAe,yCAAyC,0CAA0C,yBAAyB,8BAA8B,6BAA6B,eAAe,6BAA6B,qBAAqB,iCAAiC,GAAG,G;;;;;;;;;;;ACAlc,wCAAwC,8BAA8B,sCAAsC,kBAAkB,kBAAkB,8BAA8B,0BAA0B,qBAAqB,mBAAmB,eAAe,qCAAqC,qCAAqC,sCAAsC,4CAA4C,sDAAsD,4CAA4C,oDAAoD,GAAG,C;;;;;;;;;;;;ACApjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEA,IAAInc,MAAM,CAACsc,MAAX,EAAmB;AACjBjW,SAAO,CAACkW,SAAR,CAAkB,IAAlB,EAAwB,IAAxB,EAA8B1b,QAAQ,CAAC2b,IAAvC;;AACAxc,QAAM,CAACyc,UAAP,GAAoB,UAAS5W,KAAT,EAAgB;AAClCQ,WAAO,CAACqW,EAAR,CAAW,CAAX;AACD,GAFD;AAGD;;AAED,SAASC,oBAAT,GAAgC;AAC9B,MAAIC,KAAK,GAAG,KAAZ;;AACA,GAAC,UAASC,CAAT,EAAY;AACX,QACE,sVAAsVC,IAAtV,CACED,CADF,KAGA,0kDAA0kDC,IAA1kD,CACED,CAAC,CAACE,MAAF,CAAS,CAAT,EAAY,CAAZ,CADF,CAJF,EAQEH,KAAK,GAAG,IAAR;AACH,GAVD,EAUGI,SAAS,CAACC,SAAV,IAAuBD,SAAS,CAACE,MAAjC,IAA2Cld,MAAM,CAACmd,KAVrD;;AAWA,SAAOP,KAAP;AACD;;AAED,IAAID,oBAAoB,EAAxB,EAA4B;AAC1B3c,QAAM,CAACod,cAAP,GAAwB,YAAW;AACjC,WAAO,IAAP;AACD,GAFD;AAGD;;AAED,IAAI,mBAAmBJ,SAAvB,EAAkC;AAChChd,QAAM,CAACsZ,gBAAP,CAAwB,MAAxB,EAAgC,YAAM;AACpC0D,aAAS,CAACK,aAAV,CACGC,QADH,CACY,oBADZ,EAEGnZ,IAFH,CAEQ,UAAAoZ,YAAY,EAAI;AACpB1Y,aAAO,CAACC,GAAR,CAAY,iBAAZ,EAA+ByY,YAA/B;AACD,KAJH,WAKS,UAAAC,iBAAiB,EAAI;AAC1B3Y,aAAO,CAACC,GAAR,CAAY,0BAAZ,EAAwC0Y,iBAAxC;AACD,KAPH;AAQD,GATD;AAUD;;AAED,IAAIvR,CAAC,GAAG,GAAR;AACA,IAAMzC,QAAQ,GAAGhL,mDAAQ,OAAR,CAAayN,CAAb,EAAgBA,CAAhB,CAAjB;AAEA,IAAIjN,KAAK,GAAGiN,CAAZ;AACA,IAAIhN,MAAM,GAAGgN,CAAb;AACA,IAAMtC,MAAM,GAAGvI,QAAQ,CAACC,cAAT,CAAwB,aAAxB,CAAf;AACA,IAAMoc,OAAO,GAAGrc,QAAQ,CAACC,cAAT,CAAwB,cAAxB,CAAhB;AAEAsI,MAAM,CAAC1K,MAAP,GAAgBgN,CAAhB;AACAtC,MAAM,CAAC3K,KAAP,GAAeiN,CAAf;AAEA7K,QAAQ,CAACC,cAAT,CAAwB,YAAxB,EAAsCiY,gBAAtC,CAAuD,WAAvD,EAAoE,UAAA1U,CAAC,EAAI;AACvE,MAAI,CAAC5E,MAAM,CAAC2D,MAAZ,EAAoB;AAClB,QAAIiB,CAAC,CAACiV,UAAN,EAAkB;AAChBjV,OAAC,CAACkB,cAAF;AACD;AACF;AACF,CAND;AAQA,IAAM4X,EAAE,GAAGtc,QAAQ,CAACC,cAAT,CAAwB,IAAxB,CAAX;;AAEA,IAAI+X,MAAM,GAAG,SAATA,MAAS,GAAM;AACjB,MAAIuE,YAAY,GAAG3d,MAAM,CAAC4d,UAA1B;AACA,MAAIC,QAAQ,GAAG,EAAf;AACA,MAAIC,aAAa,GAAG9d,MAAM,CAAC+d,WAAP,GAAqBF,QAAzC;AAEA,MAAIG,WAAW,GAAG,EAAlB;AACA,MAAIC,OAAO,GAAG,EAAd;;AACA,MAAIN,YAAY,GAAGG,aAAnB,EAAkC;AAChC,QAAIH,YAAY,GAAG3d,MAAM,CAAC+d,WAAtB,GAAoC,GAAxC,EAA6C;AAC3C;AAEAC,iBAAW,qBAAche,MAAM,CAAC+d,WAArB,mBAAX;AACAE,aAAO,oBAAaN,YAAY,GAC9B3d,MAAM,CAAC+d,WADW,GAElB,EAFK,qBAAP;AAGD,KAPD,MAOO;AACL;AACAC,iBAAW,qBAAche,MAAM,CAAC+d,WAArB,OAAX;AACAE,aAAO,oBAAa,CAACN,YAAY,GAAG3d,MAAM,CAAC+d,WAAvB,IAAsC,CAAtC,GAClB,CADK,qBAAP;AAED;AACF,GAdD,MAcO;AACL;AACAC,eAAW,oBAAaL,YAAb,oBAAX;AACAM,WAAO,GAAG,EAAV;AACD;;AACDP,IAAE,CAACQ,KAAH,GAAWD,OAAX;AACAtU,QAAM,CAACuU,KAAP,GAAeF,WAAf;AACAP,SAAO,CAACS,KAAR,GAAgBF,WAAhB;AACD,CA7BD;;AA+BA5E,MAAM;AACNpZ,MAAM,CAACsZ,gBAAP,CAAwB,mBAAxB,EAA6CF,MAA7C,EAAqD,IAArD;AACApZ,MAAM,CAACsZ,gBAAP,CAAwB,QAAxB,EAAkCF,MAAlC;AAEA,IAAI+E,KAAK,GAAG5R,yDAAU,CAAC;AAAE/C,UAAQ,EAARA;AAAF,CAAD,CAAtB;AAEA,IAAI4U,QAAQ,GAAGC,0DAAU,CAAC;AAAE1U,QAAM,EAANA,MAAF;AAAUH,UAAQ,EAARA;AAAV,CAAD,CAAzB;;AAEA,IAAM8U,UAAU,GAAG,SAAbA,UAAa,GAAM;AACvB,MAAI,CAACte,MAAM,CAAC2D,MAAZ,EAAoB;AAClB+X,4CAAG,CAACva,MAAJ,GADkB,CACJ;;AACdqI,YAAQ,CAAC+U,IAAT;AACAJ,SAAK,CAAC1G,MAAN;AACD;;AACD2G,UAAQ;AAERpe,QAAM,CAACwe,WAAP,GAAqBC,qBAAqB,CAACH,UAAD,CAA1C;AACD,CATD;;AAWAA,UAAU;;AAEV,SAAShV,KAAT,GAAiB;AACf6U,OAAK,CAAC7U,KAAN;AACA6U,OAAK,CAAC1G,MAAN;AACA0G,OAAK,CAAC7U,KAAN;AACA6U,OAAK,CAAC1G,MAAN;AAEAjO,UAAQ,CAACF,KAAT;AACD;;AACDtJ,MAAM,CAAC0e,CAAP,GAAWlV,QAAX;;;;;;;;;;;;;ACpIA;AAAA;AAAA;AAAA;AACA;AACA,IAAMG,MAAM,GAAGvI,QAAQ,CAACC,cAAT,CAAwB,aAAxB,CAAf;;AAEA,IAAMsd,aAAa,GAAG,SAAhBA,aAAgB,CAAC9B,CAAD,EAAI+B,CAAJ,EAAU;AAC9B,SAAOvhB,IAAI,CAACwhB,IAAL,CACLxhB,IAAI,CAACyhB,GAAL,CAASjC,CAAC,CAACrD,OAAF,GAAYoF,CAAC,CAACpF,OAAvB,EAAgC,CAAhC,IAAqCnc,IAAI,CAACyhB,GAAL,CAASjC,CAAC,CAAClD,OAAF,GAAYiF,CAAC,CAACjF,OAAvB,EAAgC,CAAhC,CADhC,EAEL,CAFK,CAAP;AAID,CALD;;AAOA,IAAMoF,SAAS,GAAG,SAAZA,SAAY,CAAAlC,CAAC,EAAI;AACrB,SAAOxf,IAAI,CAACwhB,IAAL,CAAUxhB,IAAI,CAACyhB,GAAL,CAASjC,CAAC,CAACrD,OAAX,EAAoB,CAApB,IAAyBnc,IAAI,CAACyhB,GAAL,CAASjC,CAAC,CAAClD,OAAX,EAAoB,CAApB,CAAnC,EAA2D,CAA3D,CAAP;AACD,CAFD;;AAIA,IAAMqF,IAAI,GAAG,SAAPA,IAAO,CAAAnC,CAAC,EAAI;AAChB,MAAIoC,GAAG,GAAGF,SAAS,CAAClC,CAAD,CAAnB;AACA,SAAO;AAAErD,WAAO,EAAEqD,CAAC,CAACrD,OAAF,GAAYyF,GAAvB;AAA4BtF,WAAO,EAAEkD,CAAC,CAAClD,OAAF,GAAYsF;AAAjD,GAAP;AACD,CAHD;;AAIA,IAAMC,KAAK,GAAG,SAARA,KAAQ,CAACrC,CAAD,EAAIsC,CAAJ,EAAU;AACtB,SAAO;AAAE3F,WAAO,EAAEqD,CAAC,CAACrD,OAAF,GAAY2F,CAAvB;AAA0BxF,WAAO,EAAEkD,CAAC,CAAClD,OAAF,GAAYwF;AAA/C,GAAP;AACD,CAFD;;AAGA,IAAM9N,GAAG,GAAG,SAANA,GAAM,CAACwL,CAAD,EAAI+B,CAAJ,EAAU;AACpB,SAAO;AAAEpF,WAAO,EAAEqD,CAAC,CAACrD,OAAF,GAAYoF,CAAC,CAACpF,OAAzB;AAAkCG,WAAO,EAAEkD,CAAC,CAAClD,OAAF,GAAYiF,CAAC,CAACjF;AAAzD,GAAP;AACD,CAFD;;AAGA,IAAMyF,GAAG,GAAG,SAANA,GAAM,CAACvC,CAAD,EAAI+B,CAAJ,EAAU;AACpB,SAAO;AAAEpF,WAAO,EAAEqD,CAAC,CAACrD,OAAF,GAAYoF,CAAC,CAACpF,OAAzB;AAAkCG,WAAO,EAAEkD,CAAC,CAAClD,OAAF,GAAYiF,CAAC,CAACjF;AAAzD,GAAP;AACD,CAFD;;AAIA,IAAI0F,QAAQ,GAAG,KAAf;AACA,IAAIC,SAAS,GAAG,IAAhB;AACA,IAAIC,MAAM,GAAG,IAAb;AAEA5V,MAAM,CAAC2P,gBAAP,CAAwB,WAAxB,EAAqC,UAAAzT,KAAK,EAAI;AAC5CA,OAAK,CAACC,cAAN;AACA0D,oDAAQ,CAACiC,SAAT;AACA4T,UAAQ,GAAG,IAAX;AACAG,eAAa,CAACD,MAAD,CAAb;AACAA,QAAM,GAAGvf,MAAM,CAACyf,WAAP,CAAmB;AAAA,WAAMC,KAAK,CAAC7Z,KAAD,CAAX;AAAA,GAAnB,EAAuC,GAAvC,CAAT;AACA6Z,OAAK,CAAC7Z,KAAD,CAAL;AACAyZ,WAAS,GAAGzZ,KAAZ;AACD,CARD;AAUAzE,QAAQ,CAACkJ,IAAT,CAAcgP,gBAAd,CAA+B,SAA/B,EAA0C,UAAAzT,KAAK,EAAI;AACjD2Z,eAAa,CAACD,MAAD,CAAb;;AACA,MAAIF,QAAJ,EAAc;AACZxZ,SAAK,CAACC,cAAN;AACAwZ,aAAS,GAAG,IAAZ;AACAD,YAAQ,GAAG,KAAX;AACD;AACF,CAPD;AASA1V,MAAM,CAAC2P,gBAAP,CAAwB,WAAxB,EAAqC,UAAAzT,KAAK,EAAI;AAC5C2Z,eAAa,CAACD,MAAD,CAAb;AACAI,aAAW,CAAC9Z,KAAD,CAAX;AACD,CAHD;AAKA8D,MAAM,CAAC2P,gBAAP,CAAwB,YAAxB,EAAsC,UAAAzT,KAAK,EAAI;AAC7C2Z,eAAa,CAACD,MAAD,CAAb;AACAD,WAAS,GAAG,IAAZ;AACD,CAHD;AAKA3V,MAAM,CAAC2P,gBAAP,CAAwB,YAAxB,EAAsC,UAAAzT,KAAK,EAAI;AAC7C2D,oDAAQ,CAACiC,SAAT;;AACA,MAAI5F,KAAK,CAACgU,UAAV,EAAsB;AACpBhU,SAAK,CAACC,cAAN;AACD;;AACDuZ,UAAQ,GAAG,IAAX;AACAC,WAAS,GAAGzZ,KAAZ;AACA+Z,eAAa,CAAC/Z,KAAD,CAAb;AACD,CARD;AAUA8D,MAAM,CAAC2P,gBAAP,CAAwB,UAAxB,EAAoC,UAAAzT,KAAK,EAAI;AAC3C,MAAIA,KAAK,CAACgU,UAAV,EAAsB;AACpBhU,SAAK,CAACC,cAAN;AACD;;AACDwZ,WAAS,GAAG,IAAZ;AACAD,UAAQ,GAAG,KAAX;AACAG,eAAa,CAACD,MAAD,CAAb;AACD,CAPD;AASA5V,MAAM,CAAC2P,gBAAP,CAAwB,WAAxB,EAAqC,UAAAzT,KAAK,EAAI;AAC5C,MAAI,CAAC7F,MAAM,CAAC2D,MAAZ,EAAoB;AAClB,QAAIkC,KAAK,CAACgU,UAAV,EAAsB;AACpBhU,WAAK,CAACC,cAAN;AACD;AACF;;AACD0Z,eAAa,CAACD,MAAD,CAAb;AACAK,eAAa,CAAC/Z,KAAD,CAAb;AACD,CARD;;AAUA,SAAS8Z,WAAT,CAAqB9Z,KAArB,EAA4B;AAC1B2Z,eAAa,CAACD,MAAD,CAAb;AACAA,QAAM,GAAGvf,MAAM,CAACyf,WAAP,CAAmB;AAAA,WAAMC,KAAK,CAAC7Z,KAAD,CAAX;AAAA,GAAnB,EAAuC,GAAvC,CAAT;AACA,MAAIga,UAAU,GAAG;AAAErG,WAAO,EAAE3T,KAAK,CAAC2T,OAAjB;AAA0BG,WAAO,EAAE9T,KAAK,CAAC8T;AAAzC,GAAjB;;AACA,MAAI,CAAC0F,QAAL,EAAe;AACb;AACD;;AACD,MAAI1gB,IAAI,GAAG+B,sDAAO,CAACV,MAAM,CAAC8C,EAAP,CAAUY,KAAV,CAAgB/E,IAAjB,CAAlB;AACA,MAAIoB,CAAC,GAAG,CAAR;AACA2f,OAAK,CAACG,UAAD,CAAL;;AACA,MAAIP,SAAJ,EAAe;AACb,WAAOX,aAAa,CAACkB,UAAD,EAAaP,SAAb,CAAb,GAAuC3gB,IAAI,GAAG,CAArD,EAAwD;AACtD,UAAImhB,CAAC,GAAGnB,aAAa,CAACkB,UAAD,EAAaP,SAAb,CAArB;AACAO,gBAAU,GAAGxO,GAAG,CACdwO,UADc,EAEdX,KAAK,CAACF,IAAI,CAACI,GAAG,CAACE,SAAD,EAAYzZ,KAAZ,CAAJ,CAAL,EAA8BxI,IAAI,CAACua,GAAL,CAASjZ,IAAI,GAAG,CAAhB,EAAmBmhB,CAAnB,CAA9B,CAFS,CAAhB;AAIA/f,OAAC;;AACD,UAAIA,CAAC,GAAG,IAAR,EAAc;AACZ;AACD;;AACD2f,WAAK,CAACG,UAAD,CAAL;AACD;AACF;;AACDP,WAAS,GAAGzZ,KAAZ;AACD;;AAED,IAAM+Z,aAAa,GAAG,SAAhBA,aAAgB,CAAA/Z,KAAK,EAAI;AAC7B,MAAIiU,OAAO,GAAGxa,KAAK,CAACygB,IAAN,CAAWla,KAAK,CAACiU,OAAjB,CAAd;;AACA,MAAIA,OAAO,CAACna,MAAR,IAAkB,CAAtB,EAAyB;AACvBggB,eAAW,CAAC7F,OAAO,CAAC,CAAD,CAAR,CAAX;AACD,GAFD,MAEO;AACLA,WAAO,CAACkG,OAAR,CAAgBN,KAAhB;AACD;AACF,CAPD;;AASA,IAAMA,KAAK,GAAG,SAARA,KAAQ,CAAA7Z,KAAK,EAAI;AACrB,MAAI,CAACwZ,QAAL,EAAe;AACb;AACD;;AACD,MAAMpG,YAAY,GAAGtP,MAAM,CAAC0P,qBAAP,EAArB;AAEA,MAAMH,MAAM,GAAGvP,MAAM,CAAC3K,KAAP,GAAegB,MAAM,CAACigB,gBAAtB,GAAyChH,YAAY,CAACja,KAArE;AACA,MAAMma,MAAM,GAAGxP,MAAM,CAAC1K,MAAP,GAAgBe,MAAM,CAACigB,gBAAvB,GAA0ChH,YAAY,CAACha,MAAtE;AAEA,MAAMsa,UAAU,GAAG,CAAC1T,KAAK,CAAC2T,OAAN,GAAgBP,YAAY,CAACQ,IAA9B,IAAsCP,MAAzD;AACA,MAAMQ,SAAS,GAAG,CAAC7T,KAAK,CAAC8T,OAAN,GAAgBV,YAAY,CAACW,GAA9B,IAAqCT,MAAvD;AAEA,MAAM1a,CAAC,GAAGpB,IAAI,CAACua,GAAL,CAASva,IAAI,CAAC6iB,KAAL,CAAW3G,UAAX,CAAT,EAAiCva,+CAAK,GAAG,CAAzC,CAAV;AACA,MAAMN,CAAC,GAAGrB,IAAI,CAACua,GAAL,CAASva,IAAI,CAAC6iB,KAAL,CAAWxG,SAAX,CAAT,EAAgCza,gDAAM,GAAG,CAAzC,CAAV;AACA,MAAIe,MAAM,CAAC8C,EAAP,CAAUY,KAAV,CAAgB+E,eAAhB,GAAkC,CAAtC,EAAyC;AACzCe,oDAAQ,CAACkW,KAAT,CACEjhB,CADF,EAEEC,CAFF,EAGEgC,sDAAO,CAACV,MAAM,CAAC8C,EAAP,CAAUY,KAAV,CAAgB/E,IAAjB,CAHT,EAIEqB,MAAM,CAAC8C,EAAP,CAAUY,KAAV,CAAgB+E,eAJlB;AAMD,CArBD,C;;;;;;;;;;;;;;;;;;;;;;;;;;AC/HA,IAAM0X,WAAW,GAAG/F,mBAAO,CAAC,8CAAD,CAA3B;;AACA;AACA;AACA;;AAEA,IAAIgG,GAAG,GAAGhG,mBAAO,CAAC,6CAAD,CAAjB;;AACA,IAAIiG,GAAG,GAAGjG,mBAAO,CAAC,yDAAD,CAAjB;;AAEA,IAAIiE,UAAU,GAAG,SAAbA,UAAa,OAA8C;AAAA,MAA3C1U,MAA2C,QAA3CA,MAA2C;AAAA,MAAnCH,QAAmC,QAAnCA,QAAmC;AAAA,6BAAzB8W,UAAyB;AAAA,MAAzBA,UAAyB,gCAAZ,KAAY;AAC7D,MAAMC,IAAI,GAAGJ,WAAW,CAAC;AACvBxW,UAAM,EAANA,MADuB;AAEvB6W,cAAU,EAAE;AAAEhS,2BAAqB,EAAE8R;AAAzB;AAFW,GAAD,CAAxB,CAD6D,CAK7D;;AACA,MAAMthB,KAAK,GAAGwK,QAAQ,CAACxK,KAAT,EAAd;AACA,MAAMC,MAAM,GAAGuK,QAAQ,CAACvK,MAAT,EAAf;AACA,MAAIyY,YAAY,GAAGlO,QAAQ,CAACC,KAAT,EAAnB;AACA,MAAIA,KAAK,GAAG,IAAI5L,UAAJ,CAAe6L,8DAAM,CAAC/L,MAAtB,EAA8B+Z,YAA9B,EAA4C1Y,KAAK,GAAGC,MAAR,GAAiB,CAA7D,CAAZ;AACA,MAAMwhB,WAAW,GAAGF,IAAI,CAACzQ,OAAL,CAAa;AAAE9Q,SAAK,EAALA,KAAF;AAASC,UAAM,EAANA,MAAT;AAAiBoD,QAAI,EAAEoH;AAAvB,GAAb,CAApB;AAEA,MAAI2U,QAAQ,GAAGmC,IAAI,CAAC;AAClBG,QAAI,EAAEN,GADY;AAElB9N,YAAQ,EAAE;AACR3L,OAAC,EAAE;AAAA,YAAG4X,IAAH,SAAGA,IAAH;AAAA,eAAcA,IAAd;AAAA,OADK;AAERlc,UAAI,EAAE,gBAAM;AACV;AACA;AACA;AACAqV,oBAAY,GAAGlO,QAAQ,CAACC,KAAT,EAAf;AACAA,aAAK,GAAG,IAAI5L,UAAJ,CAAe6L,8DAAM,CAAC/L,MAAtB,EAA8B+Z,YAA9B,EAA4C1Y,KAAK,GAAGC,MAAR,GAAiB,CAA7D,CAAR,CALU,CAMV;;AAEA,eAAOwhB,WAAW,CAAC;AAAEzhB,eAAK,EAALA,KAAF;AAASC,gBAAM,EAANA,MAAT;AAAiBoD,cAAI,EAAEoH;AAAvB,SAAD,CAAlB;AACD,OAXO;AAYRkX,gBAAU,EAAE;AAAA,YAAGC,aAAH,SAAGA,aAAH;AAAA,YAAkBC,cAAlB,SAAkBA,cAAlB;AAAA,eAAuC,CACjDD,aADiD,EAEjDC,cAFiD,CAAvC;AAAA,OAZJ;AAgBRC,SAAG,EAAE9gB,MAAM,CAACigB,gBAAP,GAA0B,CAhBvB;AAiBRK,gBAAU,EAAVA,UAjBQ,CAkBR;;AAlBQ,KAFQ;AAuBlBS,QAAI,EAAEV,GAvBY;AAwBlBG,cAAU,EAAE;AACV;AACAQ,cAAQ,EAAE,CAAC,CAAC,CAAC,CAAF,EAAK,CAAL,CAAD,EAAU,CAAC,CAAC,CAAF,EAAK,CAAC,CAAN,CAAV,EAAoB,CAAC,CAAD,EAAI,CAAC,CAAL,CAApB;AAFA,KAxBM;AA4BlB;AACAC,SAAK,EAAE;AA7BW,GAAD,CAAnB;AAgCA,SAAO,YAAM;AACXV,QAAI,CAACW,IAAL;AACA9C,YAAQ;AACT,GAHD;AAID,CAhDD;;AAkDA,IAAI7U,QAAQ,GAAG,SAAXA,QAAW,CAAAC,QAAQ,EAAI;AACzB,MAAIG,MAAM,GAAGvI,QAAQ,CAACwI,aAAT,CAAuB,QAAvB,CAAb;AACAD,QAAM,CAAC3K,KAAP,GAAewK,QAAQ,CAACxK,KAAT,KAAmB,CAAlC;AACA2K,QAAM,CAAC1K,MAAP,GAAgBuK,QAAQ,CAACvK,MAAT,KAAoB,CAApC;AACA,MAAIkC,MAAM,GAAGkd,UAAU,CAAC;AAAE7U,YAAQ,EAARA,QAAF;AAAYG,UAAM,EAANA,MAAZ;AAAoB2W,cAAU,EAAE;AAAhC,GAAD,CAAvB;AACAnf,QAAM;AAEN,SAAOwI,MAAM,CAACQ,SAAP,CAAiB,WAAjB,CAAP;AACD,CARD;;AAUA,IAAI7B,QAAQ,GAAG,SAAXA,QAAW,GAAM;AACnB,MAAIqB,MAAM,GAAGvI,QAAQ,CAACwI,aAAT,CAAuB,QAAvB,CAAb;AAEA,MAAIhL,OAAO,GAAG7C,MAAM,CAAColB,MAAP,CAAcrlB,4DAAd,CAAd;AACA,MAAIslB,KAAK,GAAG/jB,IAAI,CAAC4e,GAAL,OAAA5e,IAAI,qBAAQuB,OAAR,EAAJ,GAAuB,CAAnC;AACA,MAAI4K,QAAQ,GAAGhL,6DAAQ,OAAR,CAAa4iB,KAAb,EAAoB,CAApB,CAAf;AACAzX,QAAM,CAAC3K,KAAP,GAAeoiB,KAAf;AACAzX,QAAM,CAAC1K,MAAP,GAAgB,CAAhB;AACAuK,UAAQ,CAACF,KAAT;AAEA1K,SAAO,CAACohB,OAAR,CAAgB,UAAArd,EAAE;AAAA,WAAI6G,QAAQ,CAACkW,KAAT,CAAe/c,EAAf,EAAmB,CAAnB,EAAsB,CAAtB,EAAyBA,EAAzB,CAAJ;AAAA,GAAlB;AAEA,MAAIxB,MAAM,GAAGkd,UAAU,CAAC;AAAE7U,YAAQ,EAARA,QAAF;AAAYG,UAAM,EAANA,MAAZ;AAAoB2W,cAAU,EAAE;AAAhC,GAAD,CAAvB;AACAnf,QAAM;AACN,MAAIiK,GAAG,GAAGzB,MAAM,CAACG,UAAP,CAAkB,OAAlB,CAAV;AACA,MAAIzH,IAAI,GAAG,IAAIxE,UAAJ,CAAeujB,KAAK,GAAG,CAAvB,CAAX;AACAhW,KAAG,CAACqN,UAAJ,CAAe,CAAf,EAAkB,CAAlB,EAAqB2I,KAArB,EAA4B,CAA5B,EAA+BhW,GAAG,CAACkE,IAAnC,EAAyClE,GAAG,CAAC4J,aAA7C,EAA4D3S,IAA5D;AACA,MAAIgf,MAAM,GAAG,EAAb;AACAziB,SAAO,CAACohB,OAAR,CAAgB,UAAArd,EAAE,EAAI;AACpB,QAAI2e,KAAK,GAAG3e,EAAE,GAAG,CAAjB;AACA,QAAIiG,KAAK,kBAAWvG,IAAI,CAACif,KAAD,CAAf,cAA0Bjf,IAAI,CAACif,KAAK,GAAG,CAAT,CAA9B,eACPjf,IAAI,CAACif,KAAK,GAAG,CAAT,CADG,YAAT;AAGAD,UAAM,CAAC1e,EAAD,CAAN,GAAaiG,KAAb;AACD,GAND;AAOA,SAAOyY,MAAP;AACD,CA1BD","file":"1.66efd37b27eb127b43ab.js","sourcesContent":["import * as wasm from './sandtable_bg';\n\n/**\n*/\nexport const Species = Object.freeze({ Empty:0,Wall:1,Sand:2,Water:3,Stone:13,Ice:9,Gas:4,Cloner:5,Mite:15,Wood:7,Plant:11,Fungus:18,Seed:19,Fire:6,Lava:8,Acid:12,Dust:14,Oil:16,Rocket:17, });\n\nexport function __wbg_random_58bd29ed438c19c0() {\n    return Math.random();\n}\n\nlet cachedTextDecoder = new TextDecoder('utf-8');\n\nlet cachegetUint8Memory = null;\nfunction getUint8Memory() {\n    if (cachegetUint8Memory === null || cachegetUint8Memory.buffer !== wasm.memory.buffer) {\n        cachegetUint8Memory = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachegetUint8Memory;\n}\n\nfunction getStringFromWasm(ptr, len) {\n    return cachedTextDecoder.decode(getUint8Memory().subarray(ptr, ptr + len));\n}\n\nexport function __wbindgen_throw(ptr, len) {\n    throw new Error(getStringFromWasm(ptr, len));\n}\n\nfunction freeCell(ptr) {\n\n    wasm.__wbg_cell_free(ptr);\n}\n/**\n*/\nexport class Cell {\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n        freeCell(ptr);\n    }\n\n}\n\nfunction freeUniverse(ptr) {\n\n    wasm.__wbg_universe_free(ptr);\n}\n/**\n*/\nexport class Universe {\n\n    static __wrap(ptr) {\n        const obj = Object.create(Universe.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n        freeUniverse(ptr);\n    }\n\n    /**\n    * @returns {void}\n    */\n    reset() {\n        return wasm.universe_reset(this.ptr);\n    }\n    /**\n    * @returns {void}\n    */\n    tick() {\n        return wasm.universe_tick(this.ptr);\n    }\n    /**\n    * @returns {number}\n    */\n    width() {\n        return wasm.universe_width(this.ptr);\n    }\n    /**\n    * @returns {number}\n    */\n    height() {\n        return wasm.universe_height(this.ptr);\n    }\n    /**\n    * @returns {number}\n    */\n    cells() {\n        return wasm.universe_cells(this.ptr);\n    }\n    /**\n    * @returns {number}\n    */\n    winds() {\n        return wasm.universe_winds(this.ptr);\n    }\n    /**\n    * @returns {number}\n    */\n    burns() {\n        return wasm.universe_burns(this.ptr);\n    }\n    /**\n    * @param {number} x\n    * @param {number} y\n    * @param {number} size\n    * @param {number} species\n    * @returns {void}\n    */\n    paint(x, y, size, species) {\n        return wasm.universe_paint(this.ptr, x, y, size, species);\n    }\n    /**\n    * @returns {void}\n    */\n    push_undo() {\n        return wasm.universe_push_undo(this.ptr);\n    }\n    /**\n    * @returns {void}\n    */\n    pop_undo() {\n        return wasm.universe_pop_undo(this.ptr);\n    }\n    /**\n    * @returns {void}\n    */\n    flush_undos() {\n        return wasm.universe_flush_undos(this.ptr);\n    }\n    /**\n    * @param {number} width\n    * @param {number} height\n    * @returns {Universe}\n    */\n    static new(width, height) {\n        return Universe.__wrap(wasm.universe_new(width, height));\n    }\n}\n\nfunction freeWind(ptr) {\n\n    wasm.__wbg_wind_free(ptr);\n}\n/**\n*/\nexport class Wind {\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n        freeWind(ptr);\n    }\n\n}\n\nconst heap = new Array(32);\n\nheap.fill(undefined);\n\nheap.push(undefined, null, true, false);\n\nlet heap_next = heap.length;\n\nfunction dropObject(idx) {\n    if (idx < 36) return;\n    heap[idx] = heap_next;\n    heap_next = idx;\n}\n\nexport function __wbindgen_object_drop_ref(i) { dropObject(i); }\n\n","// Firebase App (the core Firebase SDK) is always required and must be listed first\nimport * as firebase from \"firebase/app\";\n\n// Add the Firebase products that you want to use\nimport \"firebase/auth\";\nimport \"firebase/storage\";\nimport \"firebase/functions\";\n\nwindow.firebase = firebase;\n\nfirebase.initializeApp({\n  apiKey: \"AIzaSyD2APPEyxCi9vB2olvUgzSsbgH1Pyz-as0\",\n  storageBucket: \"sandtable-8d0f7.appspot.com\",\n  authDomain: \"sandspiel.club\",\n  projectId: \"sandtable-8d0f7\",\n  appId: \"1:239719651525:web:80d3674408670521\",\n  messagingSenderId: \"239719651525\"\n});\n\nconst storage = firebase.storage();\nconst functions = firebase.functions();\n\nexport { functions, storage };\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { BrowserRouter as Router, Route, Link } from \"react-router-dom\";\n\nimport Info from \"./components/info\";\nimport { Index } from \"./components/ui\";\nimport Browse from \"./components/browse\";\nimport Admin from \"./components/admin\";\nimport Menu from \"./components/menu\";\nimport SignInScreen from \"./components/signin\";\n\nlet sizeMap = [2, 5, 10, 18, 30, 45];\n\nfunction BrowseRouter({ match, location }) {\n  return (\n    <Menu>\n      <Browse location={location} />\n    </Menu>\n  );\n}\n\nfunction AdminRouter({ match, location }) {\n  return (\n    <Menu>\n      <Admin location={location} />\n    </Menu>\n  );\n}\n\nfunction SigninRouter({ match, location }) {\n  return (\n    <Menu>\n      <SignInScreen location={location} />\n    </Menu>\n  );\n}\n\nfunction AppRouter() {\n  return (\n    <Router>\n      <Route path=\"/\" component={Index} />\n      <Route\n        exact\n        path=\"/info/\"\n        component={() => (\n          <Menu>\n            <Info />\n          </Menu>\n        )}\n      />\n      <Route path=\"/browse\" component={BrowseRouter} />\n      <Route path=\"/admin\" component={AdminRouter} />\n      <Route path=\"/login\" component={SigninRouter} />\n      <Route path=\"/__/auth/handler\" component={SigninRouter} />\n    </Router>\n  );\n}\n\nReactDOM.render(<AppRouter />, document.getElementById(\"ui\"));\n\nexport { sizeMap };\n","import React from \"react\";\nimport { NavLink, Link, withRouter } from \"react-router-dom\";\n\nimport timeago from \"timeago.js\";\n\nimport HyperText from \"./hypertext.js\";\nimport SignInScreen from \"./signin\";\nimport { functions, storage } from \"../api.js\";\n\nconst ago = timeago();\n\nlet storageUrl =\n  \"https://firebasestorage.googleapis.com/v0/b/sandtable-8d0f7.appspot.com/o/creations%2F\";\n\nclass Submissions extends React.Component {\n  shouldComponentUpdate(nextProps) {\n    let { submissions, browseVotes } = this.props;\n    return (\n      nextProps.submissions !== submissions ||\n      Object.keys(nextProps.browseVotes).length !==\n        Object.keys(browseVotes).length\n    );\n  }\n  render() {\n    let { submissions, voteFromBrowse, browseVotes, judge } = this.props;\n\n    if (!submissions) {\n      return <div style={{ height: \"90vh\" }}>Loading Submissions...</div>;\n    }\n    if (submissions.length == 0) {\n      return (\n        <div style={{ height: \"90vh\" }}>No actionable reports! Thanks ♡♡♡</div>\n      );\n    }\n\n    return (\n      <div className=\"submissions\">\n        {submissions.map(submission => {\n          let displayTime = new Date(\n            submission.data.timestamp\n          ).toLocaleDateString();\n          let msAgo =\n            new Date().getTime() -\n            new Date(submission.data.timestamp).getTime();\n\n          if (msAgo < 24 * 60 * 60 * 1000) {\n            displayTime = ago.format(submission.data.timestamp);\n          }\n          return (\n            <div key={submission.id} className=\"submission\">\n              <Link\n                className=\"img-link\"\n                to={{\n                  pathname: \"/\",\n                  hash: `#${submission.id}`\n                }}\n                onClick={() => {\n                  window.UI.setState(\n                    () => ({\n                      currentSubmission: null\n                    }),\n                    window.UI.load\n                  );\n                }}\n              >\n                <img src={`${storageUrl}${submission.data.id}.png?alt=media`} />\n              </Link>\n              <div style={{ width: \"50%\" }}>\n                <h3 style={{ flexGrow: 1, wordWrap: \"break-word\" }}>\n                  <HyperText text={submission.data.title} />\n                </h3>\n                <button\n                  className=\"heart\"\n                  onClick={() => voteFromBrowse(submission)}\n                >\n                  <h3>\n                    {browseVotes[submission.id] ? \"🖤\" : \"♡\"}\n                    {browseVotes[submission.id] || submission.data.score}\n                  </h3>\n                </button>\n\n                <h4>{displayTime}</h4>\n                <h3>{submission.data.reports} reports</h3>\n\n                <div className=\"adminButtons\">\n                  <button\n                    className=\"delete\"\n                    title=\"delete\"\n                    onClick={() => judge(submission.id, true)}\n                  >\n                    delete 💥\n                  </button>\n                  <button\n                    className=\"pardon\"\n                    title=\"pardon\"\n                    onClick={() => judge(submission.id, false)}\n                  >\n                    pardon 🐣\n                  </button>\n                </div>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n}\n\nclass AdminBrowse extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      paused: false,\n      submissions: null,\n      decidedIds: [],\n      browseVotes: {},\n      search: \"\",\n      currentUser: firebase.auth().currentUser\n    };\n  }\n  componentWillMount() {\n    this.loadSubmissions();\n  }\n  componentDidUpdate(prevProps) {\n    if (prevProps.location.pathname != this.props.location.pathname) {\n      this.loadSubmissions();\n    }\n  }\n\n  voteFromBrowse(submission) {\n    // creations/:id/vote\n    firebase\n      .auth()\n      .currentUser.getIdToken(true)\n      .then(token => {\n        fetch(functions._url(`api/creations/${submission.id}/vote`), {\n          method: \"PUT\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: \"Bearer \" + token\n          }\n        })\n          .then(res => res.json())\n          .then(data => {\n            this.setState(({ browseVotes }) => ({\n              browseVotes: { [submission.id]: data.score, ...browseVotes }\n            }));\n          })\n          .catch(e => {\n            console.log(e);\n          });\n      });\n  }\n  loadSubmissions() {\n    // this.setState({ submissions: null });\n    fetch(functions._url(\"api/reports\"), {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    })\n      .then(res => res.json())\n      .then(response => {\n        this.setState({ submissions: response });\n        // this.pause();\n      })\n      .catch(error => {\n        this.setState({ submissions: false });\n        console.error(\"Error:\", error);\n      });\n  }\n  judge(id, ruling) {\n    this.setState(({ decidedIds }) => ({\n      decidedIds: [...decidedIds, id]\n    }));\n    firebase\n      .auth()\n      .currentUser.getIdToken(true)\n      .then(token => {\n        // set the __session cookie\n        fetch(\n          functions._url(`api/creations/${id}/judge`) + `?ruling=${ruling}`,\n          {\n            method: \"PUT\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: \"Bearer \" + token\n            }\n          }\n        )\n          .then(res => res.json())\n          .then(data => {\n            this.loadSubmissions();\n          })\n          .catch(e => {\n            console.log(e);\n          });\n      });\n  }\n  doSignInWithGoogle() {\n    var provider = new firebase.auth.GoogleAuthProvider();\n    firebase.auth().signInWithRedirect(provider);\n  }\n  render() {\n    let { submissions, browseVotes, currentUser, decidedIds } = this.state;\n\n    submissions =\n      submissions &&\n      submissions.filter(submission => !decidedIds.includes(submission.id));\n    return (\n      <React.Fragment>\n        <SignInScreen />\n        <h2 style={{ display: \"inline-block\" }}>do it for doona </h2>\n\n        {submissions && <h3>{submissions.length} actionable reports:</h3>}\n        <NavLink to=\"/browse/\">\n          <button>Browse new</button>\n        </NavLink>\n        <Submissions\n          submissions={submissions}\n          voteFromBrowse={submission => this.voteFromBrowse(submission)}\n          browseVotes={browseVotes}\n          judge={(id, ruling) => this.judge(id, ruling)}\n        />\n      </React.Fragment>\n    );\n  }\n}\n\nexport default withRouter(AdminBrowse);\n","import React from \"react\";\nimport { NavLink, Link, withRouter } from \"react-router-dom\";\n\nimport timeago from \"timeago.js\";\n\nimport HyperText from \"./hypertext.js\";\nimport { functions, storage } from \"../api.js\";\nimport SignInScreen from \"./signin.js\";\n\nconst ago = timeago();\n\nlet storageUrl =\n  \"https://firebasestorage.googleapis.com/v0/b/sandtable-8d0f7.appspot.com/o/creations%2F\";\n\nclass Submissions extends React.Component {\n  shouldComponentUpdate(nextProps) {\n    let { submissions, browseVotes } = this.props;\n    return (\n      nextProps.submissions !== submissions ||\n      Object.keys(nextProps.browseVotes).length !==\n        Object.keys(browseVotes).length\n    );\n  }\n  render() {\n    let { submissions, voteFromBrowse, browseVotes, report } = this.props;\n\n    if (!submissions) {\n      return <div style={{ height: \"90vh\" }}>Loading Submissions...</div>;\n    }\n    if (submissions.length == 0) {\n      return <div style={{ height: \"90vh\" }}>Didn't find anything!</div>;\n    }\n\n    return (\n      <div className=\"submissions\">\n        {submissions.map(submission => {\n          let displayTime = new Date(\n            submission.data.timestamp\n          ).toLocaleDateString();\n          let msAgo =\n            new Date().getTime() -\n            new Date(submission.data.timestamp).getTime();\n\n          if (msAgo < 24 * 60 * 60 * 1000) {\n            displayTime = ago.format(submission.data.timestamp);\n          }\n          return (\n            <div key={submission.id} className=\"submission\">\n              <Link\n                className=\"img-link\"\n                to={{\n                  pathname: \"/\",\n                  hash: `#${submission.id}`\n                }}\n                onClick={() => {\n                  window.UI.setState(\n                    () => ({\n                      currentSubmission: null\n                    }),\n                    window.UI.load\n                  );\n                }}\n              >\n                <img src={`${storageUrl}${submission.data.id}.png?alt=media`} />\n              </Link>\n              <div style={{ width: \"50%\" }}>\n                <h3 style={{ flexGrow: 1, wordWrap: \"break-word\" }}>\n                  <HyperText text={submission.data.title} />\n                </h3>\n                <button\n                  className=\"heart\"\n                  onClick={() => voteFromBrowse(submission)}\n                >\n                  {browseVotes[submission.id] ? \"🖤\" : \"♡\"}\n                  {browseVotes[submission.id] || submission.data.score}\n                </button>\n\n                <h4>{displayTime}</h4>\n\n                <button\n                  className=\"report\"\n                  title=\"report\"\n                  onClick={() => report(submission.id)}\n                >\n                  !\n                </button>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n}\n\nclass Browse extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      paused: false,\n      submitting: false,\n      dataURL: {},\n      submissions: null,\n      browseVotes: {},\n      search: \"\"\n    };\n  }\n  componentWillMount() {\n    console.log(\"mounted\");\n    this.loadSubmissions();\n  }\n  componentDidUpdate(prevProps) {\n    if (\n      prevProps.location.pathname != this.props.location.pathname ||\n      prevProps.location.search != this.props.location.search\n    ) {\n      this.loadSubmissions();\n    }\n  }\n  togglePause() {\n    window.paused = !this.state.paused;\n    this.setState({ paused: !this.state.paused });\n  }\n\n  setSize(event, size) {\n    event.preventDefault();\n    this.setState({\n      size\n    });\n  }\n\n  loadSubmissions() {\n    let { location } = this.props;\n    if (location.search.startsWith(\"?title=\")) {\n      // to load deep urls with a search query.\n      this.setState({ search: this.props.location.search.slice(7) });\n    }\n    let param = \"\";\n\n    if (location.pathname.startsWith(\"/browse/top/\")) {\n      param = \"?q=score\";\n    }\n    if (location.pathname.startsWith(\"/browse/top/day\")) {\n      param = \"?q=score&d=1\";\n    }\n    if (location.pathname.startsWith(\"/browse/top/week\")) {\n      param = \"?q=score&d=7\";\n    }\n    if (location.pathname.startsWith(\"/browse/top/month\")) {\n      param = \"?q=score&d=30\";\n    }\n    if (location.pathname.startsWith(\"/browse/search/\")) {\n      param = location.search;\n    }\n\n    this.setState({ submissions: null });\n    fetch(functions._url(\"api/creations\") + param, {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    })\n      .then(res => res.json())\n      .then(response => {\n        this.setState({ submissions: response });\n        // this.pause();\n      })\n      .catch(error => {\n        this.setState({ submissions: false });\n        console.error(\"Error:\", error);\n      });\n  }\n\n  voteFromBrowse(submission) {\n    // creations/:id/vote\n    firebase\n      .auth()\n      .currentUser.getIdToken()\n      .then(token => {\n        fetch(functions._url(`api/creations/${submission.id}/vote`), {\n          method: \"PUT\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: \"Bearer \" + token\n          }\n        })\n          .then(res => res.json())\n          .then(data => {\n            this.setState(({ browseVotes }) => ({\n              browseVotes: { [submission.id]: data.score, ...browseVotes }\n            }));\n          })\n          .catch(e => {\n            console.log(e);\n          });\n      });\n  }\n  report(id) {\n    fetch(functions._url(`api/creations/${id}/report`), {\n      method: \"PUT\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    })\n      .then(res => res.json())\n      .then(data => {\n        // this.setState(({ browseVotes }) => ({\n        //   browseVotes: { [submission.id]: data.score, ...browseVotes }\n        // }));\n      })\n      .catch(e => {\n        console.log(e);\n      });\n  }\n  render() {\n    const { search, submissions, browseVotes } = this.state;\n    return (\n      <React.Fragment>\n        <SignInScreen />\n        <NavLink exact to=\"/browse/\">\n          <button>New</button>\n        </NavLink>\n        <NavLink to=\"/browse/top/day/\">\n          <button>Day</button>\n        </NavLink>\n        <NavLink to=\"/browse/top/week/\">\n          <button>Week</button>\n        </NavLink>\n        <NavLink to=\"/browse/top/month/\">\n          <button>Month</button>\n        </NavLink>\n        <NavLink exact to=\"/browse/top/\">\n          <button>All </button>\n        </NavLink>\n        <span style={{ display: \"inline-block\" }}>\n          <input\n            value={search}\n            onChange={e => this.setState({ search: e.target.value })}\n            onKeyDown={e =>\n              e.keyCode == 13 && // I think that's enter\n              this.props.history.push(`/browse/search/?title=${search}`)\n            }\n            placeholder=\"search\"\n          />\n          {search && (\n            <NavLink\n              to={{\n                pathname: \"/browse/search/\",\n                search: `?title=${search}`\n              }}\n            >\n              <button>Search</button>\n            </NavLink>\n          )}\n        </span>\n\n        <Submissions\n          submissions={submissions}\n          voteFromBrowse={submission => this.voteFromBrowse(submission)}\n          browseVotes={browseVotes}\n          report={id => this.report(id)}\n        />\n      </React.Fragment>\n    );\n  }\n}\n\nexport default withRouter(Browse);\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nconst HyperText = ({ text }) => {\n  let tokens = text.split(\" \");\n\n  let nodes = tokens.map((t, i) => {\n    if (t.startsWith(\"#\") && t.length > 1) {\n      return (\n        <React.Fragment key={i}>\n          <Link\n            to={{\n              pathname: \"/browse/search/\",\n              search: `?title=${t.slice(1)}`\n            }}\n          >\n            {t}\n          </Link>{\" \"}\n        </React.Fragment>\n      );\n    } else {\n      return t + \" \";\n    }\n  });\n  return <React.Fragment>{nodes}</React.Fragment>;\n};\nexport default HyperText;\n","import React from \"react\";\n\nconst Info = () => {\n  return (\n    <div className=\"Info\">\n      <h1>Sandspiel </h1>\n      <p>\n        Created by <a href=\"https://maxbittker.com\">max bittker</a>\n      </p>\n      <hr />\n      <br />\n      <p>\n        Welcome, and thanks for coming by! I hope that you enjoy exploring this\n        small game, and it brings you some calm.{\" \"}\n      </p>\n      <p>\n        Growing up, \"falling sand\" games like this one provided me hours of\n        entertainment and imagination. I want to particularly thank ha55ii's{\" \"}\n        <a href=\"https://dan-ball.jp/en/javagame/dust/\">Powder Game</a> as the\n        primary inspiration for sandspiel.\n      </p>\n      <br />\n      <p>\n        If you want to read more the inspiration, architecture, and history of\n        the game, I wrote a blog post (it gets technical in the middle):&nbsp;\n        <a href=\"https://maxbittker.com/making-sandspiel\">Making Sandspiel</a>\n      </p>\n      <br />\n      <p>\n        You can follow sandspiel on twitter for updates and new uploads:\n        <a href=\"https://twitter.com/sandspiel_feed\">@sandspiel_feed</a>\n      </p>\n      <br />\n      <p>\n        If you'd like, you can view the{\" \"}\n        <a href=\"https://github.com/maxbittker/sandspiel\">source code</a> or{\" \"}\n        <a href=\"https://github.com/maxbittker/sandspiel/issues\">report bugs</a>{\" \"}\n        on github or feel free to reach out on twitter and I'll try to answer!\n      </p>\n      <br />\n      <p>\n        Lastly, I want to say that if you enjoy this game or share your artwork\n        on it, your opinion is important to me and I want to do my best to\n        ensure sandspiel is a friendly and kind place to play, without bullying,\n        racism, or homophobia. If something is wrong or there's some way I can\n        help, feel free to contact me at [FirstnameLastname]@gmail.com\n      </p>\n      <br />\n      <hr />\n      <br />\n      <h2>Element Information:</h2>\n      <h4>Wall </h4>\n      Indestructible\n      <h4>Sand </h4>\n      Sinks in water\n      <h4>Water </h4>\n      Puts out fire\n      <h4>Stone </h4>\n      Forms arches, folds under pressure\n      <h4>Ice </h4>\n      Freezes Water, slippery!\n      <h4>Gas </h4>\n      Highly Flammable!\n      <h4>Cloner </h4>\n      Copies the first element it touches\n      <h4>Mite </h4>\n      Eats wood and plant, but loves dust! Slides on ice\n      <h4>Wood </h4>\n      Sturdy, but biodegradable\n      <h4>Plant </h4>\n      Thrives in wet enviroments\n      <h4>Fungus </h4>\n      Spreads over everything\n      <h4>Seed </h4>\n      Grows in sand\n      <h4>Fire </h4>\n      Hot!\n      <h4>Lava </h4>\n      Flammable and heavy\n      <h4>Acid </h4>\n      Corrodes other elements\n      <h4>Dust </h4>\n      Pretty, but dangerously explosive\n      <h4>Oil </h4>\n      Produces smoke\n      <h4>Rocket </h4>\n      Explodes into copies of the first element it touches\n      <hr />\n      <hr />\n      <hr />\n      <hr />\n    </div>\n  );\n};\n\nexport default Info;\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nconst Menu = ({ close, children }) => {\n  return (\n    <div className=\"menu-scrim\">\n      <div className={\"menu\"}>\n        {children}\n        <Link to=\"/\" className=\"x\" onClick={close}>\n          <button> x</button>\n        </Link>\n      </div>\n    </div>\n  );\n};\nexport default Menu;\n","import React from \"react\";\n\nimport StyledFirebaseAuth from \"react-firebaseui/StyledFirebaseAuth\";\n\nclass SignInScreen extends React.Component {\n  // The component's Local state.\n  state = {\n    isSignedIn: false, // Local signed-in state.\n    expanded: true\n  };\n\n  // Configure FirebaseUI.\n  uiConfig = {\n    // Popup signin flow rather than redirect flow.\n    signInFlow: \"redirect\",\n    // We will display Google and email as auth providers.\n    signInOptions: [\n      firebase.auth.GoogleAuthProvider.PROVIDER_ID,\n      firebase.auth.GithubAuthProvider.PROVIDER_ID,\n      {\n        provider: firebase.auth.EmailAuthProvider.PROVIDER_ID,\n        requireDisplayName: false\n      }\n      // firebase.auth.FacebookAuthProvider.PROVIDER_ID\n    ],\n    callbacks: {\n      // Avoid redirects after sign-in.\n      signInSuccessWithAuthResult: () => false\n    }\n  };\n\n  // Listen to the Firebase Auth state and set the local state.\n  componentDidMount() {\n    this.setState({ isSignedIn: !!firebase.auth().currentUser });\n\n    this.unregisterAuthObserver = firebase\n      .auth()\n      .onAuthStateChanged(user => this.setState({ isSignedIn: !!user }));\n  }\n\n  // Make sure we un-register Firebase observers when the component unmounts.\n  componentWillUnmount() {\n    this.unregisterAuthObserver();\n  }\n\n  render() {\n    if (!this.state.isSignedIn) {\n      if (!this.state.expanded) {\n        return (\n          <span>\n            <p>\n              Please{\" \"}\n              <button onClick={() => this.setState({ expanded: true })}>\n                Sign in\n              </button>{\" \"}\n              to vote!{\" \"}\n            </p>\n            <span style={{ display: \"none\" }}>\n              {/* gross hack for completing login */}\n              <StyledFirebaseAuth\n                uiConfig={this.uiConfig}\n                firebaseAuth={firebase.auth()}\n              />\n            </span>\n          </span>\n        );\n      } else {\n        return (\n          <div>\n            <p>Sign-in to vote:</p>\n            <StyledFirebaseAuth\n              uiConfig={this.uiConfig}\n              firebaseAuth={firebase.auth()}\n            />\n          </div>\n        );\n      }\n    }\n    let { currentUser } = firebase.auth();\n\n    return (\n      <div>\n        <div style={{ display: \"flex\", alignItems: \"center\" }}>\n          <img\n            style={{ height: \"35px\", width: \"35px\", borderRadius: 50 }}\n            src={currentUser.photoURL}\n          />\n          {!currentUser.emailVerified &&\n            `Please Verify your email ${currentUser.email} to vote!`}\n          <button onClick={() => firebase.auth().signOut()}>Sign-out</button>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default SignInScreen;\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nimport { memory } from \"../../crate/pkg/sandtable_bg\";\nimport { Species } from \"../../crate/pkg/sandtable\";\n\nimport { height, universe, width, reset } from \"../index.js\";\nimport { snapshot, pallette } from \"../render.js\";\nimport { functions, storage } from \"../api.js\";\n\nimport Menu from \"./menu\";\n\nwindow.species = Species;\nlet pallette_data = pallette();\n\nconst ElementButton = (name, selectedElement, setElement) => {\n  let elementID = Species[name];\n\n  let color = pallette_data[elementID];\n  let selected = elementID == selectedElement;\n\n  let background = \"inherit\";\n  if (elementID == 14) {\n    background = `linear-gradient(45deg, \n    rgba(202, 121, 125, 0.25), \n    rgba(169, 120, 200, 0.25), \n    rgba(117, 118, 195, 0.25), \n    rgba(117, 196, 193, 0.25), \n    rgba(122, 203, 168, 0.25), \n    rgba(185, 195, 117, 0.25), \n    rgba(204, 186, 122, 0.25))`;\n    if (selected) {\n      background = background.replace(/0.25/g, \"1.0\");\n    }\n  }\n  return (\n    <button\n      className={selected ? \"selected\" : \"\"}\n      key={name}\n      onClick={() => {\n        setElement(elementID);\n      }}\n      style={{\n        background,\n        backgroundColor: selected ? color.replace(\"0.25\", \"1.5\") : color\n      }}\n    >\n      {\"  \"}\n      {name}\n      {\"  \"}\n    </button>\n  );\n};\n\nlet sizeMap = [2, 5, 10, 18, 30, 45];\n\nclass Index extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      submissionMenuOpen: false,\n      paused: false,\n      submitting: false,\n      size: 2,\n      dataURL: {},\n      currentSubmission: null,\n      selectedElement: Species.Water\n    };\n    window.UI = this;\n    //if we start in the background, pause;\n    if (this.props.location.pathname !== \"/\") {\n      window.setTimeout(() => this.pause(), 50);\n    }\n\n    this.load();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (\n      this.props.location.pathname === \"/\" &&\n      prevProps.location.pathname !== \"/\" &&\n      this.state.currentSubmission\n    ) {\n      window.location = `#${this.state.currentSubmission.id}`;\n      return;\n    }\n    if (\n      this.props.location.pathname !== \"/\" &&\n      prevProps.location.pathname == \"/\"\n    ) {\n      this.pause();\n    }\n    if (\n      prevProps.location.hash === \"\" ||\n      prevProps.location.hash != this.props.location.hash\n    ) {\n      this.load();\n    }\n  }\n  togglePause() {\n    window.paused = !this.state.paused;\n    this.setState({ paused: !this.state.paused });\n  }\n  play() {\n    window.paused = false;\n    this.setState({ paused: false });\n  }\n  pause() {\n    window.paused = true;\n    this.setState({ paused: true });\n  }\n\n  setSize(event, size) {\n    event.preventDefault();\n    this.setState({\n      size\n    });\n  }\n  reset() {\n    if (window.confirm(\"Reset?\")) {\n      this.play();\n      window.location = \"#\";\n      this.setState({ currentSubmission: null });\n      reset();\n    }\n  }\n  menu() {\n    this.pause();\n    this.setState({ submissionMenuOpen: true });\n  }\n\n  closeMenu() {\n    this.play();\n    this.setState({ submissionMenuOpen: false });\n  }\n  upload() {\n    let dataURL = snapshot(universe);\n    const cells = new Uint8Array(\n      memory.buffer,\n      universe.cells(),\n      width * height * 4\n    );\n\n    // Create canvas\n    let canvas = document.createElement(\"canvas\"),\n      context = canvas.getContext(\"2d\"),\n      imgData = context.createImageData(width, height);\n\n    canvas.height = height;\n    canvas.width = width;\n\n    // fill imgData with data from cells\n    for (var i = 0; i < width * height * 4; i++) {\n      if (i % 4 == 3) {\n        imgData.data[i] = 255;\n      } else {\n        imgData.data[i] = cells[i];\n      }\n    }\n    // put data to context at (0, 0)\n    context.putImageData(imgData, 0, 0);\n\n    let cellData = canvas.toDataURL(\"image/png\");\n\n    this.pause();\n    this.setState({\n      data: { dataURL, cells: cellData },\n      submissionMenuOpen: true\n    });\n  }\n  submit() {\n    let { title, data } = this.state;\n    let { dataURL, cells } = data;\n    let payload = { title, image: dataURL, cells };\n    this.setState({ submitting: true });\n\n    fetch(functions._url(\"api/creations\"), {\n      method: \"POST\",\n      body: JSON.stringify(payload), // data can be `string` or {object}!\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    })\n      .then(res => res.json())\n      .then(response => {\n        console.log(\"Success:\", JSON.stringify(response));\n        this.play();\n      })\n      .catch(error => console.error(\"Error:\", error))\n      .then(() => {\n        this.setState({ submissionMenuOpen: false, submitting: false });\n      });\n  }\n\n  load() {\n    let { location } = this.props;\n    let id = location.hash.replace(/#/, \"\");\n    if (id === \"\") {\n      return;\n    }\n\n    if (this.state.currentSubmission && this.state.currentSubmission.id == id) {\n      return;\n    }\n\n    fetch(functions._url(`api/creations/${id}`), {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    })\n      .then(res => res.json())\n      .then(data => {\n        storage\n          .refFromURL(\n            `gs://sandtable-8d0f7.appspot.com/creations/${data.id}.data.png`\n          )\n          .getDownloadURL()\n          .then(dlurl => {\n            fetch(dlurl, {\n              method: \"GET\"\n            })\n              .then(res => res.blob())\n              .then(blob => {\n                // console.log(response);\n                this.setState({ currentSubmission: { id, data } });\n\n                var url = URL.createObjectURL(blob);\n                var img = new Image();\n                img.src = url;\n                img.onload = () => {\n                  var canvas = document.createElement(\"canvas\");\n                  canvas.width = width;\n                  canvas.height = height;\n                  var ctx = canvas.getContext(\"2d\");\n                  ctx.drawImage(img, 0, 0);\n                  var imgData = ctx.getImageData(\n                    0,\n                    0,\n                    canvas.width,\n                    canvas.height\n                  );\n\n                  const cellsData = new Uint8Array(\n                    memory.buffer,\n                    universe.cells(),\n                    width * height * 4\n                  );\n\n                  reset();\n\n                  for (var i = 0; i < width * height * 4; i++) {\n                    cellsData[i] = imgData.data[i];\n                  }\n                  universe.flush_undos();\n                  universe.push_undo();\n                  this.pause();\n                };\n              })\n              .catch(error => console.error(\"Error:\", error));\n          });\n      })\n      .catch(error => {\n        console.error(\"Error:\", error);\n      });\n  }\n  incScore() {\n    let { currentSubmission } = this.state;\n    let { id } = currentSubmission;\n    // creations/:id/vote\n    firebase\n      .auth()\n      .currentUser.getIdToken()\n      .then(token => {\n        fetch(functions._url(`api/creations/${id}/vote`), {\n          method: \"PUT\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: \"Bearer \" + token\n          }\n        })\n          .then(res => res.json())\n          .then(data => {\n            if (currentSubmission != null) {\n              console.log(data);\n              this.setState({\n                currentSubmission: { ...currentSubmission, data }\n              });\n            }\n          })\n          .catch(e => {\n            console.log(e);\n          });\n      });\n  }\n\n  render() {\n    let { size, paused, selectedElement, currentSubmission } = this.state;\n    let hash =\n      currentSubmission && currentSubmission.id\n        ? `#${currentSubmission.id}`\n        : \"\";\n    return (\n      <React.Fragment>\n        <button\n          onClick={() => this.togglePause()}\n          className={paused ? \"selected\" : \"\"}\n        >\n          {paused ? (\n            <svg height=\"20\" width=\"20\" id=\"d\" viewBox=\"0 0 300 300\">\n              <polygon id=\"play\" points=\"0,0 , 300,150 0,300\" />\n            </svg>\n          ) : (\n            <svg height=\"20\" width=\"20\" id=\"d\" viewBox=\"0 0 300 300\">\n              <polygon id=\"bar2\" points=\"0,0 110,0 110,300 0,300\" />\n              <polygon id=\"bar1\" points=\"190,0 300,0 300,300 190,300\" />\n            </svg>\n          )}\n        </button>\n        <button onClick={() => this.upload()}>Upload</button>\n        <Link\n          to={{\n            pathname: \"/browse/\",\n            hash\n          }}\n        >\n          <button>Browse</button>\n        </Link>\n\n        <button onClick={() => this.reset()}>Reset</button>\n        <Link\n          to={{\n            pathname: \"/info/\",\n            hash\n          }}\n        >\n          <button>Info</button>\n        </Link>\n\n        {/* {paused && <button onClick={() => universe.tick()}>Tick</button>} */}\n        <span className=\"sizes\">\n          {sizeMap.map((v, i) => (\n            <button\n              key={i}\n              className={i == size ? \"selected\" : \"\"}\n              onClick={e => this.setSize(e, i)}\n              style={{ padding: \"0px\" }}\n            >\n              <svg height=\"23\" width=\"23\" id=\"d\" viewBox=\"0 0 100 100\">\n                <circle cx=\"50\" cy=\"50\" r={2 + v} />\n              </svg>\n            </button>\n          ))}\n        </span>\n        <button\n          onClick={() => {\n            reset();\n            universe.pop_undo();\n          }}\n          style={{ fontSize: 35 }}\n        >\n          ↜\n        </button>\n        <button\n          className={-1 == selectedElement ? \"selected\" : \"\"}\n          key={name}\n          onClick={() => {\n            this.setState({ selectedElement: -1 });\n          }}\n        >\n          Wind\n        </button>\n        {Object.keys(Species).map(n =>\n          ElementButton(n, selectedElement, id =>\n            this.setState({ selectedElement: id })\n          )\n        )}\n\n        {this.state.currentSubmission && (\n          <div className=\"submission-title\">\n            <button onClick={() => this.incScore()}>\n              +♡{this.state.currentSubmission.data.score}{\" \"}\n            </button>\n            {this.state.currentSubmission.data.title}\n          </div>\n        )}\n\n        {this.state.submissionMenuOpen && (\n          <Menu close={() => this.closeMenu()}>\n            <h4>Share your creation with the people!</h4>\n            <img src={this.state.data.dataURL} className=\"submissionImg\" />\n            <div style={{ display: \"flex\" }}>\n              <input\n                placeholder=\"title\"\n                onChange={e => this.setState({ title: e.target.value })}\n              />\n              <button\n                disabled={this.state.submitting}\n                onClick={() => this.submit()}\n              >\n                Submit\n              </button>\n            </div>\n          </Menu>\n        )}\n      </React.Fragment>\n    );\n  }\n}\n\nexport { sizeMap, Index };\n","// MIT License\n\n// Copyright (c) 2017 Pavel Dobryakov\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\"use strict\";\nimport * as dat from \"dat.gui\";\nimport { memory } from \"../crate/pkg/sandtable_bg\";\nimport { compileShaders } from \"./fluidShaders\";\nconst canvas = document.getElementById(\"fluid-canvas\");\nconst sandCanvas = document.getElementById(\"sand-canvas\");\n\nlet fluidColor = [1, 1, 0.8];\n\nfunction startFluid({ universe }) {\n  canvas.width = universe.width();\n  canvas.height = universe.height();\n  let config = {\n    TEXTURE_DOWNSAMPLE: 0,\n    DENSITY_DISSIPATION: 0.98,\n    VELOCITY_DISSIPATION: 0.99,\n    PRESSURE_DISSIPATION: 0.8,\n    PRESSURE_ITERATIONS: 25,\n    CURL: 30,\n    SPLAT_RADIUS: 0.005\n  };\n\n  let pointers = [];\n  let splatStack = [];\n\n  const { gl, ext } = getWebGLContext(canvas);\n  let {\n    baseVertexShader,\n    clearShader,\n    displayShader,\n    splatShader,\n    advectionManualFilteringShader,\n    advectionShader,\n    divergenceShader,\n    curlShader,\n    vorticityShader,\n    pressureShader,\n    gradientSubtractShader,\n    velocityOutShader\n  } = compileShaders(gl);\n  startGUI();\n\n  function getWebGLContext(canvas) {\n    const params = {\n      alpha: false,\n      depth: false,\n      stencil: false,\n      antialias: false,\n      preserveDrawingBuffer: false\n    };\n\n    let gl = canvas.getContext(\"webgl2\", params);\n    const isWebGL2 = !!gl;\n    if (!isWebGL2)\n      gl =\n        canvas.getContext(\"webgl\", params) ||\n        canvas.getContext(\"experimental-webgl\", params);\n\n    let halfFloat;\n    let supportLinearFiltering;\n    if (isWebGL2) {\n      gl.getExtension(\"EXT_color_buffer_float\");\n      supportLinearFiltering = gl.getExtension(\"OES_texture_float_linear\");\n    } else {\n      halfFloat = gl.getExtension(\"OES_texture_half_float\");\n      supportLinearFiltering = gl.getExtension(\"OES_texture_half_float_linear\");\n    }\n\n    gl.clearColor(0.0, 0.0, 0.0, 0.0);\n\n    const halfFloatTexType = isWebGL2\n      ? gl.HALF_FLOAT\n      : halfFloat.HALF_FLOAT_OES;\n    let formatRGBA;\n    let formatRG;\n    let formatR;\n\n    if (isWebGL2) {\n      formatRGBA = getSupportedFormat(\n        gl,\n        gl.RGBA16F,\n        gl.RGBA,\n        halfFloatTexType\n      );\n      formatRG = getSupportedFormat(gl, gl.RG16F, gl.RG, halfFloatTexType);\n      formatR = getSupportedFormat(gl, gl.R16F, gl.RED, halfFloatTexType);\n    } else {\n      formatRGBA = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);\n      formatRG = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);\n      formatR = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType);\n    }\n\n    return {\n      gl,\n      ext: {\n        formatRGBA,\n        formatRG,\n        formatR,\n        halfFloatTexType,\n        supportLinearFiltering\n      }\n    };\n  }\n\n  function getSupportedFormat(gl, internalFormat, format, type) {\n    if (!supportRenderTextureFormat(gl, internalFormat, format, type)) {\n      switch (internalFormat) {\n        case gl.R16F:\n          return getSupportedFormat(gl, gl.RG16F, gl.RG, type);\n        case gl.RG16F:\n          return getSupportedFormat(gl, gl.RGBA16F, gl.RGBA, type);\n        default:\n          return null;\n      }\n    }\n\n    return {\n      internalFormat,\n      format\n    };\n  }\n\n  function supportRenderTextureFormat(gl, internalFormat, format, type) {\n    let texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      internalFormat,\n      4,\n      4,\n      0,\n      format,\n      type,\n      null\n    );\n\n    let fbo = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      gl.COLOR_ATTACHMENT0,\n      gl.TEXTURE_2D,\n      texture,\n      0\n    );\n\n    const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n    if (status != gl.FRAMEBUFFER_COMPLETE) return false;\n    return true;\n  }\n\n  function startGUI() {\n    var gui = new dat.GUI({ width: 300 });\n    gui\n      .add(config, \"TEXTURE_DOWNSAMPLE\", { Full: 0, Half: 1, Quarter: 2 })\n      .name(\"resolution\")\n      .onFinishChange(initFramebuffers);\n    gui.add(config, \"DENSITY_DISSIPATION\", 0.9, 1.0).name(\"density diffusion\");\n    gui\n      .add(config, \"VELOCITY_DISSIPATION\", 0.9, 1.0)\n      .name(\"velocity diffusion\");\n    gui\n      .add(config, \"PRESSURE_DISSIPATION\", 0.0, 1.0)\n      .name(\"pressure diffusion\");\n    gui.add(config, \"PRESSURE_ITERATIONS\", 1, 60).name(\"iterations\");\n    gui\n      .add(config, \"CURL\", 0, 50)\n      .name(\"vorticity\")\n      .step(1);\n    gui.add(config, \"SPLAT_RADIUS\", 0.0001, 0.01).name(\"splat radius\");\n\n    gui\n      .add(\n        {\n          fun: () => {\n            splatStack.push(parseInt(Math.random() * 20) + 5);\n          }\n        },\n        \"fun\"\n      )\n      .name(\"Random splats\");\n\n    gui.close();\n  }\n\n  function pointerPrototype() {\n    this.id = -1;\n    this.x = 0;\n    this.y = 0;\n    this.dx = 0;\n    this.dy = 0;\n    this.down = false;\n    this.moved = false;\n    this.color = [30, 300, 30];\n  }\n\n  pointers.push(new pointerPrototype());\n\n  class GLProgram {\n    constructor(vertexShader, fragmentShader) {\n      this.uniforms = {};\n      this.program = gl.createProgram();\n\n      gl.attachShader(this.program, vertexShader);\n      gl.attachShader(this.program, fragmentShader);\n      gl.linkProgram(this.program);\n\n      if (!gl.getProgramParameter(this.program, gl.LINK_STATUS))\n        throw gl.getProgramInfoLog(this.program);\n\n      const uniformCount = gl.getProgramParameter(\n        this.program,\n        gl.ACTIVE_UNIFORMS\n      );\n      for (let i = 0; i < uniformCount; i++) {\n        const uniformName = gl.getActiveUniform(this.program, i).name;\n        this.uniforms[uniformName] = gl.getUniformLocation(\n          this.program,\n          uniformName\n        );\n      }\n    }\n\n    bind() {\n      gl.useProgram(this.program);\n    }\n  }\n\n  let texWidth;\n  let texHeight;\n  let density;\n  let velocity;\n  let velocityOut;\n  let burns;\n  let cells;\n  let divergence;\n  let curl;\n  let pressure;\n  initFramebuffers();\n\n  const clearProgram = new GLProgram(baseVertexShader, clearShader);\n  const displayProgram = new GLProgram(baseVertexShader, displayShader);\n  const velocityOutProgram = new GLProgram(baseVertexShader, velocityOutShader);\n  const splatProgram = new GLProgram(baseVertexShader, splatShader);\n  const advectionProgram = new GLProgram(\n    baseVertexShader,\n    ext.supportLinearFiltering\n      ? advectionShader\n      : advectionManualFilteringShader\n  );\n  const divergenceProgram = new GLProgram(baseVertexShader, divergenceShader);\n  const curlProgram = new GLProgram(baseVertexShader, curlShader);\n  const vorticityProgram = new GLProgram(baseVertexShader, vorticityShader);\n  const pressureProgram = new GLProgram(baseVertexShader, pressureShader);\n  const gradientSubtractProgram = new GLProgram(\n    baseVertexShader,\n    gradientSubtractShader\n  );\n\n  function initFramebuffers() {\n    texWidth = gl.drawingBufferWidth >> config.TEXTURE_DOWNSAMPLE;\n    texHeight = gl.drawingBufferHeight >> config.TEXTURE_DOWNSAMPLE;\n\n    const texType = ext.halfFloatTexType;\n    const rgba = ext.formatRGBA;\n    const rg = ext.formatRG;\n    const r = ext.formatR;\n\n    velocity = createDoubleFBO(\n      0,\n      texWidth,\n      texHeight,\n      rg.internalFormat,\n      rg.format,\n      texType,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n    density = createDoubleFBO(\n      2,\n      texWidth,\n      texHeight,\n      rgba.internalFormat,\n      rgba.format,\n      texType,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n    divergence = createFBO(\n      4,\n      texWidth,\n      texHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    );\n    curl = createFBO(\n      5,\n      texWidth,\n      texHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    );\n    pressure = createDoubleFBO(\n      6,\n      texWidth,\n      texHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    );\n    burns = createFBO(\n      8,\n      texWidth,\n      texHeight,\n      rg.internalFormat,\n      rg.format,\n      texType,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n    cells = createFBO(\n      10,\n      texWidth,\n      texHeight,\n      rg.internalFormat,\n      rg.format,\n      texType,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n    velocityOut = createFBO(\n      9,\n      texWidth,\n      texHeight,\n      gl.RGBA,\n      gl.RGBA,\n      gl.UNSIGNED_BYTE,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    );\n  }\n\n  function createFBO(texId, w, h, internalFormat, format, type, param) {\n    gl.activeTexture(gl.TEXTURE0 + texId);\n    let texture = gl.createTexture();\n\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, param);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, param);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      internalFormat,\n      w,\n      h,\n      0,\n      format,\n      type,\n      null\n    );\n\n    let fbo = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      gl.COLOR_ATTACHMENT0,\n      gl.TEXTURE_2D,\n      texture,\n      0\n    );\n    gl.viewport(0, 0, w, h);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n\n    return [texture, fbo, texId];\n  }\n\n  function createDoubleFBO(texId, w, h, internalFormat, format, type, param) {\n    let fbo1 = createFBO(texId, w, h, internalFormat, format, type, param);\n    let fbo2 = createFBO(texId + 1, w, h, internalFormat, format, type, param);\n\n    return {\n      get read() {\n        return fbo1;\n      },\n      get write() {\n        return fbo2;\n      },\n      swap() {\n        let temp = fbo1;\n        fbo1 = fbo2;\n        fbo2 = temp;\n      }\n    };\n  }\n\n  const blit = (() => {\n    gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\n    gl.bufferData(\n      gl.ARRAY_BUFFER,\n      new Float32Array([-1, -1, -1, 1, 1, 1, 1, -1]),\n      gl.STATIC_DRAW\n    );\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.createBuffer());\n    gl.bufferData(\n      gl.ELEMENT_ARRAY_BUFFER,\n      new Uint16Array([0, 1, 2, 0, 2, 3]),\n      gl.STATIC_DRAW\n    );\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n    gl.enableVertexAttribArray(0);\n\n    return destination => {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, destination);\n      gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\n    };\n  })();\n\n  let lastTime = Date.now();\n\n  // multipleSplats(parseInt(Math.random() * 20) + 5);\n\n  const width = universe.width();\n  const height = universe.height();\n\n  let winds = new Uint8Array(\n    memory.buffer,\n    universe.winds(),\n    width * height * 4\n  );\n\n  let burnsData = new Uint8Array(\n    memory.buffer,\n    universe.burns(),\n    width * height * 4\n  );\n\n  let cellsData = new Uint8Array(\n    memory.buffer,\n    universe.cells(),\n    width * height * 4\n  );\n\n  function reset() {\n    clearProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(clearProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, density.read[0]);\n    gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    gl.uniform1f(clearProgram.uniforms.value, 0);\n\n    blit(density.write[1]);\n    density.swap();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(clearProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    gl.uniform1f(clearProgram.uniforms.value, 0);\n\n    blit(pressure.write[1]);\n    pressure.swap();\n\n    texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(clearProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    gl.uniform1f(clearProgram.uniforms.value, 0);\n\n    blit(velocity.write[1]);\n    velocity.swap();\n  }\n\n  function update() {\n    winds = new Uint8Array(memory.buffer, universe.winds(), width * height * 4);\n\n    burnsData = new Uint8Array(\n      memory.buffer,\n      universe.burns(),\n      width * height * 4\n    );\n\n    let cell_pointer = universe.cells();\n    cellsData = new Uint8Array(memory.buffer, cell_pointer, width * height * 4);\n\n    // resizeCanvas();\n\n    const dt = Math.min((Date.now() - lastTime) / 1000, 0.016);\n    lastTime = Date.now();\n\n    gl.viewport(0, 0, texWidth, texHeight);\n\n    if (splatStack.length > 0) multipleSplats(splatStack);\n    // multipleSplats(1);\n\n    // ADVECTION\n    // velocityRead ->\n    // velocityWrite\n    advectionProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(advectionProgram.uniforms.uVelocity, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(advectionProgram.uniforms.uSource, texUnit++);\n\n    gl.uniform2f(\n      advectionProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n    // gl.uniform1i(advectionProgram.uniforms.uVelocity, velocity.read[2]);\n    // gl.uniform1i(advectionProgram.uniforms.uSource, velocity.read[2]);\n    gl.uniform1f(advectionProgram.uniforms.dt, dt);\n    gl.uniform1f(\n      advectionProgram.uniforms.dissipation,\n      config.VELOCITY_DISSIPATION\n    );\n    blit(velocity.write[1]);\n    velocity.swap();\n\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGBA,\n      width,\n      height,\n      0,\n      gl.RGBA,\n      gl.UNSIGNED_BYTE,\n      burnsData\n    );\n\n    gl.bindTexture(gl.TEXTURE_2D, cells[0]);\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGBA,\n      width,\n      height,\n      0,\n      gl.RGBA,\n      gl.UNSIGNED_BYTE,\n      cellsData\n    );\n\n    // ADVECTION\n    // burns\n    // velocityRead\n    // densityRead ->\n    // densityWrite\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(advectionProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(advectionProgram.uniforms.uVelocity, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, density.read[0]);\n    gl.uniform1i(advectionProgram.uniforms.uSource, texUnit++);\n\n    // gl.uniform1i(advectionProgram.uniforms.uWind, burns[2]);\n    // gl.uniform1i(advectionProgram.uniforms.uVelocity, velocity.read[2]);\n    // gl.uniform1i(advectionProgram.uniforms.uSource, density.read[2]);\n    gl.uniform1f(\n      advectionProgram.uniforms.dissipation,\n      config.DENSITY_DISSIPATION\n    );\n    blit(density.write[1]);\n    density.swap();\n\n    // Splat\n    // velocityRead -> velocityWrite\n    // densityRead -> velocityWrite\n    for (let i = 0; i < pointers.length; i++) {\n      const pointer = pointers[i];\n      if (pointer.moved && window.UI.state.selectedElement < 0) {\n        splat(pointer.x, pointer.y, pointer.dx, pointer.dy, pointer.color);\n        pointer.moved = false;\n      }\n    }\n\n    // CURL\n    // velocityRead -> curl\n    curlProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(curlProgram.uniforms.uVelocity, texUnit++);\n\n    gl.uniform2f(\n      curlProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n    // gl.uniform1i(curlProgram.uniforms.uVelocity, velocity.read[2]);\n    blit(curl[1]);\n\n    // VORTICITY\n    // velocityRead\n    // curl ->\n    // velocityWrite\n\n    vorticityProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(vorticityProgram.uniforms.uVelocity, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, curl[0]);\n    gl.uniform1i(vorticityProgram.uniforms.uCurl, texUnit++);\n\n    gl.uniform2f(\n      vorticityProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n\n    // gl.uniform1i(vorticityProgram.uniforms.uVelocity, velocity.read[2]);\n    // gl.uniform1i(vorticityProgram.uniforms.uCurl, curl[2]);\n    gl.uniform1f(vorticityProgram.uniforms.curl, config.CURL);\n    gl.uniform1f(vorticityProgram.uniforms.dt, dt);\n    blit(velocity.write[1]);\n    velocity.swap();\n\n    // DIVERGENCE\n    // velocityRead ->\n    // divergence\n    divergenceProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(divergenceProgram.uniforms.uVelocity, texUnit++);\n\n    gl.uniform2f(\n      divergenceProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n    // gl.uniform1i(divergenceProgram.uniforms.uVelocity, velocity.read[2]);\n    blit(divergence[1]);\n\n    // CLEAR\n    // burns\n    // pressureRead->\n    // pressureWrite\n    clearProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(clearProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    let pressureTexId = texUnit - 1;\n\n    // let pressureTexId = pressure.read[2];\n    // gl.activeTexture(gl.TEXTURE0 + pressureTexId);\n    // gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n\n    // gl.uniform1i(clearProgram.uniforms.uWind, burns[2]);\n    // gl.uniform1i(clearProgram.uniforms.uTexture, pressureTexId);\n    gl.uniform1f(clearProgram.uniforms.value, config.PRESSURE_DISSIPATION);\n\n    blit(pressure.write[1]);\n    pressure.swap();\n\n    // PRESSURE\n    // divergence\n    // pressureRead->\n    // pressureWrite\n    pressureProgram.bind();\n    //TODO\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, divergence[0]);\n    gl.uniform1i(pressureProgram.uniforms.uDivergence, texUnit++);\n\n    // gl.activeTexture(gl.TEXTURE0 + texUnit);\n    // gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    // gl.uniform1i(clearProgram.uniforms.uTexture, texUnit++);\n\n    gl.uniform2f(\n      pressureProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n    // gl.uniform1i(pressureProgram.uniforms.uDivergence, divergence[2]);\n    pressureTexId = pressure.read[2];\n    gl.uniform1i(pressureProgram.uniforms.uPressure, pressureTexId);\n    gl.activeTexture(gl.TEXTURE0 + pressureTexId);\n    for (let i = 0; i < config.PRESSURE_ITERATIONS; i++) {\n      gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n      blit(pressure.write[1]);\n      pressure.swap();\n    }\n\n    // VELOCITY OUT\n    // velocityRead\n    // pressureRead ->\n    // velocityOut\n    velocityOutProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(velocityOutProgram.uniforms.uTexture, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    gl.uniform1i(velocityOutProgram.uniforms.uPressure, texUnit++);\n\n    // gl.uniform1i(velocityOutProgram.uniforms.uTexture, velocity.read[2]);\n    // gl.uniform1i(velocityOutProgram.uniforms.uPressure, pressure.read[2]);\n    blit(velocityOut[1]);\n    gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, winds);\n\n    // GRADIENT SUBTRACT\n    // burns\n    // pressureRead\n    // velocityRead\n    // sands ->\n    // velocityWrite\n    gradientSubtractProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, burns[0]);\n    gl.uniform1i(gradientSubtractProgram.uniforms.uWind, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, pressure.read[0]);\n    gl.uniform1i(gradientSubtractProgram.uniforms.uPressure, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(gradientSubtractProgram.uniforms.uVelocity, texUnit++);\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, cells[0]);\n    gl.uniform1i(gradientSubtractProgram.uniforms.uCells, texUnit++);\n\n    gl.uniform2f(\n      gradientSubtractProgram.uniforms.texelSize,\n      1.0 / texWidth,\n      1.0 / texHeight\n    );\n\n    // gl.uniform1i(gradientSubtractProgram.uniforms.uWind, burns[2]);\n    // gl.uniform1i(gradientSubtractProgram.uniforms.uPressure, pressure.read[2]);\n    // gl.uniform1i(gradientSubtractProgram.uniforms.uVelocity, velocity.read[2]);\n    blit(velocity.write[1]);\n    velocity.swap();\n\n    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n\n    // DISPLAY\n    // density ->\n    // null/renderbuffer?\n    displayProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, density.read[0]);\n    gl.uniform1i(displayProgram.uniforms.uTexture, texUnit++);\n\n    // gl.uniform1i(displayProgram.uniforms.uTexture, density.read[2]);\n\n    blit(null);\n  }\n\n  function splat(x, y, dx, dy, color) {\n    splatProgram.bind();\n\n    var texUnit = 0;\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, velocity.read[0]);\n    gl.uniform1i(splatProgram.uniforms.uTarget, texUnit++);\n\n    // gl.uniform1i(splatProgram.uniforms.uTarget, velocity.read[2]);\n    gl.uniform1f(\n      splatProgram.uniforms.aspectRatio,\n      canvas.width / canvas.height\n    );\n    gl.uniform2f(\n      splatProgram.uniforms.point,\n      x / canvas.width,\n      1.0 - y / canvas.height\n    );\n    gl.uniform3f(splatProgram.uniforms.color, dx, -dy, 1.0);\n    gl.uniform1f(\n      splatProgram.uniforms.radius,\n      (window.UI.state.size + 1) / 600\n    );\n    blit(velocity.write[1]);\n    velocity.swap();\n\n    gl.activeTexture(gl.TEXTURE0 + texUnit);\n    gl.bindTexture(gl.TEXTURE_2D, density.read[0]);\n    gl.uniform1i(splatProgram.uniforms.uTarget, texUnit++);\n\n    // gl.uniform1i(splatProgram.uniforms.uTarget, density.read[2]);\n    gl.uniform3f(splatProgram.uniforms.color, color[0], color[1], color[2]);\n    blit(density.write[1]);\n    density.swap();\n  }\n\n  function multipleSplats(amount) {\n    for (let i = 0; i < amount; i++) {\n      const color = fluidColor;\n      const x = canvas.width * Math.random();\n      const y = canvas.height * Math.random();\n      const dx = 1000 * (Math.random() - 0.5);\n      const dy = 1000 * (Math.random() - 0.5);\n      splat(x, y, dx, dy, color);\n    }\n  }\n\n  let boundingRect;\n  let scaleX;\n  let scaleY;\n\n  let resize = () => {\n    boundingRect = sandCanvas.getBoundingClientRect();\n    scaleX = sandCanvas.width / boundingRect.width;\n    scaleY = sandCanvas.height / boundingRect.height;\n  };\n  resize();\n  window.addEventListener(\"resize\", resize);\n  window.addEventListener(\"deviceorientation\", resize, true);\n\n  sandCanvas.addEventListener(\"mousemove\", e => {\n    const canvasLeft = (e.clientX - boundingRect.left) * scaleX;\n    const canvasTop = (e.clientY - boundingRect.top) * scaleY;\n    pointers[0].moved = pointers[0].down;\n    pointers[0].dx = (canvasLeft - pointers[0].x) * 10.0;\n    pointers[0].dy = (canvasTop - pointers[0].y) * 10.0;\n    pointers[0].x = canvasLeft;\n    pointers[0].y = canvasTop;\n  });\n\n  sandCanvas.addEventListener(\n    \"touchmove\",\n    e => {\n      if (!window.paused) {\n        if (e.cancelable) {\n          e.preventDefault();\n        }\n      }\n      const touches = e.targetTouches;\n      for (let i = 0; i < touches.length; i++) {\n        let pointer = pointers[i];\n        pointer.moved = pointer.down;\n\n        const canvasLeft = (touches[i].clientX - boundingRect.left) * scaleX;\n        const canvasTop = (touches[i].clientY - boundingRect.top) * scaleY;\n\n        pointer.dx = (canvasLeft - pointer.x) * 10.0;\n        pointer.dy = (canvasTop - pointer.y) * 10.0;\n        pointer.x = canvasLeft;\n        pointer.y = canvasTop;\n      }\n    },\n    false\n  );\n\n  sandCanvas.addEventListener(\"mousedown\", () => {\n    pointers[0].down = true;\n    pointers[0].color = fluidColor;\n  });\n\n  sandCanvas.addEventListener(\"touchstart\", e => {\n    if (e.cancelable) {\n      e.preventDefault();\n    }\n    const touches = e.targetTouches;\n    for (let i = 0; i < touches.length; i++) {\n      if (i >= pointers.length) pointers.push(new pointerPrototype());\n\n      const canvasLeft = (touches[i].clientX - boundingRect.left) * scaleX;\n      const canvasTop = (touches[i].clientY - boundingRect.top) * scaleY;\n\n      pointers[i].id = touches[i].identifier;\n      pointers[i].down = true;\n      pointers[i].x = canvasLeft;\n      pointers[i].y = canvasTop;\n      pointers[i].color = fluidColor;\n    }\n  });\n\n  window.addEventListener(\"mouseup\", () => {\n    pointers[0].down = false;\n  });\n\n  window.addEventListener(\"touchend\", e => {\n    const touches = e.changedTouches;\n    for (let i = 0; i < touches.length; i++)\n      for (let j = 0; j < pointers.length; j++)\n        if (touches[i].identifier == pointers[j].id) pointers[j].down = false;\n  });\n\n  return { update, reset };\n}\n\nexport { startFluid };\n","let baseVertex = require(\"./glsl/baseVertex.glsl\");\nlet clearShaderString = require(\"./glsl/clear.glsl\");\nlet displayShaderString = require(\"./glsl/display.glsl\");\nlet splatShaderString = require(\"./glsl/splat.glsl\");\nlet advectionManualFilteringShaderString = require(\"./glsl/advectionManualFilter.glsl\");\nlet advectionShaderString = require(\"./glsl/advection.glsl\");\nlet divergenceShaderString = require(\"./glsl/divergence.glsl\");\nlet curlShaderString = require(\"./glsl/curl.glsl\");\nlet vorticityShaderString = require(\"./glsl/vorticity.glsl\");\nlet pressureShaderString = require(\"./glsl/pressure.glsl\");\nlet gradientSubtractShaderString = require(\"./glsl/gradientSubtract.glsl\");\nlet velocityOutShaderString = require(\"./glsl/velocityOut.glsl\");\n\nfunction compileShaders(gl) {\n  function compileShader(type, source) {\n    const shader = gl.createShader(type);\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS))\n      throw gl.getShaderInfoLog(shader);\n\n    return shader;\n  }\n\n  const baseVertexShader = compileShader(gl.VERTEX_SHADER, baseVertex);\n  const clearShader = compileShader(gl.FRAGMENT_SHADER, clearShaderString);\n  const displayShader = compileShader(gl.FRAGMENT_SHADER, displayShaderString);\n  const splatShader = compileShader(gl.FRAGMENT_SHADER, splatShaderString);\n  const advectionManualFilteringShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    advectionManualFilteringShaderString\n  );\n  const advectionShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    advectionShaderString\n  );\n  const divergenceShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    divergenceShaderString\n  );\n  const curlShader = compileShader(gl.FRAGMENT_SHADER, curlShaderString);\n  const vorticityShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    vorticityShaderString\n  );\n  const pressureShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    pressureShaderString\n  );\n  const gradientSubtractShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    gradientSubtractShaderString\n  );\n  const velocityOutShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    velocityOutShaderString\n  );\n\n  return {\n    baseVertexShader,\n    clearShader,\n    displayShader,\n    splatShader,\n    advectionManualFilteringShader,\n    advectionShader,\n    divergenceShader,\n    curlShader,\n    vorticityShader,\n    pressureShader,\n    gradientSubtractShader,\n    velocityOutShader\n  };\n}\n\nexport { compileShaders };\n","const fps = new class {\n  constructor() {\n    this.fps = document.getElementById(\"fps\");\n    this.frames = [];\n    this.lastFrameTimeStamp = performance.now();\n  }\n\n  render() {\n    // Convert the delta time since the last frame render into a measure\n    // of frames per second.\n    const now = performance.now();\n    const delta = now - this.lastFrameTimeStamp;\n    this.lastFrameTimeStamp = now;\n    const fps = (1 / delta) * 1000;\n\n    // Save only the latest 100 timings.\n    this.frames.push(fps);\n    if (this.frames.length > 30) {\n      this.frames.shift();\n    }\n\n    // Find the max, min, and mean of our 100 latest timings.\n    let min = Infinity;\n    let max = -Infinity;\n    let sum = 0;\n    for (let i = 0; i < this.frames.length; i++) {\n      sum += this.frames[i];\n      min = Math.min(this.frames[i], min);\n      max = Math.max(this.frames[i], max);\n    }\n    let mean = sum / this.frames.length;\n\n    // Render the statistics.\n    this.fps.textContent = `FPS:${Math.round(mean)}`;\n  }\n}();\n\nexport { fps };\n","module.exports = \"\\nprecision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uVelocity;\\nuniform sampler2D uSource;\\nuniform sampler2D uWind;\\nuniform vec2 texelSize;\\nuniform float dt;\\nuniform float dissipation;\\nvoid main() {\\n  vec2 coord = vUv - dt * texture2D(uVelocity, vUv).xy * texelSize;\\n  float density = texture2D(uWind, vUv).w * 1.;\\n  if (density > 0.99) {\\n    density = 0.;\\n  }\\n\\n  gl_FragColor = dissipation * (texture2D(uSource, coord) + vec4(density));\\n  gl_FragColor.a = 1.0;\\n}\\n\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uVelocity;\\nuniform sampler2D uSource;\\nuniform sampler2D uWind;\\nuniform vec2 texelSize;\\nuniform float dt;\\nuniform float dissipation;\\nvec4 bilerp(in sampler2D sam, in vec2 p) {\\n  vec4 st;\\n  st.xy = floor(p - 0.5) + 0.5;\\n  st.zw = st.xy + 1.0;\\n  vec4 uv = st * texelSize.xyxy;\\n  vec4 a = texture2D(sam, uv.xy);\\n  vec4 b = texture2D(sam, uv.zy);\\n  vec4 c = texture2D(sam, uv.xw);\\n  vec4 d = texture2D(sam, uv.zw);\\n  vec2 f = p - st.xy;\\n  return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);\\n}\\nvoid main() {\\n  vec2 coord = gl_FragCoord.xy - dt * texture2D(uVelocity, vUv).xy;\\n  float density = texture2D(uWind, vUv).w;\\n  if (density > 0.99) {\\n    density = 0.;\\n  }\\n  gl_FragColor = dissipation * (bilerp(uSource, coord) + vec4(density));\\n  gl_FragColor.a = 1.0;\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nattribute vec2 aPosition;\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform vec2 texelSize;\\nvoid main() {\\n  vUv = aPosition * 0.5 + 0.5;\\n  vL = vUv - vec2(texelSize.x, 0.0);\\n  vR = vUv + vec2(texelSize.x, 0.0);\\n  vT = vUv + vec2(0.0, texelSize.y);\\n  vB = vUv - vec2(0.0, texelSize.y);\\n  gl_Position = vec4(aPosition, 0.0, 1.0);\\n}\\n\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uTexture;\\nuniform sampler2D uWind;\\nuniform float value;\\nvoid main() {\\n  float pressure = texture2D(uWind, vUv).z;\\n  pressure *= 512.;\\n  pressure *= pressure;\\n  gl_FragColor = value * (texture2D(uTexture, vUv) + vec4(pressure));\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uVelocity;\\nvoid main() {\\n  float L = texture2D(uVelocity, vL).y;\\n  float R = texture2D(uVelocity, vR).y;\\n  float T = texture2D(uVelocity, vT).x;\\n  float B = texture2D(uVelocity, vB).x;\\n  float vorticity = R - L - T + B;\\n  gl_FragColor = vec4(vorticity, 0.0, 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uTexture;\\nvoid main() {\\n  vec3 color = texture2D(uTexture, vUv).rgb * 0.1;\\n  color *= 0.5;\\n  color = min(color, 0.9);\\n  color = vec3(1.0) - color;\\n  color *= vec3(0.95, 0.9, 0.9);\\n  // color *= 0.5;\\n  gl_FragColor = vec4(color, 1.0);\\n}\\n\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uVelocity;\\nvec2 sampleVelocity(in vec2 uv) {\\n  vec2 multiplier = vec2(1.0, 1.0);\\n  if (uv.x < 0.0) {\\n    uv.x = 0.0;\\n    multiplier.x = -1.0;\\n  }\\n  if (uv.x > 1.0) {\\n    uv.x = 1.0;\\n    multiplier.x = -1.0;\\n  }\\n  if (uv.y < 0.0) {\\n    uv.y = 0.0;\\n    multiplier.y = -1.0;\\n  }\\n  if (uv.y > 1.0) {\\n    uv.y = 1.0;\\n    multiplier.y = -1.0;\\n  }\\n  return multiplier * texture2D(uVelocity, uv).xy;\\n}\\nvoid main() {\\n  float L = sampleVelocity(vL).x;\\n  float R = sampleVelocity(vR).x;\\n  float T = sampleVelocity(vT).y;\\n  float B = sampleVelocity(vB).y;\\n  float div = 0.5 * (R - L + T - B);\\n  gl_FragColor = vec4(div, 0.0, 0.0, 1.0);\\n}\\n\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uPressure;\\nuniform sampler2D uVelocity;\\nuniform sampler2D uWind;\\nuniform sampler2D uCells;\\n\\nvec2 boundary(in vec2 uv) {\\n  uv = min(max(uv, 0.0), 1.0);\\n  return uv;\\n}\\nvoid main() {\\n  float L = texture2D(uPressure, boundary(vL)).x;\\n  float R = texture2D(uPressure, boundary(vR)).x;\\n  float T = texture2D(uPressure, boundary(vT)).x;\\n  float B = texture2D(uPressure, boundary(vB)).x;\\n  vec2 velocity = texture2D(uVelocity, vUv).xy;\\n  vec2 wind = texture2D(uWind, vUv).xy;\\n  vec2 cell = texture2D(uCells, vec2(vUv.x, 1.0 - (vUv.y + (1.0 / 300.)))).xy;\\n  velocity.xy -= vec2(R - L, T - B);\\n  velocity.xy += wind * 25.;\\n\\n  int type = int((cell.r * 255.) + 0.1);\\n\\n  // || type == 7 || type == 9\\n  if (type == 1 || type == 5) {\\n    velocity = vec2(0.);\\n  }\\n  if (type == 0 || type == 4 || type == 6) {\\n\\n  } else {\\n    velocity = velocity * 0.95;\\n  }\\n  // velocity = cell.rg * 100.;\\n  gl_FragColor = vec4(velocity, 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vL;\\nvarying vec2 vR;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uPressure;\\nuniform sampler2D uDivergence;\\nvec2 boundary(in vec2 uv) {\\n  uv = min(max(uv, 0.0), 1.0);\\n  return uv;\\n}\\nvoid main() {\\n  float L = texture2D(uPressure, boundary(vL)).x;\\n  float R = texture2D(uPressure, boundary(vR)).x;\\n  float T = texture2D(uPressure, boundary(vT)).x;\\n  float B = texture2D(uPressure, boundary(vB)).x;\\n  float C = texture2D(uPressure, vUv).x;\\n  float divergence = texture2D(uDivergence, vUv).x;\\n  float pressure = (L + R + B + T - divergence) * 0.25;\\n  gl_FragColor = vec4(pressure, 0.0, 0.0, 1.0);\\n}\"","module.exports = \"precision highp float;\\n#define GLSLIFY 1\\nuniform float t;\\nuniform float dpi;\\nuniform vec2 resolution;\\nuniform bool isSnapshot;\\nuniform sampler2D backBuffer;\\nuniform sampler2D data;\\n\\nvarying vec2 uv;\\n\\n// clang-format off\\nvec3 hsv2rgb_3_0(vec3 c) {\\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\\n}\\n\\n\\n\\n//\\n// Description : Array and textureless GLSL 2D/3D/4D simplex\\n//               noise functions.\\n//      Author : Ian McEwan, Ashima Arts.\\n//  Maintainer : ijm\\n//     Lastmod : 20110822 (ijm)\\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\\n//               Distributed under the MIT License. See LICENSE file.\\n//               https://github.com/ashima/webgl-noise\\n//\\n\\nvec3 mod289_1_1(vec3 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec4 mod289_1_1(vec4 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec4 permute_1_2(vec4 x) {\\n     return mod289_1_1(((x*34.0)+1.0)*x);\\n}\\n\\nvec4 taylorInvSqrt_1_3(vec4 r)\\n{\\n  return 1.79284291400159 - 0.85373472095314 * r;\\n}\\n\\nfloat snoise_1_4(vec3 v)\\n  {\\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\\n  const vec4  D_1_5 = vec4(0.0, 0.5, 1.0, 2.0);\\n\\n// First corner\\n  vec3 i  = floor(v + dot(v, C.yyy) );\\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\\n\\n// Other corners\\n  vec3 g_1_6 = step(x0.yzx, x0.xyz);\\n  vec3 l = 1.0 - g_1_6;\\n  vec3 i1 = min( g_1_6.xyz, l.zxy );\\n  vec3 i2 = max( g_1_6.xyz, l.zxy );\\n\\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\\n  vec3 x1 = x0 - i1 + C.xxx;\\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\\n  vec3 x3 = x0 - D_1_5.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\\n\\n// Permutations\\n  i = mod289_1_1(i);\\n  vec4 p = permute_1_2( permute_1_2( permute_1_2(\\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\\n\\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\\n  float n_ = 0.142857142857; // 1.0/7.0\\n  vec3  ns = n_ * D_1_5.wyz - D_1_5.xzx;\\n\\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\\n\\n  vec4 x_ = floor(j * ns.z);\\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\\n\\n  vec4 x = x_ *ns.x + ns.yyyy;\\n  vec4 y = y_ *ns.x + ns.yyyy;\\n  vec4 h = 1.0 - abs(x) - abs(y);\\n\\n  vec4 b0 = vec4( x.xy, y.xy );\\n  vec4 b1 = vec4( x.zw, y.zw );\\n\\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\\n  vec4 s0 = floor(b0)*2.0 + 1.0;\\n  vec4 s1 = floor(b1)*2.0 + 1.0;\\n  vec4 sh = -step(h, vec4(0.0));\\n\\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\\n  vec4 a1_1_7 = b1.xzyw + s1.xzyw*sh.zzww ;\\n\\n  vec3 p0_1_8 = vec3(a0.xy,h.x);\\n  vec3 p1 = vec3(a0.zw,h.y);\\n  vec3 p2 = vec3(a1_1_7.xy,h.z);\\n  vec3 p3 = vec3(a1_1_7.zw,h.w);\\n\\n//Normalise gradients\\n  vec4 norm = taylorInvSqrt_1_3(vec4(dot(p0_1_8,p0_1_8), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\\n  p0_1_8 *= norm.x;\\n  p1 *= norm.y;\\n  p2 *= norm.z;\\n  p3 *= norm.w;\\n\\n// Mix final noise value\\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\\n  m = m * m;\\n  return 42.0 * dot( m*m, vec4( dot(p0_1_8,x0), dot(p1,x1),\\n                                dot(p2,x2), dot(p3,x3) ) );\\n  }\\n\\n\\n\\n//\\n// Description : Array and textureless GLSL 2D simplex noise function.\\n//      Author : Ian McEwan, Ashima Arts.\\n//  Maintainer : ijm\\n//     Lastmod : 20110822 (ijm)\\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\\n//               Distributed under the MIT License. See LICENSE file.\\n//               https://github.com/ashima/webgl-noise\\n//\\n\\nvec3 mod289_2_9(vec3 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec2 mod289_2_9(vec2 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec3 permute_2_10(vec3 x) {\\n  return mod289_2_9(((x*34.0)+1.0)*x);\\n}\\n\\nfloat snoise_2_11(vec2 v)\\n  {\\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\\n                      0.024390243902439); // 1.0 / 41.0\\n// First corner\\n  vec2 i  = floor(v + dot(v, C.yy) );\\n  vec2 x0 = v -   i + dot(i, C.xx);\\n\\n// Other corners\\n  vec2 i1;\\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\\n  //i1.y = 1.0 - i1.x;\\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\\n  // x1 = x0 - i1 + 1.0 * C.xx ;\\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\\n  vec4 x12 = x0.xyxy + C.xxzz;\\n  x12.xy -= i1;\\n\\n// Permutations\\n  i = mod289_2_9(i); // Avoid truncation effects in permutation\\n  vec3 p = permute_2_10( permute_2_10( i.y + vec3(0.0, i1.y, 1.0 ))\\n    + i.x + vec3(0.0, i1.x, 1.0 ));\\n\\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\\n  m = m*m ;\\n  m = m*m ;\\n\\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\\n\\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\\n  vec3 h = abs(x) - 0.5;\\n  vec3 ox = floor(x + 0.5);\\n  vec3 a0 = x - ox;\\n\\n// Normalise gradients implicitly by scaling m\\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\\n\\n// Compute final noise value at P\\n  vec3 g;\\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\\n  return 130.0 * dot(m, g);\\n}\\n\\n\\n\\nhighp float random_4_12(vec2 co)\\n{\\n    highp float a = 12.9898;\\n    highp float b = 78.233;\\n    highp float c = 43758.5453;\\n    highp float dt= dot(co.xy ,vec2(a,b));\\n    highp float sn= mod(dt,3.14);\\n    return fract(sin(sn) * c);\\n}\\n\\n\\n\\n// clang-format on\\n\\nvoid main() {\\n  vec3 color;\\n  //   float r = abs(sin(t / 25.));\\n  //   if (length(uv) < r && length(uv) > r - 0.1) {\\n  // color = hsv2rgb(vec3(sin(t * 0.01), 0.5, 0.5));\\n\\n  vec2 textCoord = (uv * vec2(0.5, -0.5)) + vec2(0.5);\\n  // vec3 bb = texture2D(backBuffer, (uv * 0.5) + vec2(0.5)).rgb;\\n\\n  vec4 data = texture2D(data, textCoord);\\n  int type = int((data.r * 255.) + 0.1);\\n  float hue = 0.0;\\n  float saturation = 0.6;\\n  float lightness = 0.3 + data.g * 0.5;\\n  float noise = snoise_1_4(vec3(floor(uv * resolution / dpi), t * 0.05));\\n  float a = 1.0;\\n\\n  if (type == 0) {\\n    hue = 0.0;\\n    saturation = 0.1;\\n    lightness = 0.1;\\n    a = 0.1;\\n    if (isSnapshot) {\\n      saturation = 0.05;\\n      lightness = 1.01;\\n      a = 1.0;\\n    }\\n  } else if (type == 1) {\\n    hue = 0.1;\\n    saturation = 0.1;\\n    lightness = 0.4;\\n  } else if (type == 2) {\\n    hue = 0.1;\\n    saturation = 0.5;\\n    lightness += 0.3;\\n  } else if (type == 3) { // water\\n    hue = 0.6;\\n    lightness = 0.7 + data.g * 0.25 + noise * 0.1;\\n  } else if (type == 4) { // gas\\n    hue = 0.0;\\n    lightness += 0.4;\\n    saturation = 0.2 + (data.b * 1.5);\\n  } else if (type == 5) { // clone\\n    hue = 0.9;\\n    saturation = 0.3;\\n  } else if (type == 6) { // fire\\n    hue = (data.g * 0.1);\\n    saturation = 0.7;\\n\\n    lightness = 0.7 + (data.g * 0.3) + ((noise + 0.8) * 0.5);\\n  } else if (type == 7) { // wood\\n    hue = (data.g * 0.1);\\n    saturation = 0.3;\\n    lightness = 0.3 + data.g * 0.3;\\n  } else if (type == 8) { // lava\\n    hue = (data.g * 0.1);\\n    lightness = 0.7 + data.g * 0.25 + noise * 0.1;\\n  } else if (type == 9) { // ice\\n    hue = 0.6;\\n    saturation = 0.4;\\n    lightness = 0.7 + data.g * 0.5;\\n  } else if (type == 10) { // sink\\n    hue = 0.9;\\n    saturation = 0.4;\\n    lightness = 1.0;\\n  } else if (type == 11) { // plant\\n    hue = 0.4;\\n    saturation = 0.4;\\n  } else if (type == 12) { // acid\\n    hue = 0.18;\\n    saturation = 0.9;\\n    lightness = 0.8 + data.g * 0.2 + noise * 0.05;\\n  } else if (type == 13) { // stone\\n    hue = -0.4 + (data.g * 0.5);\\n    saturation = 0.1;\\n    // lightness = 0.2 + data.g * 0.5;\\n  } else if (type == 14) { // dust\\n    hue = (data.g * 2.0) + t * .0008;\\n    saturation = 0.4;\\n    lightness = 0.8;\\n  } else if (type == 15) { // mite\\n    hue = 0.8;\\n    saturation = 0.9;\\n    lightness = 0.8;\\n  } else if (type == 16) { // oil\\n    hue = (data.g * 5.0) + t * .008;\\n\\n    saturation = 0.2;\\n    lightness = 0.3;\\n  } else if (type == 17) { // Rocket\\n    hue = 0.0;\\n    saturation = 0.4 + data.b;\\n    lightness = 0.9;\\n  } else if (type == 18) { // fungus\\n    hue = (data.g * 0.15) - 0.1;\\n    saturation = (data.g * 0.8) - 0.05;\\n\\n    // (data.g * 0.00);\\n    lightness = 1.5 - (data.g * 0.2);\\n  } else if (type == 19) { // seed/flower\\n\\n    hue = fract(fract(data.b * 2.) * 0.5) - 0.3;\\n    saturation = 0.7 * (data.g + 0.4) + data.b * 0.2;\\n    lightness = 0.9 * (data.g + 0.9);\\n  }\\n  if (isSnapshot == false) {\\n    lightness *= (0.975 + snoise_2_11(floor(uv * resolution / dpi)) * 0.025);\\n  }\\n  color = hsv2rgb_3_0(vec3(hue, saturation, lightness));\\n  gl_FragColor = vec4(color, a);\\n}\"","module.exports = \"\\n// boring \\\"pass-through\\\" vertex shader\\nprecision mediump float;\\n#define GLSLIFY 1\\nattribute vec2 position;\\nvarying vec2 uv;\\nvoid main() {\\n  uv = position;\\n  gl_Position = vec4(position, 0, 1);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uTarget;\\nuniform float aspectRatio;\\nuniform vec3 color;\\nuniform vec2 point;\\nuniform float radius;\\nvoid main() {\\n  vec2 p = vUv - point.xy;\\n  p.x *= aspectRatio;\\n  vec3 splat = exp(-dot(p, p) / radius) * color;\\n  vec3 base = texture2D(uTarget, vUv).xyz;\\n  gl_FragColor = vec4(base + splat, 1.0);\\n}\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform sampler2D uTexture;\\nuniform sampler2D uPressure;\\nvoid main() {\\n  vec2 v = texture2D(uTexture, vUv).rg;\\n  float p = texture2D(uPressure, vUv).r;\\n  vec3 vp = vec3(v, p);\\n  vp = max(vp, vec3(-250.));\\n  vp = min(vp, vec3(250.));\\n  vp /= 500.;\\n  vp += vec3(0.5, 0.5, 0.);\\n  // v = vec2(0.5);\\n  gl_FragColor = vec4(vp, 0.0);\\n}\\n\"","module.exports = \"precision highp float;\\nprecision mediump sampler2D;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying vec2 vT;\\nvarying vec2 vB;\\nuniform sampler2D uVelocity;\\nuniform sampler2D uCurl;\\nuniform float curl;\\nuniform float dt;\\nvoid main() {\\n  float T = texture2D(uCurl, vT).x;\\n  float B = texture2D(uCurl, vB).x;\\n  float C = texture2D(uCurl, vUv).x;\\n  vec2 force = vec2(abs(T) - abs(B), 0.0);\\n  force *= 1.0 / length(force + 0.00001) * curl * C;\\n  vec2 vel = texture2D(uVelocity, vUv).xy;\\n  gl_FragColor = vec4(vel + force * dt, 0.0, 1.0);\\n}\"","import \"./api\";\nimport { Universe } from \"../crate/pkg\";\n\nimport { startWebGL } from \"./render\";\nimport { fps } from \"./fps\";\nimport {} from \"./paint\";\nimport {} from \"./app\";\nimport { startFluid } from \"./fluid\";\n\nif (window.safari) {\n  history.pushState(null, null, location.href);\n  window.onpopstate = function(event) {\n    history.go(1);\n  };\n}\n\nfunction mobileAndTabletcheck() {\n  var check = false;\n  (function(a) {\n    if (\n      /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(\n        a\n      ) ||\n      /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(\n        a.substr(0, 4)\n      )\n    )\n      check = true;\n  })(navigator.userAgent || navigator.vendor || window.opera);\n  return check;\n}\n\nif (mobileAndTabletcheck()) {\n  window.onbeforeunload = function() {\n    return true;\n  };\n}\n\nif (\"serviceWorker\" in navigator) {\n  window.addEventListener(\"load\", () => {\n    navigator.serviceWorker\n      .register(\"/service-worker.js\")\n      .then(registration => {\n        console.log(\"SW registered: \", registration);\n      })\n      .catch(registrationError => {\n        console.log(\"SW registration failed: \", registrationError);\n      });\n  });\n}\n\nlet n = 300;\nconst universe = Universe.new(n, n);\n\nlet width = n;\nlet height = n;\nconst canvas = document.getElementById(\"sand-canvas\");\nconst canvas2 = document.getElementById(\"fluid-canvas\");\n\ncanvas.height = n;\ncanvas.width = n;\n\ndocument.getElementById(\"background\").addEventListener(\"touchmove\", e => {\n  if (!window.paused) {\n    if (e.cancelable) {\n      e.preventDefault();\n    }\n  }\n});\n\nconst ui = document.getElementById(\"ui\");\n\nlet resize = () => {\n  let screen_width = window.innerWidth;\n  let uiheight = 50;\n  let screen_height = window.innerHeight - uiheight;\n\n  let canvasStyle = \"\";\n  let uiStyle = \"\";\n  if (screen_width > screen_height) {\n    if (screen_width - window.innerHeight < 400) {\n      // landscape compressed\n\n      canvasStyle = `height: ${window.innerHeight}px; margin:3px`;\n      uiStyle = `width: ${screen_width -\n        window.innerHeight -\n        12}px; margin: 2px;`;\n    } else {\n      // landscape wide\n      canvasStyle = `height: ${window.innerHeight}px`;\n      uiStyle = `width: ${(screen_width - window.innerHeight) / 2 -\n        7}px; margin: 2px;`;\n    }\n  } else {\n    //portrait (mobile)\n    canvasStyle = `width: ${screen_width}px; bottom:3px;`;\n    uiStyle = \"\";\n  }\n  ui.style = uiStyle;\n  canvas.style = canvasStyle;\n  canvas2.style = canvasStyle;\n};\n\nresize();\nwindow.addEventListener(\"deviceorientation\", resize, true);\nwindow.addEventListener(\"resize\", resize);\n\nlet fluid = startFluid({ universe });\n\nlet drawSand = startWebGL({ canvas, universe });\n\nconst renderLoop = () => {\n  if (!window.paused) {\n    fps.render(); // new\n    universe.tick();\n    fluid.update();\n  }\n  drawSand();\n\n  window.animationId = requestAnimationFrame(renderLoop);\n};\n\nrenderLoop();\n\nfunction reset() {\n  fluid.reset();\n  fluid.update();\n  fluid.reset();\n  fluid.update();\n\n  universe.reset();\n}\nwindow.u = universe;\nexport { canvas, width, height, universe, reset };\n","import { height, universe, width } from \"./index.js\";\nimport { sizeMap } from \"./components/ui\";\nconst canvas = document.getElementById(\"sand-canvas\");\n\nconst eventDistance = (a, b) => {\n  return Math.sqrt(\n    Math.pow(a.clientX - b.clientX, 2) + Math.pow(a.clientY - b.clientY, 2),\n    2\n  );\n};\n\nconst magnitude = a => {\n  return Math.sqrt(Math.pow(a.clientX, 2) + Math.pow(a.clientY, 2), 2);\n};\n\nconst norm = a => {\n  let mag = magnitude(a);\n  return { clientX: a.clientX / mag, clientY: a.clientY / mag };\n};\nconst scale = (a, s) => {\n  return { clientX: a.clientX * s, clientY: a.clientY * s };\n};\nconst add = (a, b) => {\n  return { clientX: a.clientX + b.clientX, clientY: a.clientY + b.clientY };\n};\nconst sub = (a, b) => {\n  return { clientX: a.clientX - b.clientX, clientY: a.clientY - b.clientY };\n};\n\nlet painting = false;\nlet lastPaint = null;\nlet repeat = null;\n\ncanvas.addEventListener(\"mousedown\", event => {\n  event.preventDefault();\n  universe.push_undo();\n  painting = true;\n  clearInterval(repeat);\n  repeat = window.setInterval(() => paint(event), 100);\n  paint(event);\n  lastPaint = event;\n});\n\ndocument.body.addEventListener(\"mouseup\", event => {\n  clearInterval(repeat);\n  if (painting) {\n    event.preventDefault();\n    lastPaint = null;\n    painting = false;\n  }\n});\n\ncanvas.addEventListener(\"mousemove\", event => {\n  clearInterval(repeat);\n  smoothPaint(event);\n});\n\ncanvas.addEventListener(\"mouseleave\", event => {\n  clearInterval(repeat);\n  lastPaint = null;\n});\n\ncanvas.addEventListener(\"touchstart\", event => {\n  universe.push_undo();\n  if (event.cancelable) {\n    event.preventDefault();\n  }\n  painting = true;\n  lastPaint = event;\n  handleTouches(event);\n});\n\ncanvas.addEventListener(\"touchend\", event => {\n  if (event.cancelable) {\n    event.preventDefault();\n  }\n  lastPaint = null;\n  painting = false;\n  clearInterval(repeat);\n});\n\ncanvas.addEventListener(\"touchmove\", event => {\n  if (!window.paused) {\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n  }\n  clearInterval(repeat);\n  handleTouches(event);\n});\n\nfunction smoothPaint(event) {\n  clearInterval(repeat);\n  repeat = window.setInterval(() => paint(event), 100);\n  let startEvent = { clientX: event.clientX, clientY: event.clientY };\n  if (!painting) {\n    return;\n  }\n  let size = sizeMap[window.UI.state.size];\n  let i = 0;\n  paint(startEvent);\n  if (lastPaint) {\n    while (eventDistance(startEvent, lastPaint) > size / 3) {\n      let d = eventDistance(startEvent, lastPaint);\n      startEvent = add(\n        startEvent,\n        scale(norm(sub(lastPaint, event)), Math.min(size / 3, d))\n      );\n      i++;\n      if (i > 1000) {\n        break;\n      }\n      paint(startEvent);\n    }\n  }\n  lastPaint = event;\n}\n\nconst handleTouches = event => {\n  let touches = Array.from(event.touches);\n  if (touches.length == 1) {\n    smoothPaint(touches[0]);\n  } else {\n    touches.forEach(paint);\n  }\n};\n\nconst paint = event => {\n  if (!painting) {\n    return;\n  }\n  const boundingRect = canvas.getBoundingClientRect();\n\n  const scaleX = canvas.width / window.devicePixelRatio / boundingRect.width;\n  const scaleY = canvas.height / window.devicePixelRatio / boundingRect.height;\n\n  const canvasLeft = (event.clientX - boundingRect.left) * scaleX;\n  const canvasTop = (event.clientY - boundingRect.top) * scaleY;\n\n  const x = Math.min(Math.floor(canvasLeft), width - 1);\n  const y = Math.min(Math.floor(canvasTop), height - 1);\n  if (window.UI.state.selectedElement < 0) return;\n  universe.paint(\n    x,\n    y,\n    sizeMap[window.UI.state.size],\n    window.UI.state.selectedElement\n  );\n};\n","const reglBuilder = require(\"regl\");\nimport { memory } from \"../crate/pkg/sandtable_bg\";\nimport { Species } from \"../crate/pkg/sandtable\";\nimport { Universe } from \"../crate/pkg\";\n\nlet fsh = require(\"./glsl/sand.glsl\");\nlet vsh = require(\"./glsl/sandVertex.glsl\");\n\nlet startWebGL = ({ canvas, universe, isSnapshot = false }) => {\n  const regl = reglBuilder({\n    canvas,\n    attributes: { preserveDrawingBuffer: isSnapshot }\n  });\n  // const lastFrame = regl.texture();\n  const width = universe.width();\n  const height = universe.height();\n  let cell_pointer = universe.cells();\n  let cells = new Uint8Array(memory.buffer, cell_pointer, width * height * 4);\n  const dataTexture = regl.texture({ width, height, data: cells });\n\n  let drawSand = regl({\n    frag: fsh,\n    uniforms: {\n      t: ({ tick }) => tick,\n      data: () => {\n        // if (cell_pointer != universe.cells()) {\n        //   console.log(cell_pointer);\n        // }\n        cell_pointer = universe.cells();\n        cells = new Uint8Array(memory.buffer, cell_pointer, width * height * 4);\n        // }\n\n        return dataTexture({ width, height, data: cells });\n      },\n      resolution: ({ viewportWidth, viewportHeight }) => [\n        viewportWidth,\n        viewportHeight\n      ],\n      dpi: window.devicePixelRatio * 2,\n      isSnapshot\n      // backBuffer: lastFrame\n    },\n\n    vert: vsh,\n    attributes: {\n      // Full screen triangle\n      position: [[-1, 4], [-1, -1], [4, -1]]\n    },\n    // Our triangle has 3 vertices\n    count: 3\n  });\n\n  return () => {\n    regl.poll();\n    drawSand();\n  };\n};\n\nlet snapshot = universe => {\n  let canvas = document.createElement(\"canvas\");\n  canvas.width = universe.width() / 2;\n  canvas.height = universe.height() / 2;\n  let render = startWebGL({ universe, canvas, isSnapshot: true });\n  render();\n\n  return canvas.toDataURL(\"image/png\");\n};\n\nlet pallette = () => {\n  let canvas = document.createElement(\"canvas\");\n\n  let species = Object.values(Species);\n  let range = Math.max(...species) + 1;\n  let universe = Universe.new(range, 1);\n  canvas.width = range;\n  canvas.height = 3;\n  universe.reset();\n\n  species.forEach(id => universe.paint(id, 0, 2, id));\n\n  let render = startWebGL({ universe, canvas, isSnapshot: true });\n  render();\n  let ctx = canvas.getContext(\"webgl\");\n  let data = new Uint8Array(range * 4);\n  ctx.readPixels(0, 0, range, 1, ctx.RGBA, ctx.UNSIGNED_BYTE, data);\n  let colors = {};\n  species.forEach(id => {\n    let index = id * 4;\n    let color = `rgba(${data[index]},${data[index + 1]}, ${\n      data[index + 2]\n    }, 0.25)`;\n    colors[id] = color;\n  });\n  return colors;\n};\n\nexport { startWebGL, snapshot, pallette };\n"],"sourceRoot":""}