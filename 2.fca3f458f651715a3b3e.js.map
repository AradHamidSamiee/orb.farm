{"version":3,"sources":["webpack:///./js/render.js","webpack:///./js/fps.js","webpack:///./js/components/menu.js","webpack:///./js/components/ui.js","webpack:///./js/paint.js","webpack:///./js/components/info.js","webpack:///./js/app.js","webpack:///./js/shaderToy.js","webpack:///./js/index.js","webpack:///./js/glsl/sand.glsl","webpack:///./js/glsl/sandVertex.glsl","webpack:///./crate/pkg/sandtable.js","webpack:///./js/setup.js","webpack:///./js/glsl/sky.glsl"],"names":["reglBuilder","require","window","memory","fsh","vsh","startWebGL","canvas","universe","isSnapshot","regl","attributes","preserveDrawingBuffer","width","height","cell_pointer","cells","light_pointer","lights","Uint8Array","buffer","dataTexture","texture","data","lightTexture","drawSand","blend","enable","func","srcRGB","srcAlpha","dstRGB","dstAlpha","equation","rgb","alpha","color","frag","uniforms","t","tick","light","resolution","viewportWidth","viewportHeight","dpi","devicePixelRatio","vert","position","count","poll","fps","this","document","getElementById","frames","lastFrameTimeStamp","performance","now","delta","push","length","shift","min","Infinity","max","sum","i","Math","mean","textContent","round","u","O2","CO2","Menu","close","children","className","to","onClick","species","Species","pallette_data","createElement","Object","values","range","Universe","reset","forEach","id","paint","render","ctx","getContext","readPixels","RGBA","UNSIGNED_BYTE","colors","index","pallette","sizeMap","Index","props","state","submissionMenuOpen","paused","submitting","size","dataURL","currentSubmission","selectedElement","Water","UI","load","React","Component","prevProps","location","pathname","pause","hash","setState","event","preventDefault","confirm","play","toDataURL","snapshot","context","imgData","createImageData","putImageData","cellData","title","payload","image","fetch","functions","_url","method","body","JSON","stringify","headers","then","res","json","response","console","log","error","replace","storage","refFromURL","getDownloadURL","dlurl","blob","url","URL","createObjectURL","img","Image","src","onload","drawImage","getImageData","cellsData","flush_undos","push_undo","Fragment","togglePause","viewBox","points","map","v","key","e","setSize","style","padding","cx","cy","r","pop_undo","fontSize","keys","filter","name","includes","n","setElement","elementID","selected","background","backgroundColor","ElementButton","incScore","score","closeMenu","display","placeholder","onChange","target","value","disabled","submit","eventDistance","a","b","sqrt","pow","clientX","clientY","norm","mag","magnitude","scale","s","add","sub","painting","lastPaint","repeat","smoothPaint","clearInterval","setInterval","startEvent","d","addEventListener","cancelable","handleTouches","touches","Array","from","boundingRect","getBoundingClientRect","scaleX","ratio","ceil","scaleY","canvasLeft","left","canvasTop","top","x","floor","y","Info","href","BrowseRouter","match","Browse","AdminRouter","Admin","SigninRouter","SignInScreen","ReactDOM","path","component","exact","webGL","canvasId","gl","getExtension","textures","fragmentShader","shader","WebGL","linkShader","vertexAttribute","getAttribLocation","enableVertexAttribArray","innerHeight","innerWidth","setAttribute","vertexBuffer","createVBO","running","time0","stride","vertexData","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","itemSize","numItems","vertexSource","fragmentSource","program","createProgram","attachShader","compileShader","VERTEX_SHADER","FRAGMENT_SHADER","linkProgram","getProgramParameter","LINK_STATUS","showLog","uniformLocation","getUniformLocation","shaderType","source","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","type","Date","getTime","channelNumber","createTexture","bindTexture","TEXTURE_2D","pixelStorei","UNPACK_FLIP_Y_WEBGL","texImage2D","err","c","parseInt","concat","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","_start","timePreviousFrame","disable","DEPTH_TEST","viewport","useProgram","gameTime","time","channel","clear","DEPTH_BUFFER_BIT","vertexAttribPointer","FLOAT","activeTexture","TEXTURE0","uniform1i","uniform3f","uniform1f","drawArrays","TRIANGLE_STRIP","loadTexture","start","h","Glass","Wood","Air","Sand","Zoop","Fish","Bacteria","Seed","Algae","ui","resize","screen_width","canvasStyle","uiStyle","renderLoop","set_time","frame","animWebationId","requestAnimationFrame","module","exports","cachedTextDecoder","TextDecoder","cachegetUint8Memory","getStringFromWasm","ptr","len","decode","wasm","subarray","what","freeze","Plant","Egg","FishTail","Nitrogen","Waste","Stone","brightness","dx","dy","obj","create","prototype","ret","__wrap","__wbg_random_09364f2d8647f133","random","Error","__wbindgen_throw","arg0","arg1","check","safari","history","pushState","onpopstate","go","navigator","userAgent","vendor","opera","test","substr","onbeforeunload"],"mappings":"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","file":"2.fca3f458f651715a3b3e.js","sourcesContent":["const reglBuilder = require(\"regl\");\nimport { memory } from \"../crate/pkg/sandtable_bg\";\nwindow.memory = memory;\nimport { Species } from \"../crate/pkg/sandtable\";\nimport { Universe } from \"../crate/pkg\";\n\nlet fsh = require(\"./glsl/sand.glsl\");\nlet vsh = require(\"./glsl/sandVertex.glsl\");\n\nlet startWebGL = ({ canvas, universe, isSnapshot = false }) => {\n  const regl = reglBuilder({\n    canvas,\n    attributes: { preserveDrawingBuffer: isSnapshot }\n  });\n  // const lastFrame = regl.texture();\n  const width = universe.width();\n  const height = universe.height();\n  let cell_pointer = universe.cells();\n  let light_pointer = universe.lights();\n  let cells = new Uint8Array(memory.buffer, cell_pointer, width * height * 4);\n  let lights = new Uint8Array(memory.buffer, light_pointer, width * height * 4);\n  const dataTexture = regl.texture({ width, height, data: cells });\n  const lightTexture = regl.texture({ width, height, data: lights });\n\n  let drawSand = regl({\n    blend: {\n      enable: true,\n      func: {\n        srcRGB: \"src alpha\",\n        srcAlpha: 1,\n        dstRGB: \"one minus src alpha\",\n        dstAlpha: 1\n      },\n      equation: {\n        rgb: \"add\",\n        alpha: \"add\"\n      },\n      color: [0, 0, 0, 0]\n    },\n    frag: fsh,\n    uniforms: {\n      t: ({ tick }) => tick,\n      data: () => {\n        cell_pointer = universe.cells();\n        cells = new Uint8Array(memory.buffer, cell_pointer, width * height * 4);\n\n        return dataTexture({ width, height, data: cells });\n      },\n      light: () => {\n        light_pointer = universe.lights();\n\n        lights = new Uint8Array(\n          memory.buffer,\n          light_pointer,\n          width * height * 4\n        );\n\n        return lightTexture({ width, height, data: lights });\n      },\n      resolution: ({ viewportWidth, viewportHeight }) => [\n        viewportWidth,\n        viewportHeight\n      ],\n      dpi: window.devicePixelRatio * 2,\n      isSnapshot\n      // backBuffer: lastFrame\n    },\n\n    vert: vsh,\n    attributes: {\n      // Full screen triangle\n      position: [[-1, 4], [-1, -1], [4, -1]]\n    },\n    // Our triangle has 3 vertices\n    count: 3\n  });\n\n  return () => {\n    regl.poll();\n    drawSand();\n  };\n};\n\nlet snapshot = universe => {\n  let canvas = document.createElement(\"canvas\");\n  canvas.width = universe.width() / 2;\n  canvas.height = universe.height() / 2;\n  let render = startWebGL({ universe, canvas, isSnapshot: true });\n  render();\n\n  return canvas.toDataURL(\"image/png\");\n};\n\nlet pallette = () => {\n  let canvas = document.createElement(\"canvas\");\n\n  let species = Object.values(Species);\n  let range = Math.max(...species) + 1;\n  let universe = Universe.new(range, 1);\n  canvas.width = range;\n  canvas.height = 3;\n  universe.reset();\n\n  species.forEach(id => universe.paint(id, 0, 2, id));\n\n  let render = startWebGL({ universe, canvas, isSnapshot: true });\n  render();\n  let ctx = canvas.getContext(\"webgl\");\n  let data = new Uint8Array(range * 4);\n  ctx.readPixels(0, 0, range, 1, ctx.RGBA, ctx.UNSIGNED_BYTE, data);\n  let colors = {};\n  species.forEach(id => {\n    let index = id * 4;\n    let color = `rgba(${data[index]},${data[index + 1]}, ${\n      data[index + 2]\n    }, 1.0)`;\n    colors[id] = color;\n  });\n  return colors;\n};\n\nexport { startWebGL, snapshot, pallette };\n","const fps = new (class {\n  constructor() {\n    this.fps = document.getElementById(\"fps\");\n    this.frames = [];\n    this.lastFrameTimeStamp = performance.now();\n  }\n\n  render() {\n    // Convert the delta time since the last frame render into a measure\n    // of frames per second.\n    const now = performance.now();\n    const delta = now - this.lastFrameTimeStamp;\n    this.lastFrameTimeStamp = now;\n    const fps = (1 / delta) * 1000;\n\n    // Save only the latest 100 timings.\n    this.frames.push(fps);\n    if (this.frames.length > 30) {\n      this.frames.shift();\n    }\n\n    // Find the max, min, and mean of our 100 latest timings.\n    let min = Infinity;\n    let max = -Infinity;\n    let sum = 0;\n    for (let i = 0; i < this.frames.length; i++) {\n      sum += this.frames[i];\n      min = Math.min(this.frames[i], min);\n      max = Math.max(this.frames[i], max);\n    }\n    let mean = sum / this.frames.length;\n\n    // Render the statistics.\n    this.fps.textContent = `FPS:${Math.round(mean)}\n    O2: ${window.u.O2()}\n    CO2: ${window.u.CO2()}\n    `;\n  }\n})();\n\nexport { fps };\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nconst Menu = ({ close, children }) => {\n  return (\n    <div className=\"menu-scrim\">\n      <div className={\"menu\"}>\n        {children}\n        <Link to=\"/\" className=\"x\" onClick={close}>\n          <button> x</button>\n        </Link>\n      </div>\n    </div>\n  );\n};\nexport default Menu;\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nimport { memory } from \"../../crate/pkg/sandtable_bg\";\nimport { Species } from \"../../crate/pkg/sandtable\";\n\nimport { height, universe, width, reset } from \"../index.js\";\nimport { snapshot, pallette } from \"../render.js\";\n\nimport Menu from \"./menu\";\n\nwindow.species = Species;\nlet pallette_data = pallette();\n\nconst ElementButton = (name, selectedElement, setElement) => {\n  let elementID = Species[name];\n\n  let color = pallette_data[elementID];\n  let selected = elementID == selectedElement;\n\n  let background = \"inherit\";\n\n  return (\n    <button\n      className={selected ? \"selected\" : \"\"}\n      key={name}\n      onClick={() => {\n        setElement(elementID);\n      }}\n      style={{\n        background,\n        backgroundColor: color,\n        filter: selected || `saturate(0.5) `\n      }}\n    >\n      {\"  \"}\n      {name}\n      {\"  \"}\n    </button>\n  );\n};\n\nlet sizeMap = [2, 5, 10];\n\nclass Index extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      submissionMenuOpen: false,\n      paused: false,\n      submitting: false,\n      size: 1,\n      dataURL: {},\n      currentSubmission: null,\n      selectedElement: Species.Water\n    };\n    window.UI = this;\n\n    this.load();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (\n      this.props.location.pathname === \"/\" &&\n      prevProps.location.pathname !== \"/\" &&\n      this.state.currentSubmission\n    ) {\n      window.location = `#${this.state.currentSubmission.id}`;\n      return;\n    }\n    if (\n      this.props.location.pathname !== \"/\" &&\n      prevProps.location.pathname == \"/\"\n    ) {\n      this.pause();\n    }\n    if (\n      prevProps.location.hash === \"\" ||\n      prevProps.location.hash != this.props.location.hash\n    ) {\n      this.load();\n    }\n  }\n  togglePause() {\n    window.paused = !this.state.paused;\n    this.setState({ paused: !this.state.paused });\n  }\n  play() {\n    window.paused = false;\n    this.setState({ paused: false });\n  }\n  pause() {\n    window.paused = true;\n    this.setState({ paused: true });\n  }\n\n  setSize(event, size) {\n    event.preventDefault();\n    this.setState({\n      size\n    });\n  }\n  reset() {\n    if (window.confirm(\"Reset?\")) {\n      this.play();\n      window.location = \"#\";\n      this.setState({ currentSubmission: null });\n      reset();\n    }\n  }\n  menu() {\n    this.pause();\n    this.setState({ submissionMenuOpen: true });\n  }\n\n  closeMenu() {\n    this.play();\n    this.setState({ submissionMenuOpen: false });\n  }\n  upload() {\n    let dataURL = snapshot(universe);\n    const cells = new Uint8Array(\n      memory.buffer,\n      universe.cells(),\n      width * height * 4\n    );\n\n    // Create canvas\n    let canvas = document.createElement(\"canvas\"),\n      context = canvas.getContext(\"2d\"),\n      imgData = context.createImageData(width, height);\n\n    canvas.height = height;\n    canvas.width = width;\n\n    // fill imgData with data from cells\n    for (var i = 0; i < width * height * 4; i++) {\n      if (i % 4 == 3) {\n        imgData.data[i] = 255;\n      } else {\n        imgData.data[i] = cells[i];\n      }\n    }\n    // put data to context at (0, 0)\n    context.putImageData(imgData, 0, 0);\n\n    let cellData = canvas.toDataURL(\"image/png\");\n\n    this.pause();\n    this.setState({\n      data: { dataURL, cells: cellData },\n      submissionMenuOpen: true\n    });\n  }\n  submit() {\n    let { title, data } = this.state;\n    let { dataURL, cells } = data;\n    let payload = { title, image: dataURL, cells };\n    this.setState({ submitting: true });\n\n    fetch(functions._url(\"api/creations\"), {\n      method: \"POST\",\n      body: JSON.stringify(payload), // data can be `string` or {object}!\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    })\n      .then(res => res.json())\n      .then(response => {\n        console.log(\"Success:\", JSON.stringify(response));\n        this.play();\n      })\n      .catch(error => console.error(\"Error:\", error))\n      .then(() => {\n        this.setState({ submissionMenuOpen: false, submitting: false });\n      });\n  }\n\n  load() {\n    let { location } = this.props;\n    let id = location.hash.replace(/#/, \"\");\n    if (id === \"\") {\n      return;\n    }\n\n    if (this.state.currentSubmission && this.state.currentSubmission.id == id) {\n      return;\n    }\n\n    fetch(functions._url(`api/creations/${id}`), {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    })\n      .then(res => res.json())\n      .then(data => {\n        storage\n          .refFromURL(\n            `gs://sandtable-8d0f7.appspot.com/creations/${data.id}.data.png`\n          )\n          .getDownloadURL()\n          .then(dlurl => {\n            fetch(dlurl, {\n              method: \"GET\"\n            })\n              .then(res => res.blob())\n              .then(blob => {\n                // console.log(response);\n                this.setState({ currentSubmission: { id, data } });\n\n                var url = URL.createObjectURL(blob);\n                var img = new Image();\n                img.src = url;\n                img.onload = () => {\n                  var canvas = document.createElement(\"canvas\");\n                  canvas.width = width;\n                  canvas.height = height;\n                  var ctx = canvas.getContext(\"2d\");\n                  ctx.drawImage(img, 0, 0);\n                  var imgData = ctx.getImageData(\n                    0,\n                    0,\n                    canvas.width,\n                    canvas.height\n                  );\n\n                  const cellsData = new Uint8Array(\n                    memory.buffer,\n                    universe.cells(),\n                    width * height * 4\n                  );\n\n                  reset();\n\n                  for (var i = 0; i < width * height * 4; i++) {\n                    cellsData[i] = imgData.data[i];\n                  }\n                  universe.flush_undos();\n                  universe.push_undo();\n                  this.pause();\n                };\n              })\n              .catch(error => console.error(\"Error:\", error));\n          });\n      })\n      .catch(error => {\n        console.error(\"Error:\", error);\n      });\n  }\n\n  render() {\n    let { size, paused, selectedElement, currentSubmission } = this.state;\n    let hash =\n      currentSubmission && currentSubmission.id\n        ? `#${currentSubmission.id}`\n        : \"\";\n    return (\n      <React.Fragment>\n        <button\n          onClick={() => this.togglePause()}\n          className={paused ? \"selected\" : \"\"}\n        >\n          {paused ? (\n            <svg height=\"20\" width=\"20\" id=\"d\" viewBox=\"0 0 300 300\">\n              <polygon id=\"play\" points=\"0,0 , 300,150 0,300\" />\n            </svg>\n          ) : (\n            <svg height=\"20\" width=\"20\" id=\"d\" viewBox=\"0 0 300 300\">\n              <polygon id=\"bar2\" points=\"0,0 110,0 110,300 0,300\" />\n              <polygon id=\"bar1\" points=\"190,0 300,0 300,300 190,300\" />\n            </svg>\n          )}\n        </button>\n        {/* <button onClick={() => this.upload()}>Upload</button> */}\n\n        <button onClick={() => this.reset()}>Reset</button>\n        <Link\n          to={{\n            pathname: \"/info/\",\n            hash\n          }}\n        >\n          <button>Info</button>\n        </Link>\n\n        {/* {paused && <button onClick={() => universe.tick()}>Tick</button>} */}\n        <span className=\"sizes\">\n          {sizeMap.map((v, i) => (\n            <button\n              key={i}\n              className={i == size ? \"selected\" : \"\"}\n              onClick={e => this.setSize(e, i)}\n              style={{ padding: \"0px\" }}\n            >\n              <svg height=\"23\" width=\"23\" id=\"d\" viewBox=\"0 0 100 100\">\n                <circle cx=\"50\" cy=\"50\" r={2 + v * 3} />\n              </svg>\n            </button>\n          ))}\n        </span>\n        <button\n          onClick={() => {\n            reset();\n            universe.pop_undo();\n          }}\n          style={{ fontSize: 35 }}\n        >\n          ↜\n        </button>\n        {Object.keys(Species)\n          .filter(name => ![\"Plant\", \"FishTail\"].includes(name))\n          .map(n =>\n            ElementButton(n, selectedElement, id =>\n              this.setState({ selectedElement: id })\n            )\n          )}\n\n        {this.state.currentSubmission && (\n          <div className=\"submission-title\">\n            <button onClick={() => this.incScore()}>\n              +♡{this.state.currentSubmission.data.score}{\" \"}\n            </button>\n            {this.state.currentSubmission.data.title}\n          </div>\n        )}\n\n        {this.state.submissionMenuOpen && (\n          <Menu close={() => this.closeMenu()}>\n            <h4>Share your creation with the people!</h4>\n            <img src={this.state.data.dataURL} className=\"submissionImg\" />\n            <div style={{ display: \"flex\" }}>\n              <input\n                placeholder=\"title\"\n                onChange={e => this.setState({ title: e.target.value })}\n              />\n              <button\n                disabled={this.state.submitting}\n                onClick={() => this.submit()}\n              >\n                Submit\n              </button>\n            </div>\n          </Menu>\n        )}\n      </React.Fragment>\n    );\n  }\n}\n\nexport { sizeMap, Index };\n","import { height, universe, width, ratio } from \"./index.js\";\nimport { sizeMap } from \"./components/ui\";\nconst canvas = document.getElementById(\"sand-canvas\");\n\nconst eventDistance = (a, b) => {\n  return Math.sqrt(\n    Math.pow(a.clientX - b.clientX, 2) + Math.pow(a.clientY - b.clientY, 2),\n    2\n  );\n};\n\nconst magnitude = a => {\n  return Math.sqrt(Math.pow(a.clientX, 2) + Math.pow(a.clientY, 2), 2);\n};\n\nconst norm = a => {\n  let mag = magnitude(a);\n  return { clientX: a.clientX / mag, clientY: a.clientY / mag };\n};\nconst scale = (a, s) => {\n  return { clientX: a.clientX * s, clientY: a.clientY * s };\n};\nconst add = (a, b) => {\n  return { clientX: a.clientX + b.clientX, clientY: a.clientY + b.clientY };\n};\nconst sub = (a, b) => {\n  return { clientX: a.clientX - b.clientX, clientY: a.clientY - b.clientY };\n};\n\nlet painting = false;\nlet lastPaint = null;\nlet repeat = null;\n\ncanvas.addEventListener(\"mousedown\", event => {\n  event.preventDefault();\n  universe.push_undo();\n  painting = true;\n  clearInterval(repeat);\n  repeat = window.setInterval(() => paint(event), 100);\n  paint(event);\n  lastPaint = event;\n});\n\ndocument.body.addEventListener(\"mouseup\", event => {\n  clearInterval(repeat);\n  if (painting) {\n    event.preventDefault();\n    lastPaint = null;\n    painting = false;\n  }\n});\n\ncanvas.addEventListener(\"mousemove\", event => {\n  clearInterval(repeat);\n  smoothPaint(event);\n});\n\ncanvas.addEventListener(\"mouseleave\", event => {\n  clearInterval(repeat);\n  lastPaint = null;\n});\n\ncanvas.addEventListener(\"touchstart\", event => {\n  universe.push_undo();\n  if (event.cancelable) {\n    event.preventDefault();\n  }\n  painting = true;\n  lastPaint = event;\n  handleTouches(event);\n});\n\ncanvas.addEventListener(\"touchend\", event => {\n  if (event.cancelable) {\n    event.preventDefault();\n  }\n  lastPaint = null;\n  painting = false;\n  clearInterval(repeat);\n});\n\ncanvas.addEventListener(\"touchmove\", event => {\n  if (!window.paused) {\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n  }\n  clearInterval(repeat);\n  handleTouches(event);\n});\n\nfunction smoothPaint(event) {\n  clearInterval(repeat);\n  repeat = window.setInterval(() => paint(event), 100);\n  let startEvent = { clientX: event.clientX, clientY: event.clientY };\n  if (!painting) {\n    return;\n  }\n  let size = sizeMap[window.UI.state.size];\n  let i = 0;\n  paint(startEvent);\n  if (lastPaint) {\n    while (eventDistance(startEvent, lastPaint) > size / 3) {\n      let d = eventDistance(startEvent, lastPaint);\n      startEvent = add(\n        startEvent,\n        scale(norm(sub(lastPaint, event)), Math.min(size / 3, d))\n      );\n      i++;\n      if (i > 1000) {\n        break;\n      }\n      paint(startEvent);\n    }\n  }\n  lastPaint = event;\n}\n\nconst handleTouches = event => {\n  let touches = Array.from(event.touches);\n  if (touches.length == 1) {\n    smoothPaint(touches[0]);\n  } else {\n    touches.forEach(paint);\n  }\n};\n\nconst paint = event => {\n  if (!painting) {\n    return;\n  }\n  const boundingRect = canvas.getBoundingClientRect();\n\n  const scaleX =\n    canvas.width /\n    (ratio * Math.ceil(window.devicePixelRatio)) /\n    boundingRect.width;\n  const scaleY =\n    canvas.height /\n    (ratio * Math.ceil(window.devicePixelRatio)) /\n    boundingRect.height;\n\n  const canvasLeft = (event.clientX - boundingRect.left) * scaleX;\n  const canvasTop = (event.clientY - boundingRect.top) * scaleY;\n\n  const x = Math.min(Math.floor(canvasLeft), width - 1);\n  const y = Math.min(Math.floor(canvasTop), height - 1);\n  if (window.UI.state.selectedElement < 0) return;\n  universe.paint(\n    x,\n    y,\n    sizeMap[window.UI.state.size],\n    window.UI.state.selectedElement\n  );\n};\n","import React from \"react\";\n\nconst Info = () => {\n  return (\n    <div className=\"Info\">\n      <h1>A sealed ecosystem simulation </h1>\n      <p>\n        Created by <a href=\"https://maxbittker.com\">max bittker</a>\n      </p>\n      forked from sandspiel\n    </div>\n  );\n};\n\nexport default Info;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { BrowserRouter as Router, Route, Link } from \"react-router-dom\";\n\nimport Info from \"./components/info\";\nimport { Index } from \"./components/ui\";\nimport Menu from \"./components/menu\";\n\nfunction BrowseRouter({ match, location }) {\n  return (\n    <Menu>\n      <Browse location={location} />\n    </Menu>\n  );\n}\n\nfunction AdminRouter({ match, location }) {\n  return (\n    <Menu>\n      <Admin location={location} />\n    </Menu>\n  );\n}\n\nfunction SigninRouter({ match, location }) {\n  return (\n    <Menu>\n      <SignInScreen location={location} />\n    </Menu>\n  );\n}\n\nfunction AppRouter() {\n  return (\n    <Router>\n      <Route path=\"/\" component={Index} />\n      <Route\n        exact\n        path=\"/info/\"\n        component={() => (\n          <Menu>\n            <Info />\n          </Menu>\n        )}\n      />\n      <Route path=\"/browse\" component={BrowseRouter} />\n      <Route path=\"/admin\" component={AdminRouter} />\n      <Route path=\"/login\" component={SigninRouter} />\n      <Route path=\"/__/auth/handler\" component={SigninRouter} />\n    </Router>\n  );\n}\n\nReactDOM.render(<AppRouter />, document.getElementById(\"ui\"));\n","let fsh = require(\"./glsl/sky.glsl\");\n\n/*forked from https://github.com/bysse/shadertoy-webgl-harness*/\nclass WebGL {\n  constructor(canvasId) {\n    this.canvas = document.getElementById(canvasId);\n    this.gl = this.canvas.getContext(\"webgl\");\n    this.gl.getExtension(\"EXT_shader_texture_lod\");\n\n    this.textures = {};\n\n    let vertexShader =\n      \"attribute vec4 aPosition; void main() { gl_Position = aPosition; } \";\n    let fragmentShader = fsh;\n\n    this.shader = WebGL.linkShader(this.gl, vertexShader, fragmentShader);\n    this.shader.vertexAttribute = this.gl.getAttribLocation(\n      this.shader,\n      \"aPosition\"\n    );\n    this.gl.enableVertexAttribArray(this.shader.vertexAttribute);\n\n    let res = 8;\n    this.height = window.innerHeight / res;\n    this.width = window.innerWidth / res;\n    this.canvas.setAttribute(\"width\", this.width);\n    this.canvas.setAttribute(\"height\", this.height);\n\n    this.vertexBuffer = WebGL.createVBO(this.gl, 3, [\n      1.0,\n      1.0,\n      0.0,\n      -1.0,\n      1.0,\n      0.0,\n      1.0,\n      -1.0,\n      0.0,\n      -1.0,\n      -1.0,\n      0.0\n    ]);\n    this.running = false;\n    this.time0 = 0.0;\n  }\n\n  loadTexture(channelNumber, source) {\n    var texture = this.gl.createTexture();\n    var gl = this.gl;\n    texture.image = new Image();\n    texture.image.onload = () => {\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\n\n      try {\n        gl.texImage2D(\n          gl.TEXTURE_2D,\n          0,\n          gl.RGBA,\n          gl.RGBA,\n          gl.UNSIGNED_BYTE,\n          texture.image\n        );\n      } catch (err) {\n        console.log(`ERROR: Failed to load texture ${source} : ${err}`);\n\n        console.log(`INFO: Generating placeholder texture for ${source}`);\n        var w = 64,\n          bw = 4,\n          data = [];\n        for (var y = 0; y < w; y++) {\n          for (var x = 0; x < w; x++) {\n            var ix = parseInt(x / bw),\n              iy = parseInt(y / bw);\n            var c = 0xff * ((ix + iy) % 2);\n            data = data.concat([c, c, c, 0xff]);\n          }\n        }\n        gl.texImage2D(\n          gl.TEXTURE_2D,\n          0,\n          gl.RGBA,\n          w,\n          w,\n          0,\n          gl.RGBA,\n          gl.UNSIGNED_BYTE,\n          new Uint8Array(data)\n        );\n      }\n\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n      gl.bindTexture(gl.TEXTURE_2D, null);\n\n      this.textures[channelNumber] = texture;\n    };\n    texture.image.src = source;\n  }\n\n  start() {\n    if (this.running) {\n      return;\n    }\n\n    this._start();\n  }\n\n  _start() {\n    this.running = true;\n    this.time0 = WebGL.getTime();\n    this.timePreviousFrame = this.time0;\n\n    this.gl.disable(this.gl.DEPTH_TEST);\n    this.gl.viewport(0, 0, this.width, this.height);\n    this.gl.useProgram(this.shader);\n  }\n\n  stop() {\n    this.running = false;\n  }\n\n  frame(gameTime) {\n    let gl = this.gl;\n    if (!this.running) {\n      return;\n    }\n\n    let shader = this.shader;\n    let time = WebGL.getTime() - this.time0;\n    let dt = time - this.timePreviousFrame;\n    this.timePreviousFrame = time;\n\n    gl.clear(gl.DEPTH_BUFFER_BIT);\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);\n    gl.vertexAttribPointer(\n      shader.vertexAttribute,\n      this.vertexBuffer.itemSize,\n      gl.FLOAT,\n      false,\n      0,\n      0\n    );\n\n    // set texture\n    for (var channel in this.textures) {\n      var texture = this.textures[channel];\n      gl.activeTexture(gl.TEXTURE0 + parseInt(channel));\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.uniform1i(\n        gl.getUniformLocation(shader, \"iChannel\" + channel),\n        channel\n      );\n    }\n\n    // update uniforms\n    gl.uniform3f(\n      gl.getUniformLocation(shader, \"iResolution\"),\n      this.width,\n      this.height,\n      0\n    );\n    gl.uniform1f(gl.getUniformLocation(shader, \"iGlobalTime\"), time); // legacy support\n    gl.uniform1f(gl.getUniformLocation(shader, \"iTime\"), time);\n    gl.uniform1f(gl.getUniformLocation(shader, \"gameTime\"), gameTime);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, this.vertexBuffer.numItems);\n  }\n\n  static createVBO(gl, stride, vertexData) {\n    var vertexBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n    gl.bufferData(\n      gl.ARRAY_BUFFER,\n      new Float32Array(vertexData),\n      gl.STATIC_DRAW\n    );\n    vertexBuffer.itemSize = stride;\n    vertexBuffer.numItems = vertexData.length / stride;\n    return vertexBuffer;\n  }\n\n  static linkShader(gl, vertexSource, fragmentSource) {\n    var program = gl.createProgram();\n    gl.attachShader(\n      program,\n      WebGL.compileShader(gl, gl.VERTEX_SHADER, vertexSource)\n    );\n    gl.attachShader(\n      program,\n      WebGL.compileShader(gl, gl.FRAGMENT_SHADER, fragmentSource)\n    );\n    gl.linkProgram(program);\n\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      WebGL.showLog(gl, program);\n      throw `Failed to link shader!`;\n    }\n\n    program.uniformLocation = (gl, name) =>\n      gl.getUniformLocation(program, name);\n\n    return program;\n  }\n\n  static compileShader(gl, shaderType, source) {\n    var shader = gl.createShader(shaderType);\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      let type =\n        shaderType == gl.VERTEX_SHADER ? \"vertex shader\" : \"fragment shader\";\n      WebGL.showLog(gl, shader);\n      throw `Failed to compile ${type}`;\n    }\n    return shader;\n  }\n\n  static getTime() {\n    return 0.001 * new Date().getTime();\n  }\n}\n\nvar webGL = new WebGL(\"sky-canvas\");\nwebGL.loadTexture(0, \"assets/noise.png\");\nwebGL.start();\n\nexport { webGL };\n","import { Universe, Species } from \"../crate/pkg\";\n\nimport { startWebGL } from \"./render\";\nimport { fps } from \"./fps\";\nimport {} from \"./paint\";\nimport {} from \"./app\";\nimport {} from \"./setup\";\nimport { webGL } from \"./shaderToy\";\n\nlet n = 200;\nlet h = n / 2;\nlet d = n - 6;\n\nconst universe = Universe.new(n, n);\nuniverse.paint(h, h, d + 2, Species.Glass);\n\nuniverse.paint(h - 10, d + 2, 10, Species.Wood);\nuniverse.paint(h + 10, d + 2, 10, Species.Wood);\nuniverse.paint(h, h, d - 2, Species.Air);\nfor (var x = 30; x < d - 30; x += 10) {\n  universe.paint(x, h * 1.2, h, Species.Water);\n}\n\nfor (var x = 0; x < d; x += 10) {\n  universe.paint(x, d * 0.75, 20, Species.Sand);\n}\nuniverse.paint(h, h, h * 1.1, Species.Water);\n\nuniverse.paint(h, h, 2, Species.Zoop);\nuniverse.paint(h + 20, h, 2, Species.Fish);\nuniverse.paint(h, h * 1.2, 2, Species.Bacteria);\nuniverse.paint(h * 1.5, h * 1.2, 2, Species.Seed);\n\nuniverse.paint(h, h, 10, Species.Algae);\n\n// universe.paint(150, 50, 25, Species.Seed);\nlet ratio = 2;\nlet width = n;\nlet height = n;\nconst canvas = document.getElementById(\"sand-canvas\");\n\ncanvas.height = n * ratio * Math.ceil(window.devicePixelRatio);\ncanvas.width = n * ratio * Math.ceil(window.devicePixelRatio);\n\ndocument.getElementById(\"background\").addEventListener(\"touchmove\", e => {\n  if (!window.paused) {\n    if (e.cancelable) {\n      e.preventDefault();\n    }\n  }\n});\n\nconst ui = document.getElementById(\"ui\");\n\nlet resize = () => {\n  let screen_width = window.innerWidth;\n  let uiheight = 50;\n  let screen_height = window.innerHeight - uiheight;\n\n  let canvasStyle = \"\";\n  let uiStyle = \"\";\n  if (screen_width > screen_height) {\n    if (screen_width - window.innerHeight < 400) {\n      // landscape compressed\n      canvasStyle = `height: ${window.innerHeight}px; margin:3px`;\n      uiStyle = `width: ${screen_width -\n        window.innerHeight -\n        12}px; margin: 2px;`;\n    } else {\n      // landscape wide\n      canvasStyle = `height: ${window.innerHeight}px`;\n      uiStyle = `width: ${(screen_width - window.innerHeight) / 2 -\n        7}px; margin: 2px;`;\n    }\n  } else {\n    //portrait (mobile)\n    canvasStyle = `width: ${screen_width}px; `;\n    uiStyle = \"\";\n  }\n  ui.style = uiStyle;\n  canvas.style = canvasStyle;\n};\n\nresize();\nwindow.addEventListener(\"deviceorientation\", resize, true);\nwindow.addEventListener(\"resize\", resize);\n\nlet drawSand = startWebGL({ canvas, universe });\nlet t = 0;\nconst renderLoop = () => {\n  if (!window.paused) {\n    fps.render(); // new\n    universe.tick();\n  }\n  t += 1;\n  // if (t > 10) {\n  // t = 0;\n  universe.set_time(t % 255);\n  // }\n  drawSand();\n  webGL.frame(t / 255);\n  window.animWebationId = requestAnimationFrame(renderLoop);\n};\n255;\nfunction reset() {\n  universe.reset();\n}\nwindow.u = universe;\nwindow.universe = universe;\nrenderLoop();\n\nexport { canvas, width, height, ratio, universe, reset };\n","module.exports = \"precision highp float;\\n#define GLSLIFY 1\\nuniform float t;\\nuniform float dpi;\\nuniform vec2 resolution;\\nuniform bool isSnapshot;\\nuniform sampler2D backBuffer;\\nuniform sampler2D data;\\nuniform sampler2D light;\\n\\nvarying vec2 uv;\\n\\n// clang-format off\\nvec3 hsv2rgb_4_0(vec3 c) {\\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\\n}\\n\\n\\n\\n//\\n// Description : Array and textureless GLSL 2D/3D/4D simplex\\n//               noise functions.\\n//      Author : Ian McEwan, Ashima Arts.\\n//  Maintainer : ijm\\n//     Lastmod : 20110822 (ijm)\\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\\n//               Distributed under the MIT License. See LICENSE file.\\n//               https://github.com/ashima/webgl-noise\\n//\\n\\nvec3 mod289_2_1(vec3 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec4 mod289_2_1(vec4 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec4 permute_2_2(vec4 x) {\\n     return mod289_2_1(((x*34.0)+1.0)*x);\\n}\\n\\nvec4 taylorInvSqrt_2_3(vec4 r)\\n{\\n  return 1.79284291400159 - 0.85373472095314 * r;\\n}\\n\\nfloat snoise_2_4(vec3 v)\\n  {\\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\\n  const vec4  D_2_5 = vec4(0.0, 0.5, 1.0, 2.0);\\n\\n// First corner\\n  vec3 i  = floor(v + dot(v, C.yyy) );\\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\\n\\n// Other corners\\n  vec3 g_2_6 = step(x0.yzx, x0.xyz);\\n  vec3 l = 1.0 - g_2_6;\\n  vec3 i1 = min( g_2_6.xyz, l.zxy );\\n  vec3 i2 = max( g_2_6.xyz, l.zxy );\\n\\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\\n  vec3 x1 = x0 - i1 + C.xxx;\\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\\n  vec3 x3 = x0 - D_2_5.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\\n\\n// Permutations\\n  i = mod289_2_1(i);\\n  vec4 p = permute_2_2( permute_2_2( permute_2_2(\\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\\n\\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\\n  float n_ = 0.142857142857; // 1.0/7.0\\n  vec3  ns = n_ * D_2_5.wyz - D_2_5.xzx;\\n\\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\\n\\n  vec4 x_ = floor(j * ns.z);\\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\\n\\n  vec4 x = x_ *ns.x + ns.yyyy;\\n  vec4 y = y_ *ns.x + ns.yyyy;\\n  vec4 h = 1.0 - abs(x) - abs(y);\\n\\n  vec4 b0 = vec4( x.xy, y.xy );\\n  vec4 b1 = vec4( x.zw, y.zw );\\n\\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\\n  vec4 s0 = floor(b0)*2.0 + 1.0;\\n  vec4 s1 = floor(b1)*2.0 + 1.0;\\n  vec4 sh = -step(h, vec4(0.0));\\n\\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\\n  vec4 a1_2_7 = b1.xzyw + s1.xzyw*sh.zzww ;\\n\\n  vec3 p0_2_8 = vec3(a0.xy,h.x);\\n  vec3 p1 = vec3(a0.zw,h.y);\\n  vec3 p2 = vec3(a1_2_7.xy,h.z);\\n  vec3 p3 = vec3(a1_2_7.zw,h.w);\\n\\n//Normalise gradients\\n  vec4 norm = taylorInvSqrt_2_3(vec4(dot(p0_2_8,p0_2_8), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\\n  p0_2_8 *= norm.x;\\n  p1 *= norm.y;\\n  p2 *= norm.z;\\n  p3 *= norm.w;\\n\\n// Mix final noise value\\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\\n  m = m * m;\\n  return 42.0 * dot( m*m, vec4( dot(p0_2_8,x0), dot(p1,x1),\\n                                dot(p2,x2), dot(p3,x3) ) );\\n  }\\n\\n\\n\\n//\\n// Description : Array and textureless GLSL 2D simplex noise function.\\n//      Author : Ian McEwan, Ashima Arts.\\n//  Maintainer : ijm\\n//     Lastmod : 20110822 (ijm)\\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\\n//               Distributed under the MIT License. See LICENSE file.\\n//               https://github.com/ashima/webgl-noise\\n//\\n\\nvec3 mod289_1_9(vec3 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec2 mod289_1_9(vec2 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec3 permute_1_10(vec3 x) {\\n  return mod289_1_9(((x*34.0)+1.0)*x);\\n}\\n\\nfloat snoise_1_11(vec2 v)\\n  {\\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\\n                      0.024390243902439); // 1.0 / 41.0\\n// First corner\\n  vec2 i  = floor(v + dot(v, C.yy) );\\n  vec2 x0 = v -   i + dot(i, C.xx);\\n\\n// Other corners\\n  vec2 i1;\\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\\n  //i1.y = 1.0 - i1.x;\\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\\n  // x1 = x0 - i1 + 1.0 * C.xx ;\\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\\n  vec4 x12 = x0.xyxy + C.xxzz;\\n  x12.xy -= i1;\\n\\n// Permutations\\n  i = mod289_1_9(i); // Avoid truncation effects in permutation\\n  vec3 p = permute_1_10( permute_1_10( i.y + vec3(0.0, i1.y, 1.0 ))\\n    + i.x + vec3(0.0, i1.x, 1.0 ));\\n\\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\\n  m = m*m ;\\n  m = m*m ;\\n\\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\\n\\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\\n  vec3 h = abs(x) - 0.5;\\n  vec3 ox = floor(x + 0.5);\\n  vec3 a0 = x - ox;\\n\\n// Normalise gradients implicitly by scaling m\\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\\n\\n// Compute final noise value at P\\n  vec3 g;\\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\\n  return 130.0 * dot(m, g);\\n}\\n\\n\\n\\nhighp float random_3_12(vec2 co)\\n{\\n    highp float a = 12.9898;\\n    highp float b = 78.233;\\n    highp float c = 43758.5453;\\n    highp float dt= dot(co.xy ,vec2(a,b));\\n    highp float sn= mod(dt,3.14);\\n    return fract(sin(sn) * c);\\n}\\n\\n\\n\\n// clang-format on\\n\\nvoid main() {\\n  vec3 color;\\n  vec2 grid = floor(uv * resolution / dpi);\\n  //   float r = abs(sin(t / 25.));\\n  //   if (length(uv) < r && length(uv) > r - 0.1) {\\n  // color = hsv2rgb(vec3(sin(t * 0.01), 0.5, 0.5));\\n  float noise = snoise_2_4(vec3(grid, t * 0.05));\\n\\n  vec2 textCoord = (uv * vec2(0.5, -0.5)) + vec2(0.5);\\n  vec2 sampleCoord =\\n      (uv * vec2(0.5, -0.5)) + vec2(0.5) + vec2(noise, 0.0) / resolution;\\n  // vec3 bb = texture2D(backBuffer, (uv * 0.5) + vec2(0.5)).rgb;\\n\\n  vec4 data = texture2D(data, textCoord);\\n  float lightValue = texture2D(light, textCoord).r;\\n  float sampleLightValue = texture2D(light, sampleCoord).r;\\n  lightValue = 0.5 * lightValue + 0.5 * sampleLightValue;\\n  int type = int((data.r * 255.) + 0.1);\\n  float energy = data.g;\\n  float age = data.b;\\n\\n  float hue = 0.0;\\n  float saturation = 0.6;\\n  float lightness = 0.3 + energy * 0.5;\\n  float a = 1.0;\\n  float brightness = 0.0;\\n\\n  if (type == 0) { // Air\\n\\n    hue = 0.0;\\n    saturation = 0.1;\\n    lightness = 0.1;\\n    a = 0.0;\\n    if (isSnapshot) {\\n      saturation = 0.05;\\n      lightness = 1.01;\\n      a = 1.0;\\n    }\\n\\n  } else if (type == 1) { // Glass\\n    hue = 0.1;\\n    saturation = 0.1;\\n    lightness = 0.5;\\n  } else if (type == 2) { // Sand\\n    hue = 0.1;\\n    saturation = 0.2 + energy;\\n    lightness = 1.5 - energy;\\n\\n  } else if (type == 3) { // Water\\n    hue = 0.58;\\n    saturation = 0.6;\\n    lightness = 0.5 + energy * 0.25 + noise * 0.1;\\n    a = 0.4;\\n    if (isSnapshot) {\\n      a = 1.0;\\n    }\\n  } else if (type == 4) { // Algae\\n    hue = 0.4 - age * 0.5;\\n    lightness += 0.0;\\n    saturation = 0.4 + (age * .2);\\n  } else if (type == 5) { // Plant\\n    hue = 0.4;\\n    lightness -= 0.1;\\n    saturation = 0.4;\\n  } else if (type == 6) { // Zoop\\n    hue = 0.9;\\n    lightness += 0.7;\\n  } else if (type == 7) { // Fish\\n    hue = 0.0;\\n    lightness += 0.4;\\n  } else if (type == 8) { // Bacteria\\n    hue = 0.9;\\n    saturation -= 0.2;\\n    lightness -= 0.1;\\n  } else if (type == 9) { // ???\\n    hue = 0.6;\\n    saturation = 0.4;\\n    lightness = 0.7 + data.g * 0.5;\\n  } else if (type == 10) { // Waste\\n    hue = 0.9;\\n    lightness -= 0.3;\\n    saturation = 0.4;\\n  } else if (type == 11) { // Seed\\n    hue = 0.4;\\n    saturation = 0.4;\\n  } else if (type == 12) { // Stone\\n    hue = -0.4 + (data.g * 0.5);\\n    saturation = 0.1;\\n  } else if (type == 13) { // Wood\\n    hue = (data.g * 0.1);\\n    saturation = 0.3;\\n    lightness = 0.3 + data.g * 0.3;\\n  } else if (type == 14) { // Egg\\n    hue = 0.9;\\n    saturation = age;\\n    lightness = 1.0;\\n  } else if (type == 15) { // Tail\\n    hue += fract(age * 255.*1.2)*0.2;\\n    lightness += 0.4;\\n    // saturation += fract(age * 255.*6.);\\n  }\\n  //  else if (type == 15) { // mite\\n\\n  // } else if (type == 16) { // oil\\n  //   hue = (data.g * 5.0) + t * .008;\\n\\n  //   saturation = 0.2;\\n  //   lightness = 0.3;\\n  // } else if (type == 17) { // Rocket\\n  //   hue = 0.0;\\n  //   saturation = 0.4 + data.b;\\n  //   lightness = 0.9;\\n  // } else if (type == 18) { // fungus\\n  //   hue = (data.g * 0.15) - 0.1;\\n  //   saturation = (data.g * 0.8) - 0.05;\\n\\n  //   // (data.g * 0.00);\\n  //   lightness = 1.5 - (data.g * 0.2);\\n  // } else if (type == 19) { // seed/flower\\n\\n  //   hue = fract(fract(data.b * 2.) * 0.5) - 0.3;\\n  //   saturation = 0.7 * (data.g + 0.4) + data.b * 0.2;\\n  //   lightness = 0.9 * (data.g + 0.9);\\n  // }\\n  if (isSnapshot == false) {\\n    lightness *= (0.975 + snoise_1_11(floor(uv * resolution / dpi)) * 0.025);\\n  }\\n  lightness += lightValue / 2.;\\n  saturation = min(saturation, 1.0);\\n  lightness = min(lightness, 1.0);\\n  color = hsv2rgb_4_0(vec3(hue, saturation, lightness));\\n  gl_FragColor = vec4(color, a);\\n}\"","module.exports = \"\\n// boring \\\"pass-through\\\" vertex shader\\nprecision mediump float;\\n#define GLSLIFY 1\\nattribute vec2 position;\\nvarying vec2 uv;\\nvoid main() {\\n  uv = position;\\n  gl_Position = vec4(position, 0, 1);\\n}\"","import * as wasm from './sandtable_bg.wasm';\n\nfunction notDefined(what) { return () => { throw new Error(`${what} is not defined`); }; }\n\nlet cachedTextDecoder = new TextDecoder('utf-8');\n\nlet cachegetUint8Memory = null;\nfunction getUint8Memory() {\n    if (cachegetUint8Memory === null || cachegetUint8Memory.buffer !== wasm.memory.buffer) {\n        cachegetUint8Memory = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachegetUint8Memory;\n}\n\nfunction getStringFromWasm(ptr, len) {\n    return cachedTextDecoder.decode(getUint8Memory().subarray(ptr, ptr + len));\n}\n/**\n*/\nexport const Species = Object.freeze({ Air:0,Glass:1,Sand:2,Water:3,Algae:4,Plant:5,Zoop:6,Egg:14,Fish:7,FishTail:15,Bacteria:8,Nitrogen:9,Waste:10,Seed:11,Stone:12,Wood:13, });\n/**\n*/\nexport class Cell {\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_cell_free(ptr);\n    }\n}\n/**\n*/\nexport class Light {\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_light_free(ptr);\n    }\n}\n/**\n*/\nexport class Universe {\n\n    static __wrap(ptr) {\n        const obj = Object.create(Universe.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_universe_free(ptr);\n    }\n    /**\n    */\n    reset() {\n        wasm.universe_reset(this.ptr);\n    }\n    /**\n    */\n    calculate_light() {\n        wasm.universe_calculate_light(this.ptr);\n    }\n    /**\n    * @param {number} brightness\n    * @param {number} x\n    * @param {number} y\n    * @param {number} dx\n    * @param {number} dy\n    */\n    cast_ray(brightness, x, y, dx, dy) {\n        wasm.universe_cast_ray(this.ptr, brightness, x, y, dx, dy);\n    }\n    /**\n    */\n    tick() {\n        wasm.universe_tick(this.ptr);\n    }\n    /**\n    * @returns {number}\n    */\n    width() {\n        const ret = wasm.universe_width(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    height() {\n        const ret = wasm.universe_height(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    O2() {\n        const ret = wasm.universe_O2(this.ptr);\n        return ret >>> 0;\n    }\n    /**\n    * @returns {number}\n    */\n    CO2() {\n        const ret = wasm.universe_CO2(this.ptr);\n        return ret >>> 0;\n    }\n    /**\n    * @returns {number}\n    */\n    cells() {\n        const ret = wasm.universe_cells(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    lights() {\n        const ret = wasm.universe_lights(this.ptr);\n        return ret;\n    }\n    /**\n    * @param {number} x\n    * @param {number} y\n    * @param {number} size\n    * @param {number} species\n    */\n    paint(x, y, size, species) {\n        wasm.universe_paint(this.ptr, x, y, size, species);\n    }\n    /**\n    */\n    push_undo() {\n        wasm.universe_push_undo(this.ptr);\n    }\n    /**\n    */\n    pop_undo() {\n        wasm.universe_pop_undo(this.ptr);\n    }\n    /**\n    */\n    flush_undos() {\n        wasm.universe_flush_undos(this.ptr);\n    }\n    /**\n    * @param {number} t\n    */\n    set_time(t) {\n        wasm.universe_set_time(this.ptr, t);\n    }\n    /**\n    */\n    inc_time() {\n        wasm.universe_inc_time(this.ptr);\n    }\n    /**\n    * @param {number} width\n    * @param {number} height\n    * @returns {Universe}\n    */\n    static new(width, height) {\n        const ret = wasm.universe_new(width, height);\n        return Universe.__wrap(ret);\n    }\n}\n\nexport const __wbg_random_09364f2d8647f133 = typeof Math.random == 'function' ? Math.random : notDefined('Math.random');\n\nexport const __wbindgen_throw = function(arg0, arg1) {\n    throw new Error(getStringFromWasm(arg0, arg1));\n};\n\n","if (window.safari) {\n  history.pushState(null, null, location.href);\n  window.onpopstate = function(event) {\n    history.go(1);\n  };\n}\n\nfunction mobileAndTabletcheck() {\n  var check = false;\n  (function(a) {\n    if (\n      /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(\n        a\n      ) ||\n      /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(\n        a.substr(0, 4)\n      )\n    )\n      check = true;\n  })(navigator.userAgent || navigator.vendor || window.opera);\n  return check;\n}\n\nif (mobileAndTabletcheck()) {\n  window.onbeforeunload = function() {\n    return true;\n  };\n}\n\n// if (\"serviceWorker\" in navigator) {\n//   window.addEventListener(\"load\", () => {\n//     navigator.serviceWorker\n//       .register(\"/service-worker.js\")\n//       .then(registration => {\n//         console.log(\"SW registered: \", registration);\n//       })\n//       .catch(registrationError => {\n//         console.log(\"SW registration failed: \", registrationError);\n//       });\n//   });\n// }\n","module.exports = \"#extension GL_EXT_shader_texture_lod : enable\\n        precision mediump float;\\n#define GLSLIFY 1\\n uniform vec3 iResolution;\\n         uniform float iGlobalTime, iTime, gameTime;\\n         uniform vec4      iMouse;\\n         uniform sampler2D iChannel0;\\n         uniform sampler2D iChannel1;\\n         uniform sampler2D iChannel2;\\n         uniform sampler2D iChannel3;\\n         // The sun, the sky and the clouds. By StillTravelling\\n// https://www.shadertoy.com/view/tdSXzD\\n// Very much a messy hack sorry!!\\n\\n// Many Thank yous go to the below for their amazing work\\n// Day and night sky cycle. By László Matuska (@BitOfGold)\\n// Creates a sky texture for a skydome\\n// https://www.shadertoy.com/view/ltlSWB\\n\\n// Weather. By David Hoskins, May 2014.\\n// https://www.shadertoy.com/view/4dsXWn\\n\\n// Edge of atmosphere\\n// created by dmytro rubalskyi (ruba)\\n// https://www.shadertoy.com/view/XlXGzB\\n\\n// Auroras\\n// created by nimitz\\n// https://www.shadertoy.com/view/XtGGRt\\n\\n// Sorry to those I've missed out!!\\n\\n\\n#define ORIG_CLOUD 0\\n#define ENABLE_RAIN 0 //enable rain drops on screen\\n#define SIMPLE_SUN 0\\n#define NICE_HACK_SUN 1\\n#define SOFT_SUN 1\\n#define cloudy  0.5 //0.0 clear sky\\n#define haze  0.01 * (cloudy*20.)\\n#define rainmulti 5.0 // makes clouds thicker\\n#define rainy (10.0 -rainmulti)\\n#define t iTime\\n#define fov tan(radians(60.0))\\n#define S(x, y, z) smoothstep(x, y, z)\\n#define cameraheight 5e1 //50.\\n#define mincloudheight 5e3 //5e3\\n#define maxcloudheight 8e3 //8e3\\n#define xaxiscloud t*5e2 //t*5e2 +t left -t right *speed\\n#define yaxiscloud 0. //0.\\n#define zaxiscloud t*6e2 //t*6e2 +t away from horizon -t towards horizon *speed\\n#define cloudnoise 2e-4 //2e-4\\n\\n//#define cloud2\\n\\n\\n//Performance\\nconst int steps = 16; //16 is fast, 128 or 256 is extreme high\\nconst int stepss = 16; //16 is fast, 16 or 32 is high \\n\\n//Environment\\nconst float R0 = 6360e3; //planet radius //6360e3 actual 6371km\\nconst float Ra = 6380e3; //atmosphere radius //6380e3 troposphere 8 to 14.5km\\nconst float I = 10.; //sun light power, 10.0 is normal\\nconst float SI = 5.; //sun intensity for sun\\nconst float g = 0.45; //light concentration .76 //.45 //.6  .45 is normaL\\nconst float g2 = g * g;\\nconst float PI = 3.14159265358979323846;\\nconst float PI2 = 2.*3.14159265358979323846;\\n\\nconst float ts= (cameraheight / 2.5e5);\\n\\nconst float s = 0.999; //light concentration for sun\\n#if SOFT_SUN\\nconst float s2 = s;\\n#else\\nconst float s2 = s * s;\\n#endif\\nconst float Hr = 8e3; //Rayleigh scattering top //8e3\\nconst float Hm = 1.2e3; //Mie scattering top //1.3e3\\n\\nvec3 bM = vec3(21e-6); //normal mie // vec3(21e-6)\\n// vec3 bM = vec3(50e-6); //high mie\\n\\n//Rayleigh scattering (sky color, atmospheric up to 8km)\\nvec3 bR = vec3(5.8e-6, 13.5e-6, 33.1e-6); //normal earth\\n// vec3 bR = vec3(5.8e-6, 33.1e-6, 13.5e-6); //purple\\n//vec3 bR = vec3( 63.5e-6, 13.1e-6, 50.8e-6 ); //green\\n//vec3 bR = vec3( 13.5e-6, 23.1e-6, 115.8e-6 ); //yellow\\n//vec3 bR = vec3( 5.5e-6, 15.1e-6, 355.8e-6 ); //yeellow\\n//vec3 bR = vec3(3.5e-6, 333.1e-6, 235.8e-6 ); //red-purple\\n\\nvec3 C = vec3(0., -R0, 0.); //planet center\\nvec3 Ds = normalize(vec3(0., 0., -1.)); //sun direction?\\n\\nfloat cloudyhigh = 0.05; //if cloud2 defined\\n\\n#if ORIG_CLOUD\\nfloat cloudnear = 1.0; //9e3 12e3  //do not render too close clouds on the zenith\\nfloat cloudfar = 1e3; //15e3 17e3\\n#else\\nfloat cloudnear = 1.0; //15e3 17e3\\nfloat cloudfar = 70e3; //160e3  //do not render too close clouds on the horizon 160km should be max for cumulus\\n#endif\\n\\n\\n\\n\\n//AURORA STUFF\\nmat2 mm2(in float a){\\n    float c = cos(a);\\n    float s = sin(a);\\n    return mat2(c,s,-s,c);\\n}\\n\\nmat2 m2 = mat2(0.95534, 0.29552, -0.29552, 0.95534);\\n\\nfloat tri(in float x){\\n    return clamp(abs(fract(x)-.5),0.01,0.49);\\n}\\n\\nvec2 tri2(in vec2 p){\\n    return vec2(tri(p.x)+tri(p.y),tri(p.y+tri(p.x)));\\n}\\n\\nfloat triNoise2d(in vec2 p, float spd)\\n{\\n    float z=1.8;\\n    float z2=2.5;\\n    float rz = 0.;\\n    p *= mm2(p.x*0.06);\\n    vec2 bp = p;\\n    for (float i=0.; i<5.; i++ )\\n    {\\n        vec2 dg = tri2(bp*1.85)*.75;\\n        dg *= mm2(t*spd);\\n        p -= dg/z2;\\n\\n        bp *= 1.3;\\n        z2 *= 1.45;\\n        z *= .42;\\n        p *= 1.21 + (rz-1.0)*.02;\\n        \\n        rz += tri(p.x+tri(p.y))*z;\\n        p*= -m2;\\n    }\\n    return clamp(1./pow(rz*29., 1.3),0.,.55);\\n}\\n\\n\\nfloat hash21(in vec2 n){ return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453); }\\nvec4 aurora(vec3 ro, vec3 rd)\\n{\\n    vec4 col = vec4(0);\\n    vec4 avgCol = vec4(0);\\n    ro *= 1e-5;\\n    float mt = 10.;\\n    for(float i=0.;i<5.;i++)\\n    {\\n        float of = 0.006*hash21(gl_FragCoord.xy)*smoothstep(0.,15., i*mt);\\n        float pt = ((.8+pow((i*mt),1.2)*.001)-rd.y)/(rd.y*2.+0.4);\\n        pt -= of;\\n        vec3 bpos = (ro) + pt*rd;\\n        vec2 p = bpos.zx;\\n        //vec2 p = rd.zx;\\n        float rzt = triNoise2d(p, 0.1);\\n        vec4 col2 = vec4(0,0,0, rzt);\\n        col2.rgb = (sin(1.-vec3(2.15,-.5, 1.2)+(i*mt)*0.053)*(0.5*mt))*rzt;\\n        avgCol =  mix(avgCol, col2, .5);\\n        col += avgCol*exp2((-i*mt)*0.04 - 2.5)*smoothstep(0.,5., i*mt);\\n\\n    }\\n\\n    col *= (clamp(rd.y*15.+.4,0.,1.2));\\n    return col*2.8;\\n}\\n\\n//END AURORA STUFF\\n\\nfloat noise(in vec2 v) { \\n    return 0.5;\\n    //texture2DLodEXT(iChannel0,(v+.5)/256., 0.).r; \\n}\\n\\n// by iq\\nfloat Noise( in vec3 x )\\n{\\n    vec3 p = floor(x);\\n    vec3 f = fract(x);\\n    f = f*f*(3.0-2.0*f);\\n\\n    vec2 uv = (p.xy+vec2(37.0,17.0)*p.z) + f.xy;\\n    vec2 rg = texture2DLodEXT( iChannel0, (uv+ 0.5)/256.0, -100.0).yx;\\n    return mix( rg.x, rg.y, f.z );\\n}\\n\\n\\nfloat fnoise( vec3 p, in float t )\\n{\\n    p *= .25;\\n    float f;\\n\\n    f = 0.5000 * Noise(p); p = p * 3.02; p.y -= t*.1; //t*.05 speed cloud changes\\n    f += 0.2500 * Noise(p); p = p * 3.03; p.y += t*.06;\\n    f += 0.1250 * Noise(p); p = p * 3.01;\\n    f += 0.0625   * Noise(p); p =  p * 3.03;\\n    f += 0.03125  * Noise(p); p =  p * 3.02;\\n    f += 0.015625 * Noise(p);\\n    return f;\\n}\\n\\nfloat cloud(vec3 p, in float t ) {\\n    float cld = fnoise(p*cloudnoise,t) + cloudy*0.1 ;\\n    cld = smoothstep(.4+.04, .6+.04, cld);\\n    cld *= cld * (5.0*rainmulti);\\n    return cld+haze;\\n}\\n\\nvoid densities(in vec3 pos, out float rayleigh, out float mie) {\\n    float h = length(pos - C) - R0;\\n    rayleigh =  exp(-h/Hr);\\n    vec3 d = pos;\\n    d.y = 0.0;\\n    float dist = length(d);\\n    \\n    float cld = 0.;\\n    if (mincloudheight < h && h < maxcloudheight) {\\n        //cld = cloud(pos+vec3(t*1e3,0., t*1e3),t)*cloudy;\\n        cld = cloud(pos+vec3(xaxiscloud,yaxiscloud, zaxiscloud),t)*cloudy; //direction and speed the cloud movers\\n        cld *= sin(3.1415*(h-mincloudheight)/mincloudheight) * cloudy;\\n    }\\n    #ifdef cloud2\\n        float cld2 = 0.;\\n        if (12e3 < h && h < 15.5e3) {\\n            cld2 = fnoise(pos*3e-4,t)*cloud(pos*32.0+vec3(27612.3, 0.,-t*15e3), t);\\n            cld2 *= sin(3.1413*(h-12e3)/12e3) * cloudyhigh;\\n            cld2 = clamp(cld2,0.0,1.0);\\n        }\\n    \\n    #endif\\n\\n    #if ORIG_CLOUD\\n    if (dist<cloudfar) {\\n        float factor = clamp(1.0-((cloudfar - dist)/(cloudfar-cloudnear)),0.0,1.0);\\n        cld *= factor;\\n    }\\n    #else\\n\\n    if (dist>cloudfar) {\\n\\n        float factor = clamp(1.0-((dist - cloudfar)/(cloudfar-cloudnear)),0.0,1.0);\\n        cld *= factor;\\n    }\\n    #endif\\n\\n    mie = exp(-h/Hm) + cld + haze;\\n    #ifdef cloud2\\n        mie += cld2;\\n    #endif\\n    \\n}\\n\\n\\n\\nfloat escape(in vec3 p, in vec3 d, in float R) {\\n    vec3 v = p - C;\\n    float b = dot(v, d);\\n    float c = dot(v, v) - R*R;\\n    float det2 = b * b - c;\\n    if (det2 < 0.) return -1.;\\n    float det = sqrt(det2);\\n    float t1 = -b - det, t2 = -b + det;\\n    return (t1 >= 0.) ? t1 : t2;\\n}\\n\\n// this can be explained: http://www.scratchapixel.com/lessons/3d-advanced-lessons/simulating-the-colors-of-the-sky/atmospheric-scattering/\\nvoid scatter(vec3 o, vec3 d, out vec3 col, out vec3 scat, in float t) {\\n    \\n    float L = escape(o, d, Ra);\\t\\n    float mu = dot(d, Ds);\\n    float opmu2 = 1. + mu*mu;\\n    float phaseR = .0596831 * opmu2;\\n    float phaseM = .1193662 * (1. - g2) * opmu2 / ((2. + g2) * pow(1. + g2 - 2.*g*mu, 1.5));\\n    float phaseS = .1193662 * (1. - s2) * opmu2 / ((2. + s2) * pow(1. + s2 - 2.*s*mu, 1.5));\\n    \\n    float depthR = 0., depthM = 0.;\\n    vec3 R = vec3(0.), M = vec3(0.);\\n    \\n    float dl = L / float(steps);\\n    for (int i = 0; i < steps; ++i) {\\n        float l = float(i) * dl;\\n        vec3 p = (o + d * l);\\n\\n        float dR, dM;\\n        densities(p, dR, dM);\\n        dR *= dl; dM *= dl;\\n        depthR += dR;\\n        depthM += dM;\\n\\n        float Ls = escape(p, Ds, Ra);\\n        if (Ls > 0.) {\\n            float dls = Ls / float(stepss);\\n            float depthRs = 0., depthMs = 0.;\\n            for (int j = 0; j < stepss; ++j) {\\n                float ls = float(j) * dls;\\n                vec3 ps = ( p + Ds * ls );\\n                float dRs, dMs;\\n                densities(ps, dRs, dMs);\\n                depthRs += dRs * dls;\\n                depthMs += dMs * dls;\\n            }\\n\\n            vec3 A = exp(-(bR * (depthRs + depthR) + bM * (depthMs + depthM)));\\n            R += (A * dR);\\n            M += A * dM ;\\n        } else {\\n        }\\n    }\\n\\n    //col = (I) * (R * bR * phaseR + M * bM * (phaseM ));\\n    col = (I) *(M * bM * (phaseM )); // Mie scattering\\n    #if NICE_HACK_SUN\\n    col += (SI) *(M * bM *phaseS); //Sun\\n    #endif\\n    col += (I) *(R * bR * phaseR); //Rayleigh scattering\\n    scat = 0.1 *(bM*depthM);\\n    //scat = 0.0 + clamp(depthM*5e-7,0.,1.); \\n}\\n\\n\\nvec3 hash33(vec3 p)\\n{\\n    p = fract(p * vec3(443.8975,397.2973, 491.1871));\\n    p += dot(p.zxy, p.yxz+19.27);\\n    return fract(vec3(p.x * p.y, p.z*p.x, p.y*p.z));\\n}\\n\\nvec3 stars(in vec3 p)\\n{\\n    vec3 c = vec3(0.);\\n    float res = iResolution.x*2.5;\\n\\n    for (float i=0.;i<4.;i++)\\n    {\\n        vec3 q = fract(p*(.15*res))-0.5;\\n        vec3 id = floor(p*(.15*res));\\n        vec2 rn = hash33(id).xy;\\n        float c2 = 1.-smoothstep(0.,.6,length(q));\\n        c2 *= step(rn.x,.0005+i*i*0.001);\\n        c += c2*(mix(vec3(1.0,0.49,0.1),vec3(0.75,0.9,1.),rn.y)*0.1+0.9);\\n        p *= 1.3;\\n    }\\n    return c*c*.8;\\n}\\n\\n//SIMPLE SUN STUFF\\nconst float density = 0.5;\\nconst float zenithOffset = 0.48;\\nconst vec3 skyColor = vec3(0.37, 0.55, 1.0) * (1.0 + 0.0);\\n\\n#define zenithDensity(x) density / pow(max(x - zenithOffset, 0.0035), 0.75)\\n\\nfloat getSunPoint(vec2 p, vec2 lp){\\nreturn smoothstep(0.04*(fov/2.0), 0.026*(fov/2.0), distance(p, lp)) * 50.0;\\n}\\n\\nfloat getMie(vec2 p, vec2 lp){\\n    float mytest = lp.y < 0.5 ? (lp.y+0.5)*pow(0.05,20.0):0.05;\\n    float disk = clamp(1.0 - pow(distance(p, lp), mytest), 0.0, 1.0);\\n    return disk*disk*(3.0 - 2.0 * disk) * 0.25 * PI;\\n}\\n\\nvec3 getSkyAbsorption(vec3 x, float y){\\n    vec3 absorption = x * y;\\n    absorption = pow(absorption, 1.0 - (y + absorption) * 0.5) / x / y;\\n    return absorption;\\n}\\n\\nvec3 jodieReinhardTonemap(vec3 c){\\n    float l = dot(c, vec3(0.2126, 0.7152, 0.0722));\\n    vec3 tc = c / (c + 1.0);\\n    return mix(c / (l + 1.0), tc, tc);\\n}\\n\\nvec3 getAtmosphericScattering(vec2 p, vec2 lp){\\n    float zenithnew = zenithDensity(p.y);\\n    float sunPointDistMult =  clamp(length(max(lp.y + 0.1 - zenithOffset, 0.0)), 0.0, 1.0);\\n    vec3 absorption = getSkyAbsorption(skyColor, zenithnew);\\n    vec3 sunAbsorption = getSkyAbsorption(skyColor, zenithDensity(lp.y + 0.1));\\n    vec3 sun3 = getSunPoint(p, lp) * absorption;\\n    vec3 mie2 = getMie(p, lp) * sunAbsorption;\\n    vec3 totalSky = sun3; //+ mie2;\\n    totalSky *= sunAbsorption * 0.5 + 0.5 * length(sunAbsorption);\\n    vec3 newSky = jodieReinhardTonemap(totalSky);\\n    return newSky;\\n}\\n//END SIMPLE SUN STUFF\\n\\n//RAIN STUFF\\nvec3 N31(float p) {\\n    //  3 out, 1 in... DAVE HOSKINS\\n    vec3 p3 = fract(vec3(p) * vec3(.1031,.11369,.13787));\\n    p3 += dot(p3, p3.yzx + 19.19);\\n    return fract(vec3((p3.x + p3.y)*p3.z, (p3.x+p3.z)*p3.y, (p3.y+p3.z)*p3.x));\\n}\\n\\nfloat SawTooth(float t) {\\n    return cos(t+cos(t))+sin(2.*t)*.2+sin(4.*t)*.02;\\n}\\n\\nfloat DeltaSawTooth(float t) {\\n    return 0.4*cos(2.*t)+0.08*cos(4.*t) - (1.-sin(t))*sin(t+cos(t));\\n}  \\n\\nvec2 GetDrops(vec2 uv, float seed, float m) {\\n    \\n    float t2 = t+m;\\n    vec2 o = vec2(0.);\\n\\n    #ifndef DROP_DEBUG\\n    uv.y += t2*.05;\\n    #endif\\n    \\n    uv *= vec2(10., 2.5)*2.;\\n    vec2 id = floor(uv);\\n    vec3 n = N31(id.x + (id.y+seed)*546.3524);\\n    vec2 bd = fract(uv);\\n    \\n    vec2 uv2 = bd;\\n    \\n    bd -= 0.5;\\n    \\n    bd.y*=4.;\\n\\n    bd.x += (n.x-.5)*rainy;\\n    \\n    t2 += n.z * 6.28;\\n    float slide = SawTooth(t2);\\n    \\n    float ts = 1.5;\\n    vec2 trailPos = vec2(bd.x*ts, (fract(bd.y*ts*2.-t2*2.)-.5)*.5);\\n    \\n    bd.y += slide*2.;\\t\\t\\t\\t\\t\\t\\t\\t// make drops slide down\\n    \\n    #ifdef HIGH_QUALITY\\n    float dropShape = bd.x*bd.x;\\n    dropShape *= DeltaSawTooth(t);\\n    bd.y += dropShape;\\t\\t\\t\\t\\t\\t\\t\\t// change shape of drop when it is falling\\n    #endif\\n    \\n    float d = length(bd);\\t\\t\\t\\t\\t\\t\\t// distance to main drop\\n    \\n    float trailMask = S(-.2, .2, bd.y);\\t\\t\\t\\t// mask out drops that are below the main\\n    trailMask *= bd.y;\\t\\t\\t\\t\\t\\t\\t\\t// fade dropsize\\n    float td = length(trailPos*max(.5, trailMask));\\t// distance to trail drops\\n    \\n    float mainDrop = S(.2, .1, d);\\n    float dropTrail = S(.1, .02, td);\\n    \\n    dropTrail *= trailMask;\\n    o = mix(bd*mainDrop, trailPos, dropTrail);\\t\\t// mix main drop and drop trail\\n    \\n    #ifdef DROP_DEBUG\\n    if(uv2.x<.02 || uv2.y<.01) o = vec2(1.);\\n    #endif\\n    \\n    return o;\\n}\\n//END RAIN STUFF\\n\\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) {\\n\\n    float AR = iResolution.x/iResolution.y;\\n    float M = 1.0; //canvas.innerWidth/M //canvas.innerHeight/M --res\\n    // vec2 circle = vec2(cos(gameTime* PI2), sin(gameTime*PI2));\\n    vec2 circle = vec2(1.+ cos(gameTime* PI2), 1.+ sin(gameTime*PI2));\\n    vec2 uvMouse = (circle.xy / iResolution.xy);\\n    uvMouse.x *= AR;\\n    \\n    vec2 uv0 = (fragCoord.xy / iResolution.xy);\\n    uv0 *= M;\\n    // uv0.x *= AR;\\n    \\n    vec2 uv = uv0 * (2.0*M) - (1.0*M);\\n    uv.x *=AR;\\n    \\n    \\n    // uvMouse.y=(0.7-(0.05*fov)); //initial view \\n    // uvMouse.x=(1.0-(0.05*fov)); //initial view\\n    // circle+=0.5;\\n    // uvMouse.xy = circle - vec2((0.05*fov));\\n    // uvMouse.xy = vec2(1.0, 0.5);\\n    // uvMouse*= 100.;\\n    // uvMouse += iResolution.xy *0.5;\\n    Ds = normalize(vec3(uvMouse.x-((0.5*AR)), uvMouse.y-0.5, (fov/-2.0)));\\n    \\n    \\n    vec3 O = vec3(0., cameraheight, 0.);\\n    vec3 D = normalize(vec3(uv, -(fov*M)));\\n\\n    vec3 color = vec3(0.);\\n    vec3 scat = vec3(0.);\\n\\n    //float scat = 0.;\\n    float att = 1.;\\n    float staratt = 1.;\\n    float scatatt = 1.;\\n    vec3 star = vec3(0.);\\n    vec4 aur = vec4(0.);\\n\\n    float fade = smoothstep(0.,0.01,abs(D.y))*0.5+0.9;\\n\\n\\n    \\n    staratt = 1. -min(1.0,(uvMouse.y*2.0));\\n    scatatt = 1. -min(1.0,(uvMouse.y*2.2));\\n\\n    if (D.y < -ts) {\\n        float L = - O.y / D.y;\\n        O = O + D * L;\\n        D.y = -D.y;\\n        D = normalize(D+vec3(0,.003*sin(t+6.2831*noise(O.xz+vec2(0.,-t*1e3))),0.));\\n        att = .6;\\n        star = stars(D);\\n        uvMouse.y < 0.5 ? aur = smoothstep(0.0,2.5,aurora(O,D)):aur = aur;\\n    }\\n    else{\\n            float L1 =  O.y / D.y;\\n        vec3 O1 = O + D * L1;\\n\\n        vec3 D1 = vec3(1.);\\n        D1 = normalize(D+vec3(1.,0.0009*sin(t+6.2831*noise(O1.xz+vec2(0.,t*0.8))),0.));\\n        star = stars(D1);\\n        uvMouse.y < 0.5 ? aur = smoothstep(0.,1.5,aurora(O,D))*fade:aur = aur;\\n    }\\n\\n    star *= att;\\n    star *= staratt;\\n\\n    scatter(O, D, color, scat, t);\\n    color *= att;\\n    scat *=  att;\\n    scat *= scatatt;\\n    \\n    //draw the badly implemented sun\\n    #if SIMPLE_SUN\\n    \\n    vec2 uv1 = (fragCoord.xy / iResolution.xy);\\n    uv1 *=M;\\n    uv1.x *=AR;\\n    \\n    vec3 sun2 = getAtmosphericScattering(uv1, vec2(uvMouse.x,uvMouse.y)) ;\\n    color += sun2;\\n    #endif\\n    \\n    color += scat;\\n    color += star;\\n    //color=color*(1.-(aur.a)*scatatt) + (aur.rgb*scatatt);\\n    color += aur.rgb*scatatt;\\n\\n    \\n    \\n    #if ENABLE_RAIN\\n    vec2 drops = vec2(0.);\\n    if (rainmulti > 1.0){\\n    drops = GetDrops(uv/2.0, 1., 1.);\\n\\n    color +=drops.x+drops.y;\\n    }\\n    #endif\\n\\n    //float env = pow( smoothstep(.5, iResolution.x / iResolution.y, length(uv*0.8)), 0.0);\\n    fragColor = vec4(pow(color, vec3(1.0/2.2)), 1.); //gamma correct\\n}\\nvoid main() { vec4 color = vec4(0.0); mainImage(color, gl_FragCoord.xy); gl_FragColor = color; }\""],"sourceRoot":""}